<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Castie! Notes</title>
  <meta name="description" content="  è¯´å®è¯è¿™ä¸ª2Dæ¸¸æˆå®æˆ˜çš„å…¥é—¨çœ‹çš„æˆ‘è„‘æµ†å­éƒ½æ²¸è…¾äº†, å¥½å¤šæ–°çš„æ¦‚å¿µæ¶Œå…¥, æ²¡åšè¿‡æ¸¸æˆå¼€å‘çš„æˆ‘è¡¨ç¤ºçœŸçš„éš¾ä»¥æ¥å—, å¸æ”¶æ•ˆç‡ä¸ä¹‹å‰ç›¸æ¯”ä¹Ÿä¸‹é™å¥½å¤š, ä¸è¿‡è¶Šå¾€åå­¦, å°±èƒ½å¤ŸåŠ æ·±å¯¹ä¹‹å‰çŸ¥è¯†çš„æŒæ¡, è¿™å¯èƒ½ä¹Ÿæ˜¯çœ‹ä¹¦çš„å¥½å¤„å§, ä»Šå¤©æˆ‘ä¹ŸæŠŠå¯¹ç“¦ç‰‡åœ°å›¾çš„ä¸€äº›å­¦ä¹ ç»éªŒè®°å½•ä¸‹æ¥ä¾›å¤§å®¶æ¢è®¨.ä»£ç è§:github">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="SpriteKit ç“¦ç‰‡åœ°å›¾ä»€ä¹ˆçš„è¿˜æŒºå¥½ç©å„¿">
  <meta name="twitter:description" content="  è¯´å®è¯è¿™ä¸ª2Dæ¸¸æˆå®æˆ˜çš„å…¥é—¨çœ‹çš„æˆ‘è„‘æµ†å­éƒ½æ²¸è…¾äº†, å¥½å¤šæ–°çš„æ¦‚å¿µæ¶Œå…¥, æ²¡åšè¿‡æ¸¸æˆå¼€å‘çš„æˆ‘è¡¨ç¤ºçœŸçš„éš¾ä»¥æ¥å—, å¸æ”¶æ•ˆç‡ä¸ä¹‹å‰ç›¸æ¯”ä¹Ÿä¸‹é™å¥½å¤š, ä¸è¿‡è¶Šå¾€åå­¦, å°±èƒ½å¤ŸåŠ æ·±å¯¹ä¹‹å‰çŸ¥è¯†çš„æŒæ¡, è¿™å¯èƒ½ä¹Ÿæ˜¯çœ‹ä¹¦çš„å¥½å¤„å§, ä»Šå¤©æˆ‘ä¹ŸæŠŠå¯¹ç“¦ç‰‡åœ°å›¾çš„ä¸€äº›å­¦ä¹ ç»éªŒè®°å½•ä¸‹æ¥ä¾›å¤§å®¶æ¢è®¨.ä»£ç è§:github">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="SpriteKit ç“¦ç‰‡åœ°å›¾ä»€ä¹ˆçš„è¿˜æŒºå¥½ç©å„¿">
  <meta property="og:description" content="  è¯´å®è¯è¿™ä¸ª2Dæ¸¸æˆå®æˆ˜çš„å…¥é—¨çœ‹çš„æˆ‘è„‘æµ†å­éƒ½æ²¸è…¾äº†, å¥½å¤šæ–°çš„æ¦‚å¿µæ¶Œå…¥, æ²¡åšè¿‡æ¸¸æˆå¼€å‘çš„æˆ‘è¡¨ç¤ºçœŸçš„éš¾ä»¥æ¥å—, å¸æ”¶æ•ˆç‡ä¸ä¹‹å‰ç›¸æ¯”ä¹Ÿä¸‹é™å¥½å¤š, ä¸è¿‡è¶Šå¾€åå­¦, å°±èƒ½å¤ŸåŠ æ·±å¯¹ä¹‹å‰çŸ¥è¯†çš„æŒæ¡, è¿™å¯èƒ½ä¹Ÿæ˜¯çœ‹ä¹¦çš„å¥½å¤„å§, ä»Šå¤©æˆ‘ä¹ŸæŠŠå¯¹ç“¦ç‰‡åœ°å›¾çš„ä¸€äº›å­¦ä¹ ç»éªŒè®°å½•ä¸‹æ¥ä¾›å¤§å®¶æ¢è®¨.ä»£ç è§:github">
  
  <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
  <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/ico">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2017/05/SpriteKit-%E7%93%A6%E7%89%87%E5%9C%B0%E5%9B%BE%E4%BB%80%E4%B9%88%E7%9A%84%E8%BF%98%E6%8C%BA%E5%A5%BD%E7%8E%A9%E5%84%BF/">
  <link rel="alternate" type="application/rss+xml" title="Castie!" href="http://localhost:4000/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="å‰å¾€ Castie! çš„ä¸»é¡µ" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Castie! logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Castie!" class="blog-button">Castie!</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">æ­£æ€åˆ†å¸ƒ, ä¼˜åŠ£ä¼´ç”Ÿ</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">åŒ—å†¥æœ‰é±¼ï¼Œå…¶åä¸ºé²²ï¼ˆkÅ«nï¼‰ã€‚é²²ä¹‹å¤§ï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›åŒ–è€Œä¸ºé¸Ÿï¼Œå…¶åä¸ºé¹ã€‚é¹ä¹‹èƒŒï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›æ€’è€Œé£ï¼Œå…¶ç¿¼è‹¥å‚å¤©ä¹‹äº‘ã€‚æ˜¯é¸Ÿä¹Ÿï¼Œæµ·è¿åˆ™å°†å¾™äºå—å†¥ã€‚å—å†¥è€…ï¼Œå¤©æ± ä¹Ÿã€‚</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description">åŒ—æµ·è‹¥æ›°ï¼šâ€œäº•é¼ƒä¸å¯ä»¥è¯­äºæµ·è€…ï¼Œæ‹˜äºè™šä¹Ÿï¼›å¤è™«ä¸å¯ä»¥è¯­äºå†°è€…ï¼Œç¬ƒäºæ—¶ä¹Ÿï¼›æ›²å£«ä¸å¯ä»¥è¯­äºé“è€…ï¼ŒæŸäºæ•™ä¹Ÿã€‚ä»Šå°”å‡ºäºå´–æ¶˜ï¼Œè§‚äºå¤§æµ·ï¼Œä¹ƒçŸ¥å°”ä¸‘ï¼Œå°”å°†å¯ä¸è¯­å¤§ç†çŸ£ã€‚</p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="è®¿é—®åšå®¢" class="blog-button">åšå®¢</a></li>
                
                  <li class="navigation__item"><a href="https://coderzsq.github.io/coderZsq.practice.web/" target="_blank" title="æˆ‘çš„ç®€å†">ç®€å†</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
    <!-- juejin-->
    <li class="navigation__item">
      <a href="https://juejin.im/user/57e735dfa22b9d00614eecb8/posts" title="@coderZsq çš„ç¨€åœŸæ˜é‡‘" target="_blank">
        <i class='social fa fa-book'></i>
        <span class="label">juejin</span>
      </a>
    </li>
    

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/coderZsq" title="@coderZsq çš„ Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:a13701777868@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-05-24 11:49:00 +0800" itemprop="datePublished" class="post-meta__date date">2017-05-24</time> &#8226; <span class="post-meta__tags tags">ç§»åŠ¨å¼€å‘</span>
    </div>
    <h1 class="post-title">SpriteKit ç“¦ç‰‡åœ°å›¾ä»€ä¹ˆçš„è¿˜æŒºå¥½ç©å„¿</h1>
  </header>

  <section class="post">
    <blockquote>
  <p>è¯´å®è¯è¿™ä¸ª2Dæ¸¸æˆå®æˆ˜çš„å…¥é—¨çœ‹çš„æˆ‘è„‘æµ†å­éƒ½æ²¸è…¾äº†, å¥½å¤šæ–°çš„æ¦‚å¿µæ¶Œå…¥, æ²¡åšè¿‡æ¸¸æˆå¼€å‘çš„æˆ‘è¡¨ç¤ºçœŸçš„éš¾ä»¥æ¥å—, å¸æ”¶æ•ˆç‡ä¸ä¹‹å‰ç›¸æ¯”ä¹Ÿä¸‹é™å¥½å¤š, ä¸è¿‡è¶Šå¾€åå­¦, å°±èƒ½å¤ŸåŠ æ·±å¯¹ä¹‹å‰çŸ¥è¯†çš„æŒæ¡, è¿™å¯èƒ½ä¹Ÿæ˜¯çœ‹ä¹¦çš„å¥½å¤„å§, ä»Šå¤©æˆ‘ä¹ŸæŠŠå¯¹ç“¦ç‰‡åœ°å›¾çš„ä¸€äº›å­¦ä¹ ç»éªŒè®°å½•ä¸‹æ¥ä¾›å¤§å®¶æ¢è®¨.ä»£ç è§:<a href="https://github.com/coderZsq/coderZsq.target.swift">github</a></p>
</blockquote>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-b5433f0a638b1a15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>è¯´å®è¯, æˆ‘å¾ˆæ¨èRayå®¶çš„èµ„æº, ç”±æµ…å…¥æ·±æ‰‹æŠŠæ‰‹çš„æ•™å­¦, å†…å®¹å‰åå‘¼åº”, çœ‹å‡ æœ¬ä¹¦å°±èƒ½æ¶µç›–å›½å†…4ä¸ªæœˆåŸ¹è®­ç­çš„è¯¾ç¨‹ä½“ç³». éµå¾ªæœ¬ç³»åˆ—ä¸€è´¯çš„é£æ ¼, æˆ‘ä»¬è¿˜æ˜¯ä»åŸºç¡€çš„APIå¼€å§‹çœ‹èµ·, å¯¹APIæŒæ¡ç†Ÿç»ƒçš„è¯, å¤šæ•²ä¸¤ä¸ªDemoå°±èƒ½å¤ŸåŸºæœ¬çš„ä¸Šæ‰‹ä»»ä½•é¡¹ç›®äº†.</p>
<h5 id="sktilemapnode">SKTileMapNode</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 10.0, *)
open class SKTileMapNode : SKNode, NSCopying, NSCoding
     public init(tileSet: SKTileSet, columns: Int, rows: Int, tileSize: CGSize)
     open var numberOfColumns: Int
     open var numberOfRows: Int
     open var tileSize: CGSize
     open var mapSize: CGSize { get }
     open var tileSet: SKTileSet
     open var colorBlendFactor: CGFloat
     open func tileDefinition(atColumn column: Int, row: Int) -&gt; SKTileDefinition?
     open func tileGroup(atColumn column: Int, row: Int) -&gt; SKTileGroup?
     open func setTileGroup(_ tileGroup: SKTileGroup?, forColumn column: Int, row: Int)
     open func tileColumnIndex(fromPosition position: CGPoint) -&gt; Int
     open func tileRowIndex(fromPosition position: CGPoint) -&gt; Int
     open func centerOfTile(atColumn column: Int, row: Int) -&gt; CGPoint
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">init(tileSet: SKTileSet, columns: Int, rows: Int, tileSize: CGSize)</code> ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹çš„åˆå§‹åŒ–æ–¹æ³•</li>
  <li><code class="highlighter-rouge">numberOfColumns</code> ç“¦ç‰‡åœ°å›¾çš„åˆ—æ•°</li>
  <li><code class="highlighter-rouge">numberOfRows</code> ç“¦ç‰‡åœ°å›¾çš„è¡Œæ•°</li>
  <li><code class="highlighter-rouge">tileSize</code> ç“¦ç‰‡åœ°å›¾ä¸­æ¯ä¸ªç“¦ç‰‡çš„å°ºå¯¸</li>
  <li><code class="highlighter-rouge">mapSize</code> ç“¦ç‰‡åœ°å›¾çš„å°ºå¯¸</li>
  <li><code class="highlighter-rouge">tileSet</code> ç“¦ç‰‡åœ°å›¾çš„ç“¦ç‰‡é›†</li>
  <li><code class="highlighter-rouge">colorBlendFactor</code> ç“¦ç‰‡çš„æ¸²æŸ“ç€è‰²</li>
  <li><code class="highlighter-rouge">tileDefinition(atColumn column: Int, row: Int) -&gt; SKTileDefinition?</code> æ ¹æ®åˆ—æ•°å’Œè¡Œæ•°è¿”å›ç“¦ç‰‡å®šä¹‰</li>
  <li><code class="highlighter-rouge">tileGroup(atColumn column: Int, row: Int) -&gt; SKTileGroup?</code> æ ¹æ®åˆ—æ•°å’Œè¡Œæ•°è¿”å›ç“¦ç‰‡ç»„</li>
  <li><code class="highlighter-rouge">setTileGroup(_ tileGroup: SKTileGroup?, forColumn column: Int, row: Int)</code> æ ¹æ®åˆ—æ•°å’Œè¡Œæ•°è®¾ç½®ç“¦ç‰‡ç»„</li>
  <li><code class="highlighter-rouge">tileColumnIndex(fromPosition position: CGPoint) -&gt; Int</code> æ ¹æ®ç“¦ç‰‡ä½ç½®è¿”å›ç“¦ç‰‡åœ¨ç“¦ç‰‡åœ°å›¾ä¸­åˆ—æ•°ä¸‹æ ‡</li>
  <li><code class="highlighter-rouge"> tileRowIndex(fromPosition position: CGPoint) -&gt; Int</code> æ ¹æ®ç“¦ç‰‡ä½ç½®è¿”å›ç“¦ç‰‡åœ¨ç“¦ç‰‡åœ°å›¾ä¸­è¡Œæ•°ä¸‹æ ‡</li>
</ul>

<h5 id="sktileset">SKTileSet</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 10.0, *)
open class SKTileSet : NSObject, NSCopying, NSCoding 
     public init(tileGroups: [SKTileGroup])
     open var tileGroups: [SKTileGroup]
     open var name: String?
     open var defaultTileGroup: SKTileGroup?
     open var defaultTileSize: CGSize
     open var type: SKTileSetType

@available(iOS 10.0, *)
public enum SKTileSetType : UInt {
    case grid
    case isometric
    case hexagonalFlat
    case hexagonalPointy
}
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">init(tileGroups: [SKTileGroup])</code> æ ¹æ®ç“¦ç‰‡ç»„åˆå§‹åŒ–ç“¦ç‰‡é›†</li>
  <li><code class="highlighter-rouge">tileGroups</code> ç“¦ç‰‡ç»„</li>
  <li><code class="highlighter-rouge">name</code> ç“¦ç‰‡é›†çš„æ ‡è¯†</li>
  <li><code class="highlighter-rouge">defaultTileGroup</code> ç“¦ç‰‡é›†é»˜è®¤ç“¦ç‰‡ç»„</li>
  <li><code class="highlighter-rouge">defaultTileSize</code> ç“¦ç‰‡é›†é»˜è®¤ç“¦ç‰‡å°ºå¯¸</li>
  <li><code class="highlighter-rouge">type</code> ç“¦ç‰‡é›†ç±»å‹ - ç½‘æ ¼, ç­‰å€¼, å…­è¾¹å½¢</li>
</ul>

<h5 id="sktilegroup">SKTileGroup</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 10.0, *)
open class SKTileGroup : NSObject, NSCopying, NSCoding
     open class func empty() -&gt; Self
     public init(tileDefinition: SKTileDefinition)
     public init(rules: [SKTileGroupRule])
     open var name: String?
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">empty()</code> è¿”å›ä¸€ä¸ªç©ºçš„ç“¦ç‰‡ç»„</li>
  <li><code class="highlighter-rouge">init(tileDefinition: SKTileDefinition)</code> æ ¹æ®ç“¦ç‰‡å®šä¹‰åˆå§‹åŒ–ç“¦ç‰‡ç»„</li>
  <li><code class="highlighter-rouge">init(rules: [SKTileGroupRule])</code> æ ¹æ®ç“¦ç‰‡ç»„è§„åˆ™åˆå§‹åŒ–ç“¦ç‰‡ç»„</li>
  <li><code class="highlighter-rouge">name</code> ç“¦ç‰‡ç»„çš„æ ‡è¯†</li>
</ul>

<h5 id="sktilegrouprule">SKTileGroupRule</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 10.0, *)
open class SKTileGroupRule : NSObject, NSCopying, NSCoding
     public init(adjacency: SKTileAdjacencyMask, tileDefinitions: [SKTileDefinition])
     open var adjacency: SKTileAdjacencyMask
     open var tileDefinitions: [SKTileDefinition]
     open var name: String?
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">init(adjacency: SKTileAdjacencyMask, tileDefinitions: [SKTileDefinition])</code> æ ¹æ®ç“¦ç‰‡é“¾æ¥å’Œç“¦ç‰‡å®šä¹‰åˆå§‹åŒ–ç“¦ç‰‡ç»„è§„åˆ™</li>
  <li><code class="highlighter-rouge">adjacency</code> ç“¦ç‰‡é“¾æ¥</li>
  <li><code class="highlighter-rouge">tileDefinitions</code> ç“¦ç‰‡è§„åˆ™</li>
  <li><code class="highlighter-rouge">name</code> ç“¦ç‰‡ç»„è§„åˆ™æ ‡è¯†</li>
</ul>

<h5 id="sktiledefinition">SKTileDefinition</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 10.0, *)
open class SKTileDefinition : NSObject, NSCopying, NSCoding
     public init(texture: SKTexture)
     public init(textures: [SKTexture], normalTextures: [SKTexture], size: CGSize, timePerFrame: CGFloat)
     open var userData: NSMutableDictionary?
     open var name: String?
     open var size: CGSize
     open var timePerFrame: CGFloat
     open var rotation: SKTileDefinitionRotation
     open var flipVertically: Bool
     open var flipHorizontally: Bool
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">init(texture: SKTexture)</code> æ ¹æ®çº¹ç†åˆå§‹åŒ–ç“¦ç‰‡å®šä¹‰</li>
  <li><code class="highlighter-rouge"> init(textures: [SKTexture], normalTextures: [SKTexture], size: CGSize, timePerFrame: CGFloat)</code> æ ¹æ®çº¹ç†é›†åˆ, å°ºå¯¸, å’Œå¸§ç‡åˆå§‹åŒ–ç“¦ç‰‡å®šä¹‰</li>
  <li><code class="highlighter-rouge">userData</code> ç“¦ç‰‡å®šä¹‰çš„ç”¨æˆ·æ•°æ®</li>
  <li><code class="highlighter-rouge">name</code> ç“¦ç‰‡å®šä¹‰çš„æ ‡è¯†</li>
  <li><code class="highlighter-rouge">timePerFrame</code> ç“¦ç‰‡å®šä¹‰çš„å¸§ç‡</li>
  <li><code class="highlighter-rouge">rotation</code> ç“¦ç‰‡å®šä¹‰çš„æ—‹è½¬è§„åˆ™</li>
  <li><code class="highlighter-rouge">flipVertically</code> æ˜¯å¦å‚ç›´ç¿»è½¬</li>
  <li><code class="highlighter-rouge">flipHorizontally</code> æ˜¯å¦æ°´å¹³ç¿»è½¬</li>
</ul>

<h4 id="å®æˆ˜">å®æˆ˜:</h4>

<p>API, äº†è§£ä¸€äº›åŸºæœ¬çš„å°±å¤Ÿäº†, å¦‚æœè¦æ·±ç©¶å¯ä»¥æ‰“å¼€å¤´æ–‡ä»¶é€ä¸ªå°è¯•, æˆ‘ä»¬ç°åœ¨å°±æ¥å®ç°ä¸€ä¸ªå°æ¸¸æˆ, è¿™ä¸ªæ¸¸æˆä¸­åŒ…å«äº†3ä¸ªåœºæ™¯, æ§åˆ¶äººç‰©åœ¨è§„å®šæ—¶é—´å†…æ¶ˆç­æ‰€æœ‰çš„å®³è™«, æˆ‘ä»¬ç€æ‰‹è¿›è¡Œæ¸¸æˆçš„å¼€å‘å§!</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-f837c5a6c01be613.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<ul>
  <li>step1 è®¾ç½®æ¸¸æˆåœºæ™¯çš„å±æ€§</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>class GameScene: SKScene {
  var background: SKTileMapNode! //èƒŒæ™¯ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹
  var obstaclesTileMap: SKTileMapNode? //éšœç¢ç‰©ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹
  var bugsprayTileMap: SKTileMapNode? //æ€è™«å–·å‰‚ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹

  var bugsNode = SKNode() //å®³è™«çš„èŠ‚ç‚¹
  
  var player = Player() //ç©å®¶çš„èŠ‚ç‚¹
  var hud = HUD() //æ–‡å­—è¯´æ˜
  
  var firebugCount: Int = 0 //é«˜çº§å®³è™«çš„èŠ‚ç‚¹æ•°

  var timeLimit: Int = 10 //æ—¶é—´é™åˆ¶
  var elapsedTime: Int = 0 //ç»è¿‡æ—¶é—´
  var startTime: Int? //å¼€å§‹æ—¶é—´

  var currentLevel: Int = 1 //å½“å‰å…³å¡ç­‰çº§

  var gameState: GameState = .initial { //æ¸¸æˆçŠ¶æ€é»˜è®¤ä¸ºåˆå§‹çŠ¶æ€
    didSet { 
      hud.updateGameState(from: oldValue, to: gameState) //æ›´æ–°æ¸¸æˆçŠ¶æ€
    }
  }
  ...
}
</code></pre>
</div>
<ul>
  <li>step2 åŠ è½½æ¸¸æˆåœºæ™¯çš„åˆå§‹åŒ–è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  required init?(coder aDecoder: NSCoder) {
    super.init(coder: aDecoder)
    background =
      childNode(withName: "background") as! SKTileMapNode //é€šè¿‡èŠ‚ç‚¹åè¯»å–èƒŒæ™¯ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹
    obstaclesTileMap = childNode(withName: "obstacles") 
      as? SKTileMapNode //é€šè¿‡èŠ‚ç‚¹åè¯»å–éšœç¢ç‰©ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹

    if let timeLimit =
      userData?.object(forKey: "timeLimit") as? Int {
      self.timeLimit = timeLimit //é€šè¿‡èŠ‚ç‚¹çš„ç”¨æˆ·æ•°æ®è®¾ç½®æ¯ä¸ªåœºæ™¯çš„æ—¶é—´é™åˆ¶
    }
    // 1
    let savedGameState = aDecoder.decodeInteger(forKey: "Scene.gameState") //è§£æ¡£ä¿å­˜æ¸¸æˆçŠ¶æ€
    if let gameState = GameState(rawValue: savedGameState), gameState == .pause { //å½“è§£æ¡£ä¿å­˜æ¸¸æˆçŠ¶æ€ä¸ºæš‚åœæ—¶
      self.gameState = gameState //èµ‹å€¼æ¸¸æˆçŠ¶æ€
      firebugCount = aDecoder.decodeInteger(
        forKey: "Scene.firebugCount") //è§£æ¡£é«˜çº§å®³è™«æ•°
      elapsedTime = aDecoder.decodeInteger(
        forKey: "Scene.elapsedTime") //è§£æ¡£ç»è¿‡æ—¶é—´
      currentLevel = aDecoder.decodeInteger(
        forKey: "Scene.currentLevel") //è§£æ¡£å½“å‰å…³å¡ç­‰çº§
      // 2
      player = childNode(withName: "Player") as! Player //æ ¹æ®èŠ‚ç‚¹åè¯»å–ç©å®¶èŠ‚ç‚¹
      hud = camera!.childNode(withName: "HUD") as! HUD //æ ¹æ®èŠ‚ç‚¹åè¯»å–æ–‡å­—è¯´æ˜
      bugsNode = childNode(withName: "Bugs")! //æ ¹æ®èŠ‚ç‚¹åè¯»å–å®³è™«èŠ‚ç‚¹
      bugsprayTileMap = childNode(withName: "Bugspray") 
        as? SKTileMapNode //é€šè¿‡èŠ‚ç‚¹åè¯»å–æ€è™«å–·é›¾ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹
    }

    addObservers() //æ·»åŠ è§‚å¯Ÿè€…
  }

  deinit {
    NotificationCenter.default.removeObserver(self) //ç§»é™¤è§‚å¯Ÿè€…
  }
</code></pre>
</div>
<ul>
  <li>step3 å½“åœºæ™¯ç§»åŠ¨åˆ°å±å¹•æ—¶çš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  override func didMove(to view: SKView) {
    if gameState == .initial { //å½“æ¸¸æˆçŠ¶æ€ä¸ºåˆå§‹çŠ¶æ€æ—¶
      addChild(player) //æ·»åŠ ç©å®¶åˆ°åœºæ™¯
      setupWorldPhysics() //æ·»åŠ ç‰©ç†ä¸–ç•Œ
      createBugs() //æ·»åŠ å®³è™«
      setupObstaclePhysics() //æ·»åŠ éšœç¢ç‰©
      if firebugCount &gt; 0 { //å¦‚æœæœ‰é«˜çº§å®³è™«
        createBugspray(quantity: firebugCount + 10) //æ·»åŠ æ€è™«å–·é›¾
      }
      setupHUD() //æ·»åŠ æ–‡å­—è¯´æ˜
      gameState = .start //è®¾ç½®æ¸¸æˆçŠ¶æ€ä¸ºå¼€å§‹çŠ¶æ€
    }
    setupCamera() //æ·»åŠ æ‘„åƒå¤´
  }
</code></pre>
</div>
<ul>
  <li>step4 ç‰©ç†ä¸–ç•Œçš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func setupWorldPhysics() {
    background.physicsBody =
      SKPhysicsBody(edgeLoopFrom: background.frame) //è®¾ç½®è¾¹ç¼˜ç‰©ç†ä½“
    background.physicsBody?.categoryBitMask = PhysicsCategory.Edge //è®¾ç½®ç‰©ç†ä½“æ ‡è¯†ä¸ºè¾¹ç¼˜
    
    physicsWorld.contactDelegate = self //ç‰©ç†ä¸–ç•Œä»£ç†

  }
</code></pre>
</div>
<ul>
  <li>step5 åˆ›å»ºå®³è™«çš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func createBugs() {
    guard let bugsMap = childNode(withName: "bugs")
      as? SKTileMapNode else { return } //æ ¡éªŒå®³è™«ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹
    // 1
    for row in 0..&lt;bugsMap.numberOfRows { //é€è¡Œéå†å®³è™«ç“¦ç‰‡åœ°å›¾
      for column in 0..&lt;bugsMap.numberOfColumns { //é€åˆ—éå†å®³è™«ç“¦ç‰‡åœ°å›¾
        // 2
        guard let tile = tile(in: bugsMap,
                              at: (column, row)) 
          else { continue } //æ ¡éªŒç“¦ç‰‡åœ°å›¾ä¸­çš„æ¯ä¸ªç“¦ç‰‡
        // 3
        let bug: Bug 
        if tile.userData?.object(forKey: "firebug") != nil { //ä»ç”¨æˆ·æ•°æ®ä¸­åˆ¤æ–­æ˜¯å¦ä¸ºé«˜çº§å®³è™«
          bug = Firebug() //å°†å®³è™«è®¾ç½®ä¸ºé«˜çº§å®³è™«
          firebugCount += 1 //é«˜çº§å®³è™«ä¹¦è‡ªå¢
        } else {
          bug = Bug() //å°†å®³è™«è®¾ç½®ä¸ºæ™®é€šå®³è™«
        }
        bug.position = bugsMap.centerOfTile(atColumn: column,
                                            row: row) //ä»å®³è™«ç“¦ç‰‡åœ°å›¾ä¸­è¯»å–ä½ç½®å¹¶èµ‹å€¼
        bugsNode.addChild(bug) //æ·»åŠ èŠ‚ç‚¹
        bug.moveBug() //ç§»åŠ¨å®³è™«
      }
    }
    // 4
    bugsNode.name = "Bugs" //è®¾ç½®å®³è™«èŠ‚ç‚¹æ ‡è¯†
    addChild(bugsNode) //æ·»åŠ çˆ¶èŠ‚ç‚¹åˆ°åœºæ™¯
    // 5
    bugsMap.removeFromParent() //åˆ é™¤å®³è™«ç“¦ç‰‡åœ°å›¾åœ°å›¾èŠ‚ç‚¹
  }
</code></pre>
</div>
<ul>
  <li>step6 æ·»åŠ éšœç¢ç‰©çš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func setupObstaclePhysics() {
    guard let obstaclesTileMap = obstaclesTileMap else { return } //æ ¡éªŒéšœç¢ç‰©ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹
    // 1
    for row in 0..&lt;obstaclesTileMap.numberOfRows {
      for column in 0..&lt;obstaclesTileMap.numberOfColumns {
        // 2
        guard let tile = tile(in: obstaclesTileMap,
                              at: (column, row))
          else { continue }
        guard tile.userData?.object(forKey: "obstacle") != nil
          else { continue }
        // 3
        let node = SKNode() //åˆ›å»ºèŠ‚ç‚¹
        node.physicsBody = SKPhysicsBody(rectangleOf: tile.size) æ ¹æ®ç“¦ç‰‡å°ºå¯¸åˆ›å»ºç‰©ç†ä½“
        node.physicsBody?.isDynamic = false //ä¸è¿›å…¥ç‰©ç†ä¸–ç•Œ
        node.physicsBody?.friction = 0 //æ‘©æ“¦ç³»æ•°ä¸º0
        node.physicsBody?.categoryBitMask =
          PhysicsCategory.Breakable //è®¾ç½®ç‰©ç†ä½“æ ‡è¯†
        
        node.position = obstaclesTileMap.centerOfTile(
          atColumn: column, row: row)
        obstaclesTileMap.addChild(node)
      }
    }
  }
</code></pre>
</div>

<ul>
  <li>step7 æ·»åŠ æ€è™«å–·é›¾çš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func createBugspray(quantity: Int) {
    // 1
    let tile = SKTileDefinition(texture:
      SKTexture(pixelImageNamed: "bugspray")) //åˆ›å»ºç“¦ç‰‡å®šä¹‰
    // 2
    let tilerule = SKTileGroupRule(adjacency:
      SKTileAdjacencyMask.adjacencyAll, tileDefinitions: [tile]) //åˆ›å»ºç“¦ç‰‡ç»„è§„åˆ™
    // 3 
    let tilegroup = SKTileGroup(rules: [tilerule]) //åˆ›å»ºç“¦ç‰‡ç»„
    // 4
    let tileSet = SKTileSet(tileGroups: [tilegroup]) //åˆ›å»ºç“¦ç‰‡é›†
    
    // 5
    let columns = background.numberOfColumns //è¯»å–èƒŒæ™¯ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹çš„åˆ—æ•°
    let rows = background.numberOfRows //è¯»å–èƒŒæ™¯ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹çš„è¡Œæ•°
    bugsprayTileMap = SKTileMapNode(tileSet: tileSet, 
                                    columns: columns,
                                    rows: rows,
                                    tileSize: tile.size) //åˆ›å»ºæ–°çš„ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹
    // 6
    for _ in 1...quantity { 
      let column = Int.random(min: 0, max: columns-1) //éšæœºåˆ—æ•°
      let row = Int.random(min: 0, max: rows-1) //éšæœºè¡Œæ•°
      bugsprayTileMap?.setTileGroup(tilegroup,
                                    forColumn: column, row: row) //åœ¨æ–°é¢çš„ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹ä¸Šéšæœºç”Ÿæˆç“¦ç‰‡ç»„
    }
    // 7
    bugsprayTileMap?.name = "Bugspray" //è®¾ç½®ç“¦ç‰‡åœ°å›¾èŠ‚ç‚¹çš„æ ‡è¯†
    addChild(bugsprayTileMap!) //å°†ç“¦ç‰‡åœ°å›¾æ·»åŠ åˆ°åœºæ™¯

  }
</code></pre>
</div>
<ul>
  <li>step8 æ·»åŠ æ‘„åƒå¤´è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func setupCamera() {
    guard let camera = camera, let view = view else { return }
    
    let zeroDistance = SKRange(constantValue: 0)
    let playerConstraint = SKConstraint.distance(zeroDistance,
                                                 to: player) //å¯¹ç©å®¶è¿›è¡Œçº¦æŸ
    // 1
    let xInset = min(view.bounds.width/2 * camera.xScale,
                     background.frame.width/2)
    let yInset = min(view.bounds.height/2 * camera.yScale,
                     background.frame.height/2)
    
    // 2
    let constraintRect = background.frame.insetBy(dx: xInset,
                                                  dy: yInset)
    // 3
    let xRange = SKRange(lowerLimit: constraintRect.minX,
                         upperLimit: constraintRect.maxX)
    let yRange = SKRange(lowerLimit: constraintRect.minY,
                         upperLimit: constraintRect.maxY)
    
    let edgeConstraint = SKConstraint.positionX(xRange, y: yRange)
    edgeConstraint.referenceNode = background
    // 4
    camera.constraints = [playerConstraint, edgeConstraint]
  }

</code></pre>
</div>
<ul>
  <li>step9 è·å–ç“¦ç‰‡çš„ä¸€äº›å¸®åŠ©æ–¹æ³•</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func tile(in tileMap: SKTileMapNode,
            at coordinates: TileCoordinates)
    -&gt; SKTileDefinition? {
      return tileMap.tileDefinition(atColumn: coordinates.column,
                                    row: coordinates.row)
  }

  func tileCoordinates(in tileMap: SKTileMapNode,
                       at position: CGPoint) -&gt; TileCoordinates {
    let column = tileMap.tileColumnIndex(fromPosition: position)
    let row = tileMap.tileRowIndex(fromPosition: position)
    return (column, row)
  }

  func tileGroupForName(tileSet: SKTileSet, name: String)
    -&gt; SKTileGroup? {
      let tileGroup = tileSet.tileGroups
        .filter { $0.name == name }.first
      return tileGroup
  }
</code></pre>
</div>
<ul>
  <li>step10 ç‚¹å‡»åœºæ™¯çš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  override func touchesBegan(_ touches: Set&lt;UITouch&gt;,
                             with event: UIEvent?) {
    guard let touch = touches.first else { return }
    switch gameState {
    // 1
    case .start: //å¼€å§‹çŠ¶æ€
      gameState = .play //åˆ‡æ¢æˆæ¸¸æˆçŠ¶æ€
      isPaused = false //å¼€å§‹
      startTime = nil
      elapsedTime = 0
    // 2
    case .play: //æ¸¸æˆçŠ¶æ€
      player.move(target: touch.location(in: self)) //ç§»åŠ¨ç©å®¶
    case .win: //è·èƒœçŠ¶æ€
      transitionToScene(level: currentLevel + 1) //åˆ‡æ¢åœºæ™¯
    case .lose: //è½è´¥çŠ¶æ€
      transitionToScene(level: 1) //åˆ‡æ¢åœºæ™¯
    case .reload: //å”¤é†’çŠ¶æ€
      // 1
      if let touchedNode =
        atPoint(touch.location(in: self)) as? SKLabelNode {
        // 2
        if touchedNode.name == HUDMessages.yes { //å¦‚æœç‚¹å‡»çš„èŠ‚ç‚¹æ˜¯YES
          isPaused = false
          startTime = nil
          gameState = .play
          // 3
        } else if touchedNode.name == HUDMessages.no { //å¦‚æœç‚¹å‡»çš„èŠ‚ç‚¹æ˜¯NO
          transitionToScene(level: 1)
        }
      }
    default:
      break
    }
  }

</code></pre>
</div>
<ul>
  <li>step11 åˆ‡æ¢åœºæ™¯çš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func transitionToScene(level: Int) {
    // 1
    guard let newScene = SKScene(fileNamed: "Level\(level)")
      as? GameScene else {
        fatalError("Level: \(level) not found")
    }
    // 2
    newScene.currentLevel = level
    view!.presentScene(newScene,
                       transition: SKTransition.flipVertical(withDuration: 0.5))
  }
</code></pre>
</div>

<ul>
  <li>step12 åˆ·å¸§</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  override func update(_ currentTime: TimeInterval) {
    if gameState != .play  {
      isPaused = true //å¦‚æœä¸æ˜¯æ¸¸æˆçŠ¶æ€å°±æš‚åœåˆ·å¸§
      return
    }

    if !player.hasBugspray {
      updateBugspray() //å¦‚æœç©å®¶æ²¡æœ‰æ€è™«å–·é›¾, å°±è¿›è¡Œæ›´æ–°
    }
    advanceBreakableTile(locatedAt: player.position) //æ›´æ–°éšœç¢ç‰©çš„ç‰©ç†ä½“çŠ¶æ€
    updateHUD(currentTime: currentTime) //æ›´æ–°æ–‡å­—è¯´æ˜
    checkEndGame() //æ£€æŸ¥æ˜¯å¦è¾¾åˆ°èƒœè´Ÿæ¡ä»¶
  }

</code></pre>
</div>
<ul>
  <li>step13 æ›´æ–°æ€è™«å–·é›¾</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func updateBugspray() {
    guard let bugsprayTileMap = bugsprayTileMap else { return }
    let (column, row) = tileCoordinates(in: bugsprayTileMap,
                                        at: player.position)
    if tile(in: bugsprayTileMap, at: (column, row)) != nil {
      bugsprayTileMap.setTileGroup(nil, forColumn: column,
                                   row: row)
      player.hasBugspray = true
    }
  }
</code></pre>
</div>
<ul>
  <li>step14 æ›´æ–°éšœç¢ç‰©çš„ç‰©ç†ä½“çŠ¶æ€</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func advanceBreakableTile(locatedAt nodePosition: CGPoint) {
    guard let obstaclesTileMap = obstaclesTileMap else { return }
    // 1
    let (column, row) = tileCoordinates(in: obstaclesTileMap,
                                        at: nodePosition)
    // 2
    let obstacle = tile(in: obstaclesTileMap,
                        at: (column, row))
    //3
    guard let nextTileGroupName =
      obstacle?.userData?.object(forKey: "breakable") as? String
      else { return }
    // 4
    if let nextTileGroup =
      tileGroupForName(tileSet: obstaclesTileMap.tileSet,
                       name: nextTileGroupName) {
      obstaclesTileMap.setTileGroup(nextTileGroup, 
                                    forColumn: column, row: row) //è®¾ç½®æ–°çš„ç“¦ç‰‡ç»„åˆ°ç“¦ç‰‡åœ°å›¾ä¸­
    }
  }
</code></pre>
</div>
<ul>
  <li>step15 æ›´æ–°æ–‡å­—è¯´æ˜</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func updateHUD(currentTime: TimeInterval) {
    // 1
    if let startTime = startTime {
      // 2
      elapsedTime = Int(currentTime) - startTime
    } else {
      // 3
      startTime = Int(currentTime) - elapsedTime
    }
    // 4
    hud.updateTimer(time: timeLimit - elapsedTime) //å¯¹æ–‡å­—è¯´æ˜è¿›è¡Œæ›´æ–°
  }
</code></pre>
</div>

<ul>
  <li>step16 æ£€æŸ¥æ˜¯å¦è¾¾åˆ°èƒœè´Ÿæ¡ä»¶</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>  func checkEndGame() {
    if bugsNode.children.count == 0 { //æ˜¯å¦æ¶ˆç­å…¨éƒ¨å®³è™«
      player.physicsBody?.linearDamping = 1
      gameState = .win
    } else if timeLimit - elapsedTime &lt;= 0 { //æ˜¯å¦æ—¶é—´ç”¨å®Œ
      player.physicsBody?.linearDamping = 1
      gameState = .lose
    }
  }
</code></pre>
</div>
<ul>
  <li>step17 ç‰©ç†ä¸–ç•Œä»£ç†çš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>extension GameScene : SKPhysicsContactDelegate {
  func remove(bug: Bug) { //æ¶ˆç­å®³è™«
    bug.removeFromParent()
    background.addChild(bug)
    bug.die()
    hud.updateBugCount(with: bugsNode.children.count)
  }

  func didBegin(_ contact: SKPhysicsContact) {
    let other = contact.bodyA.categoryBitMask
      == PhysicsCategory.Player ?
        contact.bodyB : contact.bodyA
    
    switch other.categoryBitMask {
    case PhysicsCategory.Bug:
      if let bug = other.node as? Bug {
        remove(bug: bug) //å½“ç©å®¶æ¥è§¦åˆ°æ™®é€šå®³è™«, æ¶ˆç­æ™®é€šå®³è™«
      }
    case PhysicsCategory.Firebug:
      if player.hasBugspray {
        if let firebug = other.node as? Firebug {
          remove(bug: firebug)
          player.hasBugspray = false //å½“ç©å®¶æ‰‹æŒæ€è™«å–·é›¾æ¥è§¦é«˜çº§å®³è™«æ‰èƒ½æ¶ˆç­é«˜çº§å®³è™«
        }
      }
    case PhysicsCategory.Breakable:
      if let obstacleNode = other.node {
        // 1
        advanceBreakableTile(locatedAt: obstacleNode.position) //æ›´æ–°éšœç¢ç‰©
        // 2
        obstacleNode.removeFromParent() //åˆ é™¤åŸéšœç¢ç‰©
      }

    default:
      break
    }
    if let physicsBody = player.physicsBody {
      if physicsBody.velocity.length() &gt; 0 {
        player.checkDirection() //è¿›è¡Œç©å®¶æ–¹å‘çš„è®¾ç½®
      }
    }
  }
}

</code></pre>
</div>

<ul>
  <li>step18 è§‚å¯Ÿè€…çš„è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>extension GameScene {
  func applicationDidBecomeActive() {
    print("* applicationDidBecomeActive")
    if gameState == .pause {
      gameState = .reload //é‡æ–°è¿›å…¥, è¿›è¡Œæ¸¸æˆé‡è½½
    }
  }
  
  func applicationWillResignActive() {
    print("* applicationWillResignActive")
    isPaused = true
    if gameState != .lose {
      gameState = .pause  //æš‚åœæ¸¸æˆè¿›ç¨‹
    }
  }
  
  func applicationDidEnterBackground() {
    print("* applicationDidEnterBackground")
    if gameState != .lose {
      saveGame() //è¿›å…¥åå°ä¿å­˜æ¸¸æˆè¿›åº¦
    }
  }

  func addObservers() {
    NotificationCenter.default.addObserver(self,
                                           selector: #selector(applicationDidBecomeActive),
                                           name: .UIApplicationDidBecomeActive, object: nil)
    NotificationCenter.default.addObserver(self,
                                           selector: #selector(applicationWillResignActive),
                                           name: .UIApplicationWillResignActive, object: nil)
    NotificationCenter.default.addObserver(self,
                                           selector: #selector(applicationDidEnterBackground),
                                           name: .UIApplicationDidEnterBackground, object: nil)
  }

}
</code></pre>
</div>

<ul>
  <li>step19 æ¸¸æˆçš„å­˜å‚¨è®¾ç½®</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>extension GameScene {
  func saveGame() {
    // 1
    let fileManager = FileManager.default
    guard let directory =
      fileManager.urls(for: .libraryDirectory,
                       in: .userDomainMask).first
      else { return }
    // 2
    let saveURL = directory.appendingPathComponent("SavedGames")
    // 3
    do {
      try fileManager.createDirectory(atPath: saveURL.path,
                                      withIntermediateDirectories: true,
                                      attributes: nil)
    } catch let error as NSError {
      fatalError(
        "Failed to create directory: \(error.debugDescription)")
    }
    // 4
    let fileURL = saveURL.appendingPathComponent("saved-game")
    print("* Saving: \(fileURL.path)")
    // 5
    NSKeyedArchiver.archiveRootObject(self, toFile: fileURL.path) //æ–‡ä»¶å¤„ç†å™¨æ–°å»ºè·¯å¾„å¹¶å½’æ¡£
  }
  
  override func encode(with aCoder: NSCoder) { /å¯¹å…³é”®å±æ€§çš„å½’æ¡£
    aCoder.encode(firebugCount,
                  forKey: "Scene.firebugCount")
    aCoder.encode(elapsedTime,
                  forKey: "Scene.elapsedTime")
    aCoder.encode(gameState.rawValue,
                  forKey: "Scene.gameState")
    aCoder.encode(currentLevel,
                  forKey: "Scene.currentLevel")
    super.encode(with: aCoder)
  }

  class func loadGame() -&gt; SKScene? { //é‡æ–°åŠ è½½å­˜å‚¨æ¸¸æˆè¿›ç¨‹
    print("* loading game")
    var scene: SKScene?
    // 1
    let fileManager = FileManager.default
    guard let directory =
      fileManager.urls(for: .libraryDirectory,
                       in: .userDomainMask).first
      else { return nil }
    // 2
    let url = directory.appendingPathComponent(
      "SavedGames/saved-game")
    // 3
    if FileManager.default.fileExists(atPath: url.path) {
      scene = NSKeyedUnarchiver.unarchiveObject(  //æ ¹æ®è·¯å¾„è¿›è¡Œè§£æ¡£æ¸¸æˆè¿›ç¨‹
        withFile: url.path) as? GameScene
      _ = try? fileManager.removeItem(at: url)
    }
    return scene
  }

}

</code></pre>
</div>

<p>Notice: å¿½ç•¥äº†ä¸€äº›èŠ‚ç‚¹çš„è®¾ç½®, ä½†ä¸å½±å“ç“¦ç‰‡åœ°å›¾çš„ç†è§£.</p>

<h5 id="æ¼”ç¤ºæ•ˆæœ">æ¼”ç¤ºæ•ˆæœ:</h5>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-be56289d668241e4.gif?imageMogr2/auto-orient/strip" alt="" /></p>

<h5 id="about">About:</h5>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-3f8925783027b3fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è·³è½¬!!" /></p>

<p><a href="https://github.com/coderZsq/coderZsq.target.swift">ğŸŒŸ æºç  è¯·ç‚¹è¿™é‡ŒğŸŒŸÂ Â»&gt; å–œæ¬¢çš„æœ‹å‹è¯·ç‚¹å–œæ¬¢Â Â»&gt; ä¸‹è½½æºç çš„åŒå­¦è¯·é€ä¸‹å°æ˜Ÿæ˜ŸÂ Â»&gt; æœ‰é—²é’±çš„å£•ä»¬å¯ä»¥è¿›è¡Œæ‰“èµÂ Â»&gt; å°å¼Ÿä¼šå°½å¿«æ¨å‡ºæ›´å¥½çš„æ–‡ç« å’Œå¤§å®¶åˆ†äº«Â Â»&gt; ä½ çš„æ¿€åŠ±å°±æ˜¯æˆ‘çš„åŠ¨åŠ›!! </a></p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æœ€è¿‘çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/06/CoreData-SQL%E5%86%99%E7%83%A6%E4%BA%86-%E8%AF%95%E8%AF%95%E4%BA%B2%E5%84%BF%E5%AD%90!/" title="link to CoreData SQLå†™çƒ¦äº†? è¯•è¯•äº²å„¿å­!">CoreData SQLå†™çƒ¦äº†? è¯•è¯•äº²å„¿å­!</a></h2>
       <p class="excerpt">  ç›®å‰æ¥è¯´ iOSçš„æ•°æ®åº“ä¸€èˆ¬éƒ½ä½¿ç”¨FMDB, ä¹‹å‰çœ‹äº†ä¸‹æŒºç«çš„Rleam, ä»¥æˆ‘ç›®å‰çš„æ°´å¹³è¿˜åˆ†ä¸æ¸…æ¥šå„ç§ç§»åŠ¨æ•°æ®åº“å­°ä¼˜å­°åŠ£, ä»¥ä¸€èˆ¬è¦†ç›–80%çš„é¡µé¢ç¼“å­˜, ä¸ªäººæ„šè§ä½¿ç”¨å†™.plistçš„æ–¹å¼æœ€ä¸ºç®€å•æœ‰æ•ˆ, ä½†ä½œä¸ºiOSå¼€å‘è€…, æ€ä¹ˆèƒ½ä¸è¯•è¯•äº²å„¿å­Core Dataå‘¢?ä»æ¥æ²¡æœ‰çœ‹è¿‡Core Dataçš„æˆ‘, åªæ˜¯é“å¬é€”è¯´åº•å±‚ä¹Ÿæ˜¯SQLite, æ€§èƒ½ä¸å¥½, å­¦ä¹ æ›²çº¿é™¡å³­, è¯¶â€¦ å¬èµ·æ¥å°±å¾ˆä¸§, ä½†ä½œä¸ºäº²å„¿å­, å¦‚æ­¤ä¸æˆæ°”å€™, è«éæ˜¯åœ°ä¸»å®¶çš„å‚»å„¿å­? ä»iOS3 ~ iOS10 Appleè€çˆ¹è¿˜...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-06-08 15:52:00 +0800" class="post-list__meta--date date">2017-06-08</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/06/CoreData-SQL%E5%86%99%E7%83%A6%E4%BA%86-%E8%AF%95%E8%AF%95%E4%BA%B2%E5%84%BF%E5%AD%90!/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æ›´æ—©çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/05/SpriteKit-%E9%80%9A%E8%BF%87%E6%A3%80%E6%B5%8B%E6%8E%A9%E7%A0%81%E8%BF%9B%E8%A1%8C%E7%89%A9%E7%90%86%E8%AF%86%E5%88%AB/" title="link to SpriteKit é€šè¿‡æ£€æµ‹æ©ç è¿›è¡Œç‰©ç†è¯†åˆ«">SpriteKit é€šè¿‡æ£€æµ‹æ©ç è¿›è¡Œç‰©ç†è¯†åˆ«</a></h2>
       <p class="excerpt">  ä¸Šå‘¨å¿™ç€å†™ä»£ç ç”Ÿæˆå™¨äº†, å›åˆ°æˆ‘ä»¬çš„å­¦ä¹ ä¸­æ¥, ä»Šå¤©æˆ‘ä»¬æ¥ç»§ç»­å­¦ä¹ SpriteKit, ä¸Šç¯‡æˆ‘ä»¬å­¦ä¹ äº†ä¸€äº›2Dæ¸¸æˆåœºæ™¯, ç²¾çµ, æ‘„åƒå¤´, è¡ŒåŠ¨çš„åŸºæœ¬æ¦‚å¿µ, ä»Šå¤©æˆ‘ä»¬å°±æ¥è¿›å…¥ç‰©ç†çš„ä¸–ç•Œ, æ„Ÿå—ç¢°æ’æ‰€å¸¦æ¥çš„ä¹è¶£.ä»£ç è§:githubiOS7æœ‰å‡ºè¿‡UIDynamic, ç”¨äºUIVIewçš„ç‰©ç†åŠ¨ç”»æ•ˆæœ, åŒæœŸAppleä¹Ÿå‡ºäº†SpriteKitæ¡†æ¶, åˆ°ç°åœ¨ä¹Ÿå·²ç»3ä¸ªå¹´å¤´äº†, æˆ‘ä»¬å­¦ä¹ SpriteKitçš„ç›®çš„ä¹Ÿåœ¨äºæ›´å¥½çš„å¯¹UIKitè¿›è¡Œäº†è§£. ä¹Ÿç®—æ˜¯ä¸€æ¡æŠ€æœ¯è¿›é˜¶çš„è·¯å§, æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å­¦ä¹ ç‰©ç†...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-05-18 16:38:00 +0800" class="post-list__meta--date date">2017-05-18</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/05/SpriteKit-%E9%80%9A%E8%BF%87%E6%A3%80%E6%B5%8B%E6%8E%A9%E7%A0%81%E8%BF%9B%E8%A1%8C%E7%89%A9%E7%90%86%E8%AF%86%E5%88%AB/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… è®¸å¯åè®®</a></span>
        <span class="footer__copyright">ç”± <a href="https://jekyllrb.com">Jekyll</a> äº 2018-07-19 ç”Ÿæˆï¼Œæ„Ÿè°¢ <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> ä¸ºæœ¬ç«™æä¾›ç¨³å®šçš„ VPS æœåŠ¡</span>
        <span class="footer__copyright">æœ¬ç«™ç”± <a href="https://github.com/coderZsq">@Castie!</a> åˆ›å»ºï¼Œé‡‡ç”¨ <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> ä½œä¸ºä¸»é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ GitHub æ‰¾åˆ°<a href="https://github.com/onevcat/OneV-s-Den">æœ¬ç«™æºç </a> - &copy; 2018</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
