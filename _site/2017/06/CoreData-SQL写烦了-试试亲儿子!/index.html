<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Castie! Notes</title>
  <meta name="description" content="  ç›®å‰æ¥è¯´ iOSçš„æ•°æ®åº“ä¸€èˆ¬éƒ½ä½¿ç”¨FMDB, ä¹‹å‰çœ‹äº†ä¸‹æŒºç«çš„Rleam, ä»¥æˆ‘ç›®å‰çš„æ°´å¹³è¿˜åˆ†ä¸æ¸…æ¥šå„ç§ç§»åŠ¨æ•°æ®åº“å­°ä¼˜å­°åŠ£, ä»¥ä¸€èˆ¬è¦†ç›–80%çš„é¡µé¢ç¼“å­˜, ä¸ªäººæ„šè§ä½¿ç”¨å†™.plistçš„æ–¹å¼æœ€ä¸ºç®€å•æœ‰æ•ˆ, ä½†ä½œä¸ºiOSå¼€å‘è€…, æ€ä¹ˆèƒ½ä¸è¯•è¯•äº²å„¿å­Core Dataå‘¢?">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="CoreData SQLå†™çƒ¦äº†? è¯•è¯•äº²å„¿å­!">
  <meta name="twitter:description" content="  ç›®å‰æ¥è¯´ iOSçš„æ•°æ®åº“ä¸€èˆ¬éƒ½ä½¿ç”¨FMDB, ä¹‹å‰çœ‹äº†ä¸‹æŒºç«çš„Rleam, ä»¥æˆ‘ç›®å‰çš„æ°´å¹³è¿˜åˆ†ä¸æ¸…æ¥šå„ç§ç§»åŠ¨æ•°æ®åº“å­°ä¼˜å­°åŠ£, ä»¥ä¸€èˆ¬è¦†ç›–80%çš„é¡µé¢ç¼“å­˜, ä¸ªäººæ„šè§ä½¿ç”¨å†™.plistçš„æ–¹å¼æœ€ä¸ºç®€å•æœ‰æ•ˆ, ä½†ä½œä¸ºiOSå¼€å‘è€…, æ€ä¹ˆèƒ½ä¸è¯•è¯•äº²å„¿å­Core Dataå‘¢?">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="CoreData SQLå†™çƒ¦äº†? è¯•è¯•äº²å„¿å­!">
  <meta property="og:description" content="  ç›®å‰æ¥è¯´ iOSçš„æ•°æ®åº“ä¸€èˆ¬éƒ½ä½¿ç”¨FMDB, ä¹‹å‰çœ‹äº†ä¸‹æŒºç«çš„Rleam, ä»¥æˆ‘ç›®å‰çš„æ°´å¹³è¿˜åˆ†ä¸æ¸…æ¥šå„ç§ç§»åŠ¨æ•°æ®åº“å­°ä¼˜å­°åŠ£, ä»¥ä¸€èˆ¬è¦†ç›–80%çš„é¡µé¢ç¼“å­˜, ä¸ªäººæ„šè§ä½¿ç”¨å†™.plistçš„æ–¹å¼æœ€ä¸ºç®€å•æœ‰æ•ˆ, ä½†ä½œä¸ºiOSå¼€å‘è€…, æ€ä¹ˆèƒ½ä¸è¯•è¯•äº²å„¿å­Core Dataå‘¢?">
  
  <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
  <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/ico">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2017/06/CoreData-SQL%E5%86%99%E7%83%A6%E4%BA%86-%E8%AF%95%E8%AF%95%E4%BA%B2%E5%84%BF%E5%AD%90!/">
  <link rel="alternate" type="application/rss+xml" title="Castie!" href="http://localhost:4000/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="å‰å¾€ Castie! çš„ä¸»é¡µ" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Castie! logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Castie!" class="blog-button">Castie!</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">æ­£æ€åˆ†å¸ƒ, ä¼˜åŠ£ä¼´ç”Ÿ</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">åŒ—å†¥æœ‰é±¼ï¼Œå…¶åä¸ºé²²ï¼ˆkÅ«nï¼‰ã€‚é²²ä¹‹å¤§ï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›åŒ–è€Œä¸ºé¸Ÿï¼Œå…¶åä¸ºé¹ã€‚é¹ä¹‹èƒŒï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›æ€’è€Œé£ï¼Œå…¶ç¿¼è‹¥å‚å¤©ä¹‹äº‘ã€‚æ˜¯é¸Ÿä¹Ÿï¼Œæµ·è¿åˆ™å°†å¾™äºå—å†¥ã€‚å—å†¥è€…ï¼Œå¤©æ± ä¹Ÿã€‚</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description">åŒ—æµ·è‹¥æ›°ï¼šâ€œäº•é¼ƒä¸å¯ä»¥è¯­äºæµ·è€…ï¼Œæ‹˜äºè™šä¹Ÿï¼›å¤è™«ä¸å¯ä»¥è¯­äºå†°è€…ï¼Œç¬ƒäºæ—¶ä¹Ÿï¼›æ›²å£«ä¸å¯ä»¥è¯­äºé“è€…ï¼ŒæŸäºæ•™ä¹Ÿã€‚ä»Šå°”å‡ºäºå´–æ¶˜ï¼Œè§‚äºå¤§æµ·ï¼Œä¹ƒçŸ¥å°”ä¸‘ï¼Œå°”å°†å¯ä¸è¯­å¤§ç†çŸ£ã€‚</p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="è®¿é—®åšå®¢" class="blog-button">åšå®¢</a></li>
                
                  <li class="navigation__item"><a href="https://coderzsq.github.io/coderZsq.practice.web/" target="_blank" title="æˆ‘çš„ç®€å†">ç®€å†</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
    <!-- juejin-->
    <li class="navigation__item">
      <a href="https://juejin.im/user/57e735dfa22b9d00614eecb8/posts" title="@coderZsq çš„ç¨€åœŸæ˜é‡‘" target="_blank">
        <i class='social fa fa-book'></i>
        <span class="label">juejin</span>
      </a>
    </li>
    

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/coderZsq" title="@coderZsq çš„ Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:a13701777868@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-06-08 15:52:00 +0800" itemprop="datePublished" class="post-meta__date date">2017-06-08</time> &#8226; <span class="post-meta__tags tags">ç§»åŠ¨å¼€å‘</span>
    </div>
    <h1 class="post-title">CoreData SQLå†™çƒ¦äº†? è¯•è¯•äº²å„¿å­!</h1>
  </header>

  <section class="post">
    <blockquote>
  <p>ç›®å‰æ¥è¯´ iOSçš„æ•°æ®åº“ä¸€èˆ¬éƒ½ä½¿ç”¨FMDB, ä¹‹å‰çœ‹äº†ä¸‹æŒºç«çš„Rleam, ä»¥æˆ‘ç›®å‰çš„æ°´å¹³è¿˜åˆ†ä¸æ¸…æ¥šå„ç§ç§»åŠ¨æ•°æ®åº“å­°ä¼˜å­°åŠ£, ä»¥ä¸€èˆ¬è¦†ç›–80%çš„é¡µé¢ç¼“å­˜, ä¸ªäººæ„šè§ä½¿ç”¨å†™.plistçš„æ–¹å¼æœ€ä¸ºç®€å•æœ‰æ•ˆ, ä½†ä½œä¸ºiOSå¼€å‘è€…, æ€ä¹ˆèƒ½ä¸è¯•è¯•äº²å„¿å­Core Dataå‘¢?</p>
</blockquote>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-f0dbc8384ac301fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>ä»æ¥æ²¡æœ‰çœ‹è¿‡Core Dataçš„æˆ‘, åªæ˜¯é“å¬é€”è¯´åº•å±‚ä¹Ÿæ˜¯SQLite, æ€§èƒ½ä¸å¥½, å­¦ä¹ æ›²çº¿é™¡å³­, è¯¶â€¦ å¬èµ·æ¥å°±å¾ˆä¸§, ä½†ä½œä¸ºäº²å„¿å­, å¦‚æ­¤ä¸æˆæ°”å€™, è«éæ˜¯åœ°ä¸»å®¶çš„å‚»å„¿å­? ä»iOS3 ~ iOS10 Appleè€çˆ¹è¿˜ä¸€ç›´åœ¨æ¨, ObjC.io å’Œ Raywenderlichçš„äº²æˆšæœ‹å‹ä»¬è¿˜ä¸€ç›´å¸®å¿™å‡ºä¹¦? ç´ ä»¥é€»è¾‘ä¸¥è°¨çš„æˆ‘è¡¨ç¤ºç™¾æ€ä¸å¾—å…¶è§£, å¸¦ç€è¿™ä»½ç–‘æƒ‘, æˆ‘ä¹Ÿå°±æ¯…ç„¶å†³ç„¶çš„è¸ä¸Šäº†Core Dataè¸©å‘ä¹‹æ—….</p>

<h4 id="core-data-æ¶æ„">Core Data æ¶æ„</h4>

<p>ä¸€ä¸ªåŸºæœ¬çš„ Core Data æ ˆç”±å››ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆï¼šæ‰˜ç®¡å¯¹è±¡ (managed objects) (NSManagedObject)ï¼Œæ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡ (managed object context) (NSManagedObjectContext)ï¼ŒæŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨ (persistent store coordinator) (NSPersistentStoreCoordinator)ï¼Œä»¥åŠæŒä¹…åŒ–å­˜å‚¨ (persistent store) (NSPersistentStore), æˆ‘ä»¬åˆ†åˆ«çœ‹ä¸‹å¯¹åº”çš„API.</p>

<h6 id="nsmanagedobject">NSManagedObject:</h6>
<p>NSManagedObjectä»¥æˆ‘ç†è§£, å°±å¦‚åŒWWDC2017ä¸­å¼€æ”¾çš„Core MLçš„MLModelä¸€æ ·åº”è¯¥æ˜¯ä¸€ä¸ªæ¨¡å‹å¯¹è±¡, ç”¨ä»¥ç¼“å­˜æ•°æ®çš„æ¨¡å‹, Core Dataä¸­èƒ½ç¼“å­˜çš„æ•°æ®åªæœ‰ç»§æ‰¿è‡ªNSManagedObjectçš„æ‰å¯ä»¥, å’ŒRleamä¸€æ ·éœ€è¦å¯¹æ¨¡å‹å¯¹è±¡è¿›è¡Œæ ‡æ³¨, è¿™ä¹Ÿæ˜¯æˆ‘å¯¹Rleamæ— æ„Ÿçš„åŸå›  â€“ å¯¹ç¬¬ä¸‰æ–¹çš„è€¦åˆæ€§å¤ªå¼ºäº†!!</p>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 3.0, *)
open class NSManagedObject : NSObject 
@available(iOS 10.0, *)
    public init(entity: NSEntityDescription, insertInto context: NSManagedObjectContext?) //æ ¹æ®å®ä½“æè¿°åŠæ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡åˆ›å»ºæ‰˜ç®¡å¯¹è±¡
@available(iOS 10.0, *)
    open class func fetchRequest() -&gt; NSFetchRequest&lt;NSFetchRequestResult&gt; //è¿”å›å½“å‰æŸ¥è¯¢å¯¹è±¡
    public init(entity: NSEntityDescription, insertInto context: NSManagedObjectContext?) //é€šè¿‡å®ä½“åŠä¸Šä¸‹æ–‡è¿›è¡Œåˆå§‹åŒ–
@available(iOS 10.0, *)
    public convenience init(context moc: NSManagedObjectContext) //é€šè¿‡ä¸Šä¸‹æ–‡è¿›è¡Œåˆå§‹åŒ–
    unowned(unsafe) open var managedObjectContext: NSManagedObjectContext? { get } //å½“å‰å¯¹è±¡çš„ä¸Šä¸‹æ–‡
    open var objectID: NSManagedObjectID { get } //å½“å‰å¯¹è±¡ID
@available(iOS 5.0, *)
    open var hasChanges: Bool { get } //å½“å‰å¯¹è±¡ä¸­æ˜¯å¦æœ‰å±æ€§æ”¹å˜
    open func value(forKey key: String) -&gt; Any? //KVCå–å€¼
    open func setValue(_ value: Any?, forKey key: String) //KVCèµ‹å€¼
</code></pre>
</div>
<p>ä¸Šè¿°å…·ä½“åˆ†æ<code class="highlighter-rouge">NSManagedObject</code>ä¸­çš„å…³é”®å±æ€§åŠæ–¹æ³•, å¯ä»¥çœ‹åˆ°çš„æ˜¯, iOS10æ–°å¢çš„APIçš„æ•°é‡è¿˜æ˜¯å¾ˆå¤šçš„, è¿™ä¹Ÿä¾§è¾¹è¯æ˜äº†è€çˆ¹å¯¹å„¿å­çš„å…³å¿ƒä¸ç–¼çˆ±.</p>

<h6 id="nsmanagedobjectcontext">NSManagedObjectContext:</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 3.0, *)
open class NSManagedObjectContext : NSObject, NSCoding, NSLocking 
@available(iOS 5.0, *)
    open var parent: NSManagedObjectContext? //çˆ¶çº§ä¸Šä¸‹æ–‡
    open var hasChanges: Bool { get } //ä¸Šä¸‹æ–‡æ˜¯å¦æœ‰æ›´æ”¹
    open func save() throws //ä¿å­˜ä¸Šä¸‹æ–‡
    open func insert(_ object: NSManagedObject) //å°†æ‰˜ç®¡å¯¹è±¡æ’å…¥ä¸Šä¸‹æ–‡
    open func delete(_ object: NSManagedObject) //å°†æ‰˜ç®¡å¯¹è±¡ä»ä¸Šä¸‹æ–‡ä¸­åˆ é™¤
@available(iOS 8.0, *)
    open func execute(_ request: NSPersistentStoreRequest) throws -&gt; NSPersistentStoreResult //æ‰§è¡Œè·å–è¯·æ±‚
    public func fetch&lt;T : NSFetchRequestResult&gt;(_ request: NSFetchRequest&lt;T&gt;) throws -&gt; [T] //è·å–æ•°æ®
    @available(iOS 3.0, *)
</code></pre>
</div>
<h6 id="nspersistentstorecoordinator">NSPersistentStoreCoordinator:</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 3.0, *)
open class NSPersistentStoreCoordinator : NSObject, NSLocking 
   open var persistentStores: [NSPersistentStore] { get } //æŒç»­åŒ–å­˜å‚¨é›†
</code></pre>
</div>
<h6 id="nspersistentstore">NSPersistentStore:</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 3.0, *)
open class NSPersistentStore : NSObject
</code></pre>
</div>

<h4 id="core-data-åŸºæœ¬æ¦‚å¿µ">Core Data åŸºæœ¬æ¦‚å¿µ</h4>

<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªCore Dataæ–‡ä»¶ åç¼€åä¸º.xcdatamodeld, å›¾å½¢åŒ–ç•Œé¢é…ç½®å­˜å‚¨æ•°æ®, ç”±äºæ˜¯åŸºæœ¬ä½¿ç”¨, å°±ç®€å•çš„åˆ›å»ºä¸€ä¸ªPersonå®ä½“, Personå®ä½“ä¸­æœ‰ä¸€ä¸ªnameçš„å­—ç¬¦ä¸², å¦‚å›¾:
<img src="http://upload-images.jianshu.io/upload_images/1229762-e5dd9602ce3726f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Core Data æ–‡ä»¶ Personå®ä½“ä¸­æ·»åŠ ä¸€ä¸ªnameå±æ€§ ç®€å•è®¾ç½®" /></p>

<h6 id="nspersistentcontainer">NSPersistentContainer:</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 10.0, *)
open class NSPersistentContainer : NSObject
open var viewContext: NSManagedObjectContext { get } //æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡
public convenience init(name: String) //é€šè¿‡Bundleä¸­çš„åç§°æ¥åˆ›å»ºæŒä¹…åŒ–å®¹å™¨
open func loadPersistentStores(completionHandler block: @escaping (NSPersistentStoreDescription, Error?) -&gt; Swift.Void) //åŠ è½½æŒä¹…åŒ–å­˜å‚¨, å®Œæˆå›è°ƒ
open func performBackgroundTask(_ block: @escaping (NSManagedObjectContext) -&gt; Swift.Void) //åå°çº¿ç¨‹æ‰§è¡Œ
</code></pre>
</div>
<p>åœ¨æ­¤, æˆ‘ä»¬éœ€è¦äº‹å…ˆäº†è§£ä¸‹iOS10ä¸­Core Dataçš„æ–°ç‰¹æ€§<code class="highlighter-rouge">NSPersistentContainer</code></p>

<h6 id="nsentitydescription">NSEntityDescription:</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 3.0, *)
open class NSEntityDescription : NSObject, NSCoding, NSCopying, NSFastEnumeration
open class func entity(forEntityName entityName: String, in context: NSManagedObjectContext) -&gt; NSEntityDescription? //é€šè¿‡å®ä¾‹ååŠä¸Šä¸‹æ–‡è·å–å¯¹åº”å®ä¾‹æè¿°
</code></pre>
</div>

<h6 id="nsfetchrequest">NSFetchRequest:</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 3.0, *)
open class NSFetchRequest&lt;ResultType : NSFetchRequestResult&gt; : NSPersistentStoreRequest, NSCoding
@available(iOS 4.0, *)
    public convenience init(entityName: String) //é€šè¿‡å®ä¾‹ååˆ›å»ºæŠ“å–è¯·æ±‚
    open var predicate: NSPredicate? //è°“è¯, ç”¨äºæŸ¥è¯¢è¿‡æ»¤
    open var sortDescriptors: [NSSortDescriptor]? //è¿›è¡Œæ’åº
    open var propertiesToFetch: [Any]? //å±æ€§æŠ“å–
@available(iOS 3.0, *)
    open var resultType: NSFetchRequestResultType //è¿”å›çš„ç»“æœç±»å‹
</code></pre>
</div>

<h6 id="ç®€æ˜“-core-data-stack">ç®€æ˜“ Core Data Stack</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>  //æ‡’åŠ è½½ä¸€ä¸ªæŒä¹…åŒ–å®¹å™¨å±æ€§ 
  lazy var persistentContainer: NSPersistentContainer = {
    let container = NSPersistentContainer(name: "HitList") //æ ¹æ®åç§°å–å‡ºå¯¹åº”çš„æŒä¹…åŒ–å®¹å™¨
    container.loadPersistentStores(completionHandler: { (storeDescription, error) in //åŠ è½½æŒä¹…åŒ–å­˜å‚¨
      if let error = error as NSError? {
        fatalError("Unresolved error \(error), \(error.userInfo)")
      }
    })
    return container
  }()
</code></pre>
</div>
<h6 id="å®ç°-core-data-stack">å®ç° Core Data Stack</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>class CoreDataStack { //åˆ›å»ºCoreDataStackç±»ä»¥å¤‡å¤ç”¨

  private let modelName: String //CoreDataæ¨¡å‹åç§°, å¯¹åº”.xcdatamodeldæ–‡ä»¶å

  init(modelName: String) {
    self.modelName = modelName //åˆå§‹åŒ–æ–¹æ³•å¹¶èµ‹å€¼
  }

  lazy var managedContext: NSManagedObjectContext = { //æ‡’åŠ è½½æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡
    return self.storeContainer.viewContext
  }()

  private lazy var storeContainer: NSPersistentContainer = { //æ‡’åŠ è½½æŒç»­åŒ–å®¹å™¨

    let container = NSPersistentContainer(name: self.modelName)
    container.loadPersistentStores { (storeDescription, error) in
      if let error = error as NSError? {
        print("Unresolved error \(error), \(error.userInfo)")
      }
    }
    return container
  }()

  func saveContext () { //ä¿å­˜æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡
    guard managedContext.hasChanges else { return } //æ ¡éªŒæ˜¯å¦ä¸Šä¸‹æ–‡æœ‰æ‰€æ”¹å˜

    do {
      try managedContext.save() //è¿›è¡Œä¿å­˜
    } catch let error as NSError {
      print("Unresolved error \(error), \(error.userInfo)")
    }
  }
}
</code></pre>
</div>

<h6 id="ç®€å•æ¼”ç¤ºå¦‚ä½•å­˜å‚¨">ç®€å•æ¼”ç¤ºå¦‚ä½•å­˜å‚¨:</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>  var people: [NSManagedObject] = [] //åˆ›å»ºä¸€ä¸ªpeopleæ•°ç»„, æ•°ç»„å†…éƒ¨éƒ½æ˜¯æ‰˜ç®¡å¯¹è±¡Personå®ä¾‹
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>  //è¯»å–æ•°æ®
  let fetchRequest = NSFetchRequest&lt;NSManagedObject&gt;(entityName: "Person") //é€šè¿‡å®ä¾‹åå­—æŠ“å–æ•°æ®
  do {
    people = try managedContext.fetch(fetchRequest) //é€šè¿‡æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡è·å–æ•°æ®å¹¶èµ‹å€¼ç»™peopleæ•°ç»„
  } catch let error as NSError {
    print("Could not fetch. \(error), \(error.userInfo)")
  }
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>  //å­˜å‚¨æ•°æ®
  let entity = NSEntityDescription.entity(forEntityName: "Person", in: managedContext)! //é€šè¿‡å®ä¾‹ååŠæ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡è·å–å¯¹åº”å®ä¾‹æè¿°
  let person = NSManagedObject(entity: entity, insertInto: managedContext) //é€šè¿‡å®ä¾‹åŠæ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡åˆ›å»ºæ‰˜ç®¡å¯¹è±¡
  person.setValue(name, forKeyPath: "name") //é€šè¿‡KVCå°†æ–°å€¼èµ‹å€¼ç»™nameå±æ€§
  do {
    try managedContext.save() //ä¿å­˜æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡
    people.append(person) // å°†å®ä¾‹æ·»åŠ è‡³å®ä¾‹æ•°ç»„
  } catch let error as NSError { //å¦‚æœå­˜å‚¨å¤±è´¥æŠ›å‡ºå¼‚å¸¸
    print("Could not save. \(error), \(error.userInfo)")
  }
</code></pre>
</div>
<p>è¿™æ ·æˆ‘ä»¬å°±é€šè¿‡è¯»å–å’Œå­˜å‚¨, äº†è§£äº†Core Dataçš„åŸºæœ¬æ¦‚å¿µäº†, æ¯”èµ·å†™SQLè¿˜æ˜¯æ›´æœ‰çˆ±ä¸€ç‚¹~</p>

<h4 id="core-data-æ¨¡å‹åˆ¶ä½œ">Core Data æ¨¡å‹åˆ¶ä½œ</h4>
<p>ä¸Šä¸€ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬é€šè¿‡KVCçš„æ–¹å¼å–å€¼å’Œèµ‹å€¼, ä½†æˆ‘ä»¬çš„æ‰˜ç®¡å¯¹è±¡ä¸å¯èƒ½æ°¸è¿œåªæœ‰ä¸€ä¸ªå±æ€§, æ‰€ä»¥é€šè¿‡å­—ç¬¦ä¸²Keyæ¥å–å€¼çš„æ–¹æ³•å¾€å¾€ä¸æ˜¯æœ€ä½³æ–¹æ¡ˆ, æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ›´å¥½åœ°é¢å‘å¯¹è±¡, æˆ‘ä»¬å…ˆä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢ç”ŸæˆCore Dataæ¨¡å‹.</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-994472315fecb1fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Core Data æ–‡ä»¶, æ·»åŠ äº†å¾ˆå¤šå±æ€§, å…¶ä¸­Typeä¸ºTransformable æ˜¯æŒ‡å¯è½¬å˜ä¸ºå…¶ä»–ç±»å‹" /></p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-465ea4433fe427c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€šè¿‡Editor å¯ä»¥è¿›è¡Œåˆ›å»ºå¯¹åº”çš„swiftæ–‡ä»¶æ˜ å°„, å’ŒIBå¾ˆç±»ä¼¼" /></p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-12eb5d0d557eeb01.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åªéœ€è¦class ç±»ååŒ¹é…å³å¯" /></p>

<p>æˆ‘ä»¬å¯ä»¥å¦‚å›¾è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶, ä½†ObjC.ioçš„å»ºè®®æ˜¯è‡ªè¡Œè¾“å…¥ä¸ºä¸Š, å› ä¸ºå¹¶ä¸æ˜¯å¾ˆç¥å¥‡çš„ä¸œè¥¿, åªéœ€è¦class ç±»ååŒ¹é…å³å¯. ç”Ÿæˆçš„æ–‡ä»¶å¯ä»¥è‡ªè¡Œè¾“å…¥, Bowtieæ˜¯ç»§æ‰¿è‡ªNSManagedObjectçš„æ‰˜ç®¡å¯¹è±¡.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>extension Bowtie {

    @nonobjc public class func fetchRequest() -&gt; NSFetchRequest&lt;Bowtie&gt; {
        return NSFetchRequest&lt;Bowtie&gt;(entityName: "Bowtie");
    }

    @NSManaged public var isFavorite: Bool
    @NSManaged public var lastWorn: NSDate?
    @NSManaged public var name: String?
    @NSManaged public var photoData: NSData?
    @NSManaged public var searchKey: String?
    @NSManaged public var timesWorn: Int32
    @NSManaged public var tintColor: NSObject?
    @NSManaged public var rating: Double
}
</code></pre>
</div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è‡ªåŠ¨ç”Ÿæˆäº†å›¾å½¢åŒ–å·¥å…·ä¸­çš„å…¨éƒ¨å±æ€§, å¹¶åˆ›å»ºäº†æŠ“å–å‡½æ•°, æ–¹ä¾¿ä½¿ç”¨. æ³¨æ„ä¹‹å‰çš„Typeä¸ºTransformable, ç”Ÿæˆå‡ºæ¥å°±å˜æˆäº†NSObject?, å¯ä»¥åˆ†æå¾—çŸ¥, å¯è½¬å˜é¡¾åæ€ä¹‰, æ‰€æœ‰ç±»å‹éƒ½æ˜¯ç»§æ‰¿è‡ªNSObject, å½“ç„¶æ˜¯å¯¹äºObjetcive-Cæ¥è¯´, ä¸è¿‡å¯¹äºFoundationæ¡†æ¶ä¸­çš„ç±», Swiftä¹Ÿæ˜¯å¦‚æ­¤.</p>

<h4 id="core-data-å…³ç³»æ˜ å°„">Core Data å…³ç³»æ˜ å°„</h4>
<p>å­¦ä¼šäº†åˆ¶ä½œCore Dataæ¨¡å‹å, æˆ‘ä»¬å°±è¦æ¥è°ˆè°ˆå„ä¸ªå®ä¾‹ä¹‹é—´çš„å…³ç³»äº†, å„ä¸ªå®ä¾‹åŒ–ä¹‹é—´çš„å…³ç³»ä¹Ÿå¯ä»¥é€šè¿‡å›¾å½¢åŒ–ç•Œé¢æ¥å®ç°:</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-bf718c7920145bae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Dog å®ä¾‹ä¸­ ä¸Walkå®ä¾‹çš„å…³ç³» Type è®¾ç½®ä¸º To Many ä½œä¸ºé›†åˆ" /></p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-e011fd70b386aafe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Walk å®ä¾‹ä¸­ ä¸Dogå®ä¾‹çš„å…³ç³» Type è®¾ç½®ä¸º To One ä½œä¸ºå±æ€§" /></p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-c511b90e350d2970.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¾ç½®Inverse, éšå°„ä¸¤ä¸ªå®ä½“ä¹‹é—´çš„å¯¹åº”å…³ç³», å›¾ç¤ºåŒå‘ç®­å¤´è¡¨ç¤ºé›†åˆåµŒå¥—" /></p>

<h6 id="relationships-core-data-æ¨¡å‹">RelationShips Core Data æ¨¡å‹</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>extension Dog {

  @nonobjc public class func fetchRequest() -&gt; NSFetchRequest&lt;Dog&gt; {
    return NSFetchRequest&lt;Dog&gt;(entityName: "Dog");
  }

  @NSManaged public var name: String?
  @NSManaged public var walks: NSOrderedSet? //è¿™é‡Œä¸æ˜¯æ•°ç»„ç±»å‹, è€Œæ˜¯ç‰¹æ®Šçš„é›†åˆç±»å‹
}

// MARK: Generated accessors for walks
extension Dog { //ç”±äºRelationShipså…³ç³»æ˜ å°„ä¼šè‡ªåŠ¨ç”Ÿæˆé›†åˆå¢åˆ æ”¹æŸ¥é€»è¾‘

  @objc(insertObject:inWalksAtIndex:)
  @NSManaged public func insertIntoWalks(_ value: Walk, at idx: Int)

  @objc(removeObjectFromWalksAtIndex:)
  @NSManaged public func removeFromWalks(at idx: Int)

  @objc(insertWalks:atIndexes:)
  @NSManaged public func insertIntoWalks(_ values: [Walk], at indexes: NSIndexSet)

  @objc(removeWalksAtIndexes:)
  @NSManaged public func removeFromWalks(at indexes: NSIndexSet)

  @objc(replaceObjectInWalksAtIndex:withObject:)
  @NSManaged public func replaceWalks(at idx: Int, with value: Walk)

  @objc(replaceWalksAtIndexes:withWalks:)
  @NSManaged public func replaceWalks(at indexes: NSIndexSet, with values: [Walk])

  @objc(addWalksObject:)
  @NSManaged public func addToWalks(_ value: Walk)

  @objc(removeWalksObject:)
  @NSManaged public func removeFromWalks(_ value: Walk)

  @objc(addWalks:)
  @NSManaged public func addToWalks(_ values: NSOrderedSet)

  @objc(removeWalks:)
  @NSManaged public func removeFromWalks(_ values: NSOrderedSet)
}
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>extension Walk {

  @nonobjc public class func fetchRequest() -&gt; NSFetchRequest&lt;Walk&gt; {
    return NSFetchRequest&lt;Walk&gt;(entityName: "Walk");
  }

  @NSManaged public var date: NSDate?
  @NSManaged public var dog: Dog?
}
</code></pre>
</div>
<p>çœ‹åˆ°ç”Ÿæˆåçš„ä¸¤ä¸ªå®ä½“ä¹‹é—´çš„å…³ç³»ä¹Ÿå¾ˆå¥½ç†è§£, åªæ˜¯æœªæ˜¾ç¤ºNSOrderedSetä¸­åŒ…å«çš„å®ä½“ç±»å‹, è¿™ç‚¹åœ¨Swift4ä¸­å·²ç»æœ‰æ”¹å–„</p>

<h4 id="core-data-è·å–æ“ä½œ">Core Data è·å–æ“ä½œ</h4>

<p>ä¹‹å‰ä½¿ç”¨æ•°æ®åº“çš„æ—¶å€™, æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨SQLæŸ¥è¯¢è¯­å¥ , select å­—æ®µ from è¡¨ where ç­›é€‰æ¡ä»¶, è¿›è¡Œæ•°æ®çš„è¿‡æ»¤, è€Œæˆ‘ä»¬ä½¿ç”¨Core Dataçš„æ—¶å€™ç”¨ä»€ä¹ˆæ–¹æ³•å‘¢? é¦–å…ˆæˆ‘ä»¬å¯ä»¥å…ˆäº†è§£ä»¥ä¸‹ç±»:</p>

<h6 id="nspredicate-è°“è¯ç”¨äºç­›é€‰è¿‡æ»¤">NSPredicate è°“è¯ç”¨äºç­›é€‰è¿‡æ»¤</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 3.0, *)
open class NSPredicate : NSObject, NSSecureCoding, NSCopying 
    public /*not inherited*/ init(format predicateFormat: String, argumentArray arguments: [Any]?) //è°“è¯æ ¼å¼, ç”¨ä»¥è¿‡æ»¤ä¿¡æ¯
</code></pre>
</div>

<h6 id="nssortdescriptor-ç”¨äºæ•°æ®çš„æ’åº">NSSortDescriptor ç”¨äºæ•°æ®çš„æ’åº</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>open class NSSortDescriptor : NSObject, NSSecureCoding, NSCopying 
    public init(key: String?, ascending: Bool) //é€šè¿‡keyå€¼, è¿›è¡Œå‡åºæˆ–é™åºçš„æ’åº
</code></pre>
</div>

<h6 id="nsexpressiondescription-å¯¹æ²¡æœ‰å±æ€§åçš„æ•°æ®æ“ä½œ">NSExpressionDescription å¯¹æ²¡æœ‰å±æ€§åçš„æ•°æ®æ“ä½œ</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>  func populateDealsCountLabel() {

    let fetchRequest = NSFetchRequest&lt;NSDictionary&gt;(entityName: "Venue")
    fetchRequest.resultType = .dictionaryResultType //å°†è¿”å›ç»“æœè®¾ç½®ä¸ºå­—å…¸ç±»å‹

    let sumExpressionDesc = NSExpressionDescription() //ç”±äºæ˜¯å­—å…¸ç±»å‹å¹¶æ²¡æœ‰å†å›¾å½¢åŒ–ç•Œé¢ä¸­è®¾ç½®, æ•…éœ€è¦ä½¿ç”¨NSExpressionDescription
    sumExpressionDesc.name = "sumDeals"

    let specialCountExp = NSExpression(forKeyPath: #keyPath(Venue.specialCount)) //æ ¹æ®KVCè·å–å±æ€§å€¼
    sumExpressionDesc.expression = NSExpression(forFunction: "sum:", arguments: [specialCountExp])
    sumExpressionDesc.expressionResultType = .integer32AttributeType

    fetchRequest.propertiesToFetch = [sumExpressionDesc] //è¿›è¡Œè·å–

    do {
      let results = try coreDataStack.managedContext.fetch(fetchRequest)
      let resultDict = results.first!
      let numDeals = resultDict["sumDeals"]!
      numDealsLabel.text = "\(numDeals) total deals"

    } catch let error as NSError {
      print("Count not fetch \(error), \(error.userInfo)")
    }
  }
</code></pre>
</div>
<h6 id="nsbatchupdaterequest--nsasynchronousfetchrequest-æ‰¹é‡æ›´æ–°å’Œå¼‚æ­¥æ›´æ–°">NSBatchUpdateRequest &amp; NSAsynchronousFetchRequest æ‰¹é‡æ›´æ–°å’Œå¼‚æ­¥æ›´æ–°</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>  override func viewDidLoad() {
    super.viewDidLoad()

    let batchUpdate = NSBatchUpdateRequest(entityName: "Venue") //åˆå§‹åŒ–æ‰¹é‡æ›´æ–°
    batchUpdate.propertiesToUpdate = [#keyPath(Venue.favorite) : true] //æ›´æ–°çš„å±æ€§
    batchUpdate.affectedStores = coreDataStack.managedContext.persistentStoreCoordinator?.persistentStores //æŒä¹…åŒ–å­˜å‚¨
    batchUpdate.resultType = .updatedObjectsCountResultType //è®¾ç½®ç±»å‹

    do {
      let batchResult = try coreDataStack.managedContext.execute(batchUpdate) as! NSBatchUpdateResult
      print("Records updated \(batchResult.result!)")
    } catch let error as NSError {
      print("Could not update \(error), \(error.userInfo)")
    }
    
    fetchRequest = Venue.fetchRequest()

    asyncFetchRequest = NSAsynchronousFetchRequest&lt;Venue&gt;(fetchRequest: fetchRequest) { [unowned self] (result: NSAsynchronousFetchResult) in //å¼‚æ­¥è·å–

      guard let venues = result.finalResult else {
        return
      }

      self.venues = venues
      self.tableView.reloadData()
    }

    do {
      try coreDataStack.managedContext.execute(asyncFetchRequest)
    } catch let error as NSError {
      print("Could not fetch \(error), \(error.userInfo)")
    }
  }
</code></pre>
</div>

<h4 id="core-data-ä¸-tableview-åä½œ">Core Data ä¸ TableView åä½œ</h4>
<p>Core Dataä¸­æœ‰ä¸€ä¸ªç±»æ˜¯å’Œåˆ—è¡¨è§†å›¾åº¦èº«è®¢é€ çš„, é‚£å°±æ˜¯NSFetchedResultsController, å¯ä»¥å°†å®Œç¾çš„ä¸TableViewè¿›è¡Œç»“åˆ, æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å¸¸ç”¨çš„æ–¹æ³•:</p>

<h6 id="nsfetchedresultscontroller">NSFetchedResultsController</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>@available(iOS 3.0, *)
open class NSFetchedResultsController&lt;ResultType : NSFetchRequestResult&gt; : NSObject 
  public init(fetchRequest: NSFetchRequest&lt;ResultType&gt;, managedObjectContext context: NSManagedObjectContext, sectionNameKeyPath: String?, cacheName name: String?) //åˆå§‹åŒ–
  open func performFetch() throws //è·å–
  unowned(unsafe) open var delegate: NSFetchedResultsControllerDelegate? //ä»£ç†
  open func object(at indexPath: IndexPath) -&gt; ResultType //è·å–ç‰¹å®šå¯¹è±¡

public protocol NSFetchedResultsSectionInfo 
  public var numberOfObjects: Int { get } //è·å–å¯¹è±¡æ•°é‡
</code></pre>
</div>
<p>å…¶ä¸­sectionNameKeyPathå‚æ•°æ˜¯ä¼ å…¥æ ¹æ®ä»€ä¹ˆå­—æ®µè¿›è¡Œåˆ†ç»„, è€ŒcacheName, åˆ™æ˜¯è¿›è¡Œå†…å­˜ç¼“å­˜.</p>

<h6 id="ç®€å•æ¼”ç¤ºå¦‚ä½•æ“ä½œ">ç®€å•æ¼”ç¤ºå¦‚ä½•æ“ä½œ:</h6>
<div class="highlighter-rouge"><pre class="highlight"><code>  override func viewDidLoad() {
    super.viewDidLoad()

    let fetchRequest: NSFetchRequest&lt;Team&gt; = Team.fetchRequest()

    let zoneSort = NSSortDescriptor(key: #keyPath(Team.qualifyingZone), ascending: true)
    let scoreSort = NSSortDescriptor(key: #keyPath(Team.wins), ascending: false)
    let nameSort = NSSortDescriptor(key: #keyPath(Team.teamName), ascending: true)

    fetchRequest.sortDescriptors = [zoneSort, scoreSort, nameSort] //è¿›è¡Œä¸‰å±‚æ’åº

    fetchedResultsController = NSFetchedResultsController(fetchRequest: fetchRequest,
                                                          managedObjectContext: coreDataStack.managedContext,
                                                          sectionNameKeyPath: #keyPath(Team.qualifyingZone),
                                                          cacheName: "worldCup")

    fetchedResultsController.delegate = self //è®¾ç½®ä»£ç†

    do {
      try fetchedResultsController.performFetch() //è¿›è¡Œè·å–æ•°æ®
    } catch let error as NSError {
      print("Fetching error: \(error), \(error.userInfo)")
    }
  }
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>// MARK: - UITableViewDataSource
extension ViewController: UITableViewDataSource {

  func numberOfSections(in tableView: UITableView) -&gt; Int {
    guard let sections = fetchedResultsController.sections else { //sectionçš„æ•°é‡
      return 0
    }

    return sections.count
  }

  func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {

    guard let sectionInfo = fetchedResultsController.sections?[section] else { //rowçš„æ•°é‡
      return 0
    }

    return sectionInfo.numberOfObjects
  }

  func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {

    let cell = tableView.dequeueReusableCell(withIdentifier: teamCellIdentifier, for: indexPath)
    guard let cell = cell as? TeamCell else {
      return
    }

    let team = fetchedResultsController.object(at: indexPath) //æ‹¿åˆ°å¯¹åº”cellçš„æ•°æ®
    cell.flagImageView.image = UIImage(named: team.imageName!)
    cell.teamLabel.text = team.teamName
    cell.scoreLabel.text = "Wins: \(team.wins)"
    return cell
  }

  func tableView(_ tableView: UITableView, titleForHeaderInSection section: Int) -&gt; String? {
    let sectionInfo = fetchedResultsController.sections?[section]
    return sectionInfo?.name //æ‹¿åˆ°å¯¹è±¡çš„åå­—
  }
}

// MARK: - UITableViewDelegate
extension ViewController: UITableViewDelegate {

  func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {

    let team = fetchedResultsController.object(at: indexPath)
    team.wins = team.wins + 1 //ä¿®æ”¹æ•°æ®
    coreDataStack.saveContext() //å­˜å…¥Core Data
  }
}

</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>extension ViewController: NSFetchedResultsControllerDelegate {

  //å½“ä¸Šä¸‹æ–‡æ›´æ”¹å¼€å§‹å‰è°ƒç”¨
  func controllerWillChangeContent(_ controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;) {
    tableView.beginUpdates() //reloadDataè‡ªå®šä¹‰æ–¹æ³•å¼€å§‹
  }

  //å½“æ‰˜ç®¡å¯¹è±¡è¿›è¡Œæ”¹å˜æ—¶è°ƒç”¨
  func controller(_ controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;, didChange anObject: Any, at indexPath: IndexPath?, for type: NSFetchedResultsChangeType, newIndexPath: IndexPath?) {

    switch type {
    case .insert:
      tableView.insertRows(at: [newIndexPath!], with: .automatic)
    case .delete:
      tableView.deleteRows(at: [indexPath!], with: .automatic)
    case .update:
      let cell = tableView.cellForRow(at: indexPath!) as! TeamCell
      configure(cell: cell, for: indexPath!)
    case .move:
      tableView.deleteRows(at: [indexPath!], with: .automatic)
      tableView.insertRows(at: [newIndexPath!], with: .automatic)
    }
  }
  
  //å½“ä¸Šä¸‹æ–‡æ›´æ”¹ç»“æŸåè°ƒç”¨
  func controllerDidChangeContent(_ controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;) {
    tableView.endUpdates()  //reloadDataè‡ªå®šä¹‰æ–¹æ³•ç»“æŸ
  }

  //å½“ç»„ä¿¡æ¯è¿›è¡Œæ”¹å˜çš„æ—¶å€™è°ƒç”¨
  func controller(_ controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;, didChange sectionInfo: NSFetchedResultsSectionInfo, atSectionIndex sectionIndex: Int, for type: NSFetchedResultsChangeType) {

    let indexSet = IndexSet(integer: sectionIndex)

    switch type {
    case .insert:
      tableView.insertSections(indexSet, with: .automatic)
    case .delete:
      tableView.deleteSections(indexSet, with: .automatic)
    default: break
    }
  }
}
</code></pre>
</div>
<p>ä»¥ä¸Šå°±æ˜¯Core Dataçš„å­¦ä¹ æ¦‚è¦, å½“ç„¶è¿˜æœ‰æ›´é‡è¦çš„Core Dataçš„è¿ç§»åŠçˆ¶å­ä¸Šä¸‹æ–‡å’Œçº¿ç¨‹å¹¶å‘é—®é¢˜ç­‰æ²¡æœ‰è®²åˆ°, å½“ç„¶è¿™äº›æ·±å±‚çš„ä¸œè¥¿è¿˜éœ€è¦æ…¢æ…¢çš„ç ”ç©¶, è¿˜æ˜¯ä¹‹å‰çš„ä¸€å¥è¯ â€“ ä¸€èˆ¬è¦†ç›–80%çš„é¡µé¢ç¼“å­˜, ä¸ªäººæ„šè§ä½¿ç”¨å†™.plistçš„æ–¹å¼æœ€ä¸ºç®€å•æœ‰æ•ˆ.</p>

<p><a href="https://github.com/coderZsq/coderZsq.target.swift">ğŸŒŸ æƒ³è¦å…³æ³¨ä½œè€… è¯·ç‚¹è¿™é‡ŒğŸŒŸÂ Â»&gt; å–œæ¬¢çš„æœ‹å‹è¯·ç‚¹å–œæ¬¢Â Â»&gt; ä¸‹è½½æºç çš„åŒå­¦è¯·é€ä¸‹å°æ˜Ÿæ˜ŸÂ Â»&gt; æœ‰é—²é’±çš„å£•ä»¬å¯ä»¥è¿›è¡Œæ‰“èµÂ Â»&gt; å°å¼Ÿä¼šå°½å¿«æ¨å‡ºæ›´å¥½çš„æ–‡ç« å’Œå¤§å®¶åˆ†äº«Â Â»&gt; ä½ çš„æ¿€åŠ±å°±æ˜¯æˆ‘çš„åŠ¨åŠ›!! </a></p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æœ€è¿‘çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/06/SceneKit-%E4%B8%8D%E4%BC%9A-Unity3D-%E7%9A%84%E5%8F%A6%E4%B8%80%E7%A7%8D%E9%80%89%E6%8B%A9/" title="link to SceneKit ä¸ä¼š Unity3D çš„å¦ä¸€ç§é€‰æ‹©">SceneKit ä¸ä¼š Unity3D çš„å¦ä¸€ç§é€‰æ‹©</a></h2>
       <p class="excerpt">  ä¸Šå‘¨ä¸€, ç›¸ä¿¡å¾ˆå¤šäººå’Œæˆ‘ä¸€æ ·, å…¨ç¨‹è§‚çœ‹äº†WWDC2017çš„å¼€å‘è€…å¤§ä¼š, å…¶ä¸­è™½ç„¶äº®ç‚¹å¹³å¹³ä½†ä¹Ÿèƒ½äº›è®¸çš„çœ‹å‡ºè‹¹æœæœªæ¥çš„æˆ˜ç•¥, è™½ç„¶å·²ç»ä»å…ˆé©±è€…å˜æˆè·Ÿéšè€…, ä½†å¼ºè€…æ’å¼ºçš„é“ç†æ˜¯äº˜å¤ä¸å˜çš„çœŸç†, è€Œä¸”åœ¨ç”Ÿæ€é“¾çš„å»ºè®¾ä¸Šä¹Ÿæ˜¯æ— äººèƒ½å‡ºå…¶å³, è™½ç„¶åœ¨æ¶ˆè´¹è€…çœ¼ä¸­æœ€ä¸ºå…³æ³¨çš„æ˜¯HomePodå’ŒiPad Pro10.5, è€Œåœ¨å¼€å‘è€…çœ¼ä¸­ä¸ºä¹‹çœ¼å‰ä¸€äº®çš„åˆ™æ˜¯ARKitå’ŒCore ML.Core ML åˆšå‘å¸ƒçš„æ—¶å€™è¿˜ä»¥ä¸ºæ˜¯ç»ˆäºèƒ½ç”¨Swiftè¿›è¡Œæ¨¡å‹çš„è®­ç»ƒäº†, ç»ˆäºä¸ç”¨å­¦ä¹ ç¼©è¿›åœ°ç‹±çš„Pythonäº†, ç„¶è€Œè¿™ä»…ä»…æ˜¯ä¸€...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-06-12 15:14:00 +0800" class="post-list__meta--date date">2017-06-12</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/06/SceneKit-%E4%B8%8D%E4%BC%9A-Unity3D-%E7%9A%84%E5%8F%A6%E4%B8%80%E7%A7%8D%E9%80%89%E6%8B%A9/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æ›´æ—©çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/05/SpriteKit-%E7%93%A6%E7%89%87%E5%9C%B0%E5%9B%BE%E4%BB%80%E4%B9%88%E7%9A%84%E8%BF%98%E6%8C%BA%E5%A5%BD%E7%8E%A9%E5%84%BF/" title="link to SpriteKit ç“¦ç‰‡åœ°å›¾ä»€ä¹ˆçš„è¿˜æŒºå¥½ç©å„¿">SpriteKit ç“¦ç‰‡åœ°å›¾ä»€ä¹ˆçš„è¿˜æŒºå¥½ç©å„¿</a></h2>
       <p class="excerpt">  è¯´å®è¯è¿™ä¸ª2Dæ¸¸æˆå®æˆ˜çš„å…¥é—¨çœ‹çš„æˆ‘è„‘æµ†å­éƒ½æ²¸è…¾äº†, å¥½å¤šæ–°çš„æ¦‚å¿µæ¶Œå…¥, æ²¡åšè¿‡æ¸¸æˆå¼€å‘çš„æˆ‘è¡¨ç¤ºçœŸçš„éš¾ä»¥æ¥å—, å¸æ”¶æ•ˆç‡ä¸ä¹‹å‰ç›¸æ¯”ä¹Ÿä¸‹é™å¥½å¤š, ä¸è¿‡è¶Šå¾€åå­¦, å°±èƒ½å¤ŸåŠ æ·±å¯¹ä¹‹å‰çŸ¥è¯†çš„æŒæ¡, è¿™å¯èƒ½ä¹Ÿæ˜¯çœ‹ä¹¦çš„å¥½å¤„å§, ä»Šå¤©æˆ‘ä¹ŸæŠŠå¯¹ç“¦ç‰‡åœ°å›¾çš„ä¸€äº›å­¦ä¹ ç»éªŒè®°å½•ä¸‹æ¥ä¾›å¤§å®¶æ¢è®¨.ä»£ç è§:githubè¯´å®è¯, æˆ‘å¾ˆæ¨èRayå®¶çš„èµ„æº, ç”±æµ…å…¥æ·±æ‰‹æŠŠæ‰‹çš„æ•™å­¦, å†…å®¹å‰åå‘¼åº”, çœ‹å‡ æœ¬ä¹¦å°±èƒ½æ¶µç›–å›½å†…4ä¸ªæœˆåŸ¹è®­ç­çš„è¯¾ç¨‹ä½“ç³». éµå¾ªæœ¬ç³»åˆ—ä¸€è´¯çš„é£æ ¼, æˆ‘ä»¬è¿˜æ˜¯ä»åŸºç¡€çš„APIå¼€å§‹çœ‹èµ·, å¯¹APIæŒæ¡ç†Ÿç»ƒçš„è¯,...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-05-24 11:49:00 +0800" class="post-list__meta--date date">2017-05-24</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/05/SpriteKit-%E7%93%A6%E7%89%87%E5%9C%B0%E5%9B%BE%E4%BB%80%E4%B9%88%E7%9A%84%E8%BF%98%E6%8C%BA%E5%A5%BD%E7%8E%A9%E5%84%BF/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… è®¸å¯åè®®</a></span>
        <span class="footer__copyright">ç”± <a href="https://jekyllrb.com">Jekyll</a> äº 2018-08-23 ç”Ÿæˆï¼Œæ„Ÿè°¢ <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> ä¸ºæœ¬ç«™æä¾›ç¨³å®šçš„ VPS æœåŠ¡</span>
        <span class="footer__copyright">æœ¬ç«™ç”± <a href="https://github.com/coderZsq">@Castie!</a> åˆ›å»ºï¼Œé‡‡ç”¨ <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> ä½œä¸ºä¸»é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ GitHub æ‰¾åˆ°<a href="https://github.com/onevcat/OneV-s-Den">æœ¬ç«™æºç </a> - &copy; 2018</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
