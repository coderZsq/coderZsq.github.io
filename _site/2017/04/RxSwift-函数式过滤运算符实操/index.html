<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Castie! Notes</title>
  <meta name="description" content="  æ¥ç€ä¸Šä¸€éƒ¨åˆ†, æˆ‘ä»¬å·²ç»å®Œæˆäº†å‡½æ•°å¼ç¼–ç¨‹çš„ç®€å•å®è·µ, ä¹ŸåŒæ—¶æ¥è§¦äº†Photosæ¡†æ¶å¸¦æ¥çš„è‡ªå®šä¹‰çš„ä¾¿åˆ©, ä¸»è¦ç†Ÿæ‚‰äº†Variable, Subject ä½œä¸º Observable è¿›è¡Œè®¢é˜… subscribe å¹¶é€šè¿‡å¤„ç½®åŒ…DisposeBag å¤„ç†çš„å…·ä½“æ¡ˆä¾‹, è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è¿›ä¸€æ­¥å®Œå–„ç›¸ç‰‡æ‹¼å›¾. ä»£ç è§:github">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="RxSwift å‡½æ•°å¼è¿‡æ»¤è¿ç®—ç¬¦å®æ“">
  <meta name="twitter:description" content="  æ¥ç€ä¸Šä¸€éƒ¨åˆ†, æˆ‘ä»¬å·²ç»å®Œæˆäº†å‡½æ•°å¼ç¼–ç¨‹çš„ç®€å•å®è·µ, ä¹ŸåŒæ—¶æ¥è§¦äº†Photosæ¡†æ¶å¸¦æ¥çš„è‡ªå®šä¹‰çš„ä¾¿åˆ©, ä¸»è¦ç†Ÿæ‚‰äº†Variable, Subject ä½œä¸º Observable è¿›è¡Œè®¢é˜… subscribe å¹¶é€šè¿‡å¤„ç½®åŒ…DisposeBag å¤„ç†çš„å…·ä½“æ¡ˆä¾‹, è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è¿›ä¸€æ­¥å®Œå–„ç›¸ç‰‡æ‹¼å›¾. ä»£ç è§:github">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="RxSwift å‡½æ•°å¼è¿‡æ»¤è¿ç®—ç¬¦å®æ“">
  <meta property="og:description" content="  æ¥ç€ä¸Šä¸€éƒ¨åˆ†, æˆ‘ä»¬å·²ç»å®Œæˆäº†å‡½æ•°å¼ç¼–ç¨‹çš„ç®€å•å®è·µ, ä¹ŸåŒæ—¶æ¥è§¦äº†Photosæ¡†æ¶å¸¦æ¥çš„è‡ªå®šä¹‰çš„ä¾¿åˆ©, ä¸»è¦ç†Ÿæ‚‰äº†Variable, Subject ä½œä¸º Observable è¿›è¡Œè®¢é˜… subscribe å¹¶é€šè¿‡å¤„ç½®åŒ…DisposeBag å¤„ç†çš„å…·ä½“æ¡ˆä¾‹, è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è¿›ä¸€æ­¥å®Œå–„ç›¸ç‰‡æ‹¼å›¾. ä»£ç è§:github">
  
  <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
  <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/ico">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E8%BF%87%E6%BB%A4%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/">
  <link rel="alternate" type="application/rss+xml" title="Castie!" href="http://localhost:4000/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="å‰å¾€ Castie! çš„ä¸»é¡µ" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Castie! logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Castie!" class="blog-button">Castie!</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">æ­£æ€åˆ†å¸ƒ, ä¼˜åŠ£ä¼´ç”Ÿ</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">åŒ—å†¥æœ‰é±¼ï¼Œå…¶åä¸ºé²²ï¼ˆkÅ«nï¼‰ã€‚é²²ä¹‹å¤§ï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›åŒ–è€Œä¸ºé¸Ÿï¼Œå…¶åä¸ºé¹ã€‚é¹ä¹‹èƒŒï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›æ€’è€Œé£ï¼Œå…¶ç¿¼è‹¥å‚å¤©ä¹‹äº‘ã€‚æ˜¯é¸Ÿä¹Ÿï¼Œæµ·è¿åˆ™å°†å¾™äºå—å†¥ã€‚å—å†¥è€…ï¼Œå¤©æ± ä¹Ÿã€‚</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description">åŒ—æµ·è‹¥æ›°ï¼šâ€œäº•é¼ƒä¸å¯ä»¥è¯­äºæµ·è€…ï¼Œæ‹˜äºè™šä¹Ÿï¼›å¤è™«ä¸å¯ä»¥è¯­äºå†°è€…ï¼Œç¬ƒäºæ—¶ä¹Ÿï¼›æ›²å£«ä¸å¯ä»¥è¯­äºé“è€…ï¼ŒæŸäºæ•™ä¹Ÿã€‚ä»Šå°”å‡ºäºå´–æ¶˜ï¼Œè§‚äºå¤§æµ·ï¼Œä¹ƒçŸ¥å°”ä¸‘ï¼Œå°”å°†å¯ä¸è¯­å¤§ç†çŸ£ã€‚</p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="è®¿é—®åšå®¢" class="blog-button">åšå®¢</a></li>
                
                  <li class="navigation__item"><a href="https://coderzsq.github.io/coderZsq.practice.web/" target="_blank" title="æˆ‘çš„ç®€å†">ç®€å†</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
    <!-- juejin-->
    <li class="navigation__item">
      <a href="https://juejin.im/user/57e735dfa22b9d00614eecb8/posts" title="@coderZsq çš„ç¨€åœŸæ˜é‡‘" target="_blank">
        <i class='social fa fa-book'></i>
        <span class="label">juejin</span>
      </a>
    </li>
    

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/coderZsq" title="@coderZsq çš„ Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:a13701777868@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-04-19 11:50:00 +0800" itemprop="datePublished" class="post-meta__date date">2017-04-19</time> &#8226; <span class="post-meta__tags tags">ç§»åŠ¨å¼€å‘</span>
    </div>
    <h1 class="post-title">RxSwift å‡½æ•°å¼è¿‡æ»¤è¿ç®—ç¬¦å®æ“</h1>
  </header>

  <section class="post">
    <blockquote>
  <p>æ¥ç€ä¸Šä¸€éƒ¨åˆ†, æˆ‘ä»¬å·²ç»å®Œæˆäº†å‡½æ•°å¼ç¼–ç¨‹çš„ç®€å•å®è·µ, ä¹ŸåŒæ—¶æ¥è§¦äº†<code class="highlighter-rouge">Photos</code>æ¡†æ¶å¸¦æ¥çš„è‡ªå®šä¹‰çš„ä¾¿åˆ©, ä¸»è¦ç†Ÿæ‚‰äº†<code class="highlighter-rouge">Variable</code>, <code class="highlighter-rouge">Subject</code> ä½œä¸º <code class="highlighter-rouge">Observable</code> è¿›è¡Œè®¢é˜… <code class="highlighter-rouge">subscribe</code> å¹¶é€šè¿‡å¤„ç½®åŒ…<code class="highlighter-rouge">DisposeBag</code> å¤„ç†çš„å…·ä½“æ¡ˆä¾‹, è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è¿›ä¸€æ­¥å®Œå–„ç›¸ç‰‡æ‹¼å›¾. ä»£ç è§:<a href="https://github.com/coderZsq/coderZsq.target.swift">github</a></p>
</blockquote>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-a67b7f2ab21d4b23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>æœ¬èŠ‚æ‰€éœ€çš„ä¸€äº›å…³äºè®¢é˜…ä¿¡æ¯è¿‡æ»¤çš„åŸºæœ¬çŸ¥è¯†å·²ç»æ›´æ–°åˆ°<a href="https://github.com/coderZsq/coderZsq.target.swift">github</a>ä»£ç ä¸­çš„playgroundæ–‡ä»¶ä¸­, æ²¡æœ‰æ¥è§¦è¿‡å“åº”å¼ç¼–ç¨‹çš„åŒå­¦è¯·å’Œä¹‹å‰ä¸€æ ·å…ˆè¡Œåœ¨<a href="https://github.com/coderZsq/coderZsq.target.swift/blob/master/AlbumPuzzle/AlbumPuzzle.playground/Contents.swift">playground</a>ä¸­äº†è§£æ¦‚è¦ä»¥ä¾¿æ›´å¥½çš„ç†è§£æœ¬æ–‡. åœ¨è¿›è¡Œå¯¹é¡¹ç›®çš„å®Œå–„ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªé—®é¢˜:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>example(of: "Sharing subscription") {
    
    var start = 0
    func getStartNumber() -&gt; Int {
        start += 1
        return start
    }
    
    let numbers = Observable&lt;Int&gt;.create { observer in
        
        let start = getStartNumber()
        observer.onNext(start)
        observer.onNext(start+1)
        observer.onNext(start+2)
        observer.onCompleted()
        return Disposables.create()
    }
    
    numbers.subscribe(
        onNext: { el in
            print("element [\(el)]")
        },
        onCompleted: {
            print("---------------")
        }
    )
    
    numbers.subscribe(
        onNext: { el in
            print("element [\(el)]")
        },
        onCompleted: {
            print("---------------")
        }
    )
}

---Example of: Sharing subscription ---
element [1]
element [2]
element [3]
---------------
element [2]
element [3]
element [4]
---------------

</code></pre>
</div>
<p>åŒæ ·æ˜¯å¯¹äºå¯è§‚å¯Ÿå¯¹è±¡è¿›è¡Œè®¢é˜…ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸¤ç§ä¸åŒçš„ç»“æœ? é—®é¢˜æ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨subscribeï¼ˆâ€¦ï¼‰æ—¶ï¼Œéƒ½ä¼šä¸ºè¯¥è®¢é˜…åˆ›å»ºä¸€ä¸ªæ–°çš„Observableï¼Œå¹¶ä¸”æ¯ä¸ªå‰¯æœ¬ä¸èƒ½ä¿è¯ä¸ä¹‹å‰çš„ç›¸åŒã€‚ å³ä½¿Observableç¡®å®äº§ç”Ÿäº†ç›¸åŒçš„å…ƒç´ åºåˆ—ï¼Œä¸ºæ¯ä¸ªè®¢é˜…ç”Ÿæˆç›¸åŒçš„é‡å¤å…ƒç´ ä¹Ÿæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p>

<div class="highlighter-rouge"><pre class="highlight"><code>example(of: "Sharing subscription Fix") {
        
    var start = 0
    func getStartNumber() -&gt; Int {
        start += 1
        return start
    }
    
    let numbers = Observable&lt;Int&gt;.create { observer in
        
        let start = getStartNumber()
        observer.onNext(start)
        observer.onNext(start+1)
        observer.onNext(start+2)
        observer.onCompleted()
        return Disposables.create()
    }
    
    let shareNumbers = numbers.share()
    
    shareNumbers.subscribe(
        onNext: { el in
            print("element [\(el)]")
        },
        onCompleted: {
            print("---------------")
        }
    )
    
    shareNumbers.subscribe(
        onNext: { el in
            print("element [\(el)]")
        },
        onCompleted: {
            print("---------------")
        }
    )
}

---Example of: Sharing subscription Fix ---
element [1]
element [2]
element [3]
---------------
---------------
</code></pre>
</div>
<p>å¦‚æœéœ€è¦è¿›è¡Œå…±äº«è®¢é˜…ï¼Œå¯ä»¥ä½¿ç”¨shareï¼ˆï¼‰è¿ç®—ç¬¦ã€‚ Rxä»£ç ä¸­çš„å¸¸è§æ¨¡å¼æ˜¯é€šè¿‡è¿‡æ»¤æ¯ä¸ªç»“æœä¸­çš„ä¸åŒå…ƒç´ æ¥ä»åŒä¸€ä¸ªæºä¸­åˆ›å»ºå‡ ä¸ªåºåˆ—ã€‚</p>

<p>å›åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ¥çœ‹å¦‚ä½•å°†share()è¿ç®—ç¬¦è¿ç”¨çš„å®é™…, å°†ViewControllerä¸­çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>class ViewController: UIViewController {
    ...
    fileprivate var imageCache = [Int]() //update
    ...
}
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>    //update
    fileprivate func updateNavigationIcon() {
        let icon = imagePreview.image?.scaled(CGSize(width: 22, height: 22)).withRenderingMode(.alwaysOriginal)
        navigationItem.leftBarButtonItem = UIBarButtonItem(image: icon, style: .done, target: nil, action: nil)
    }
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>    @IBAction func actionAdd() {
//        images.value.append(UIImage(named: "Castie!")!)
        
        let albumViewController = storyboard?.instantiateViewController(withIdentifier: "AlbumViewController") as! AlbumViewController
        
        //update
        let newImages = albumViewController.selectedImages.share()

        newImages.takeWhile { [weak self] image in
                return (self?.images.value.count ?? 0) &lt; 6
            }.filter { newImage in
                return newImage.size.width &gt; newImage.size.height
            }.filter { [weak self] newImage in
                let len = UIImagePNGRepresentation(newImage)?.count ?? 0
                guard self?.imageCache.contains(len) == false else { return false }
                self?.imageCache.append(len)
                return true
            }.subscribe(
                
            onNext: { [weak self] newImage in
                guard let images = self?.images else { return }
                images.value.append(newImage)
            },
            onDisposed: {
                print("completed photo selection")
            }
                
        ).addDisposableTo(albumViewController.bag)
        
        newImages.ignoreElements().subscribe(
            onCompleted: { [weak self] in
            self?.updateNavigationIcon()
        }).addDisposableTo(albumViewController.bag)
        
        navigationController?.pushViewController(albumViewController, animated: true)
    }
    
    @IBAction func actionClear() {
        images.value = []
        //update
        imageCache = []
    }

</code></pre>
</div>
<p>æˆ‘ä»¬æ¥å…·ä½“åˆ†æ<code class="highlighter-rouge">actionAdd()</code> è¿™æ®µä»£ç , é¦–å…ˆ, æˆ‘ä»¬é€šè¿‡<code class="highlighter-rouge">share()</code>æ“ä½œç¬¦å¯¹å¯è§‚å¯Ÿå¯¹è±¡è¿›è¡Œè®¢é˜…å…±äº«<code class="highlighter-rouge">takeWhile()</code>æ“ä½œç¬¦å°†å¾—åˆ°çš„è®¢é˜…ä¿¡æ¯è¿›è¡Œè¿‡æ»¤, è¿”å›æœ€å¤§å…­å¼ å›¾ç‰‡å’Œä¹‹å‰å¯¹ç‚¹å‡»æŒ‰é’®çš„å±è”½é€»è¾‘è¿›è¡Œäº†å¯¹åº”, <code class="highlighter-rouge">filter()</code>æ“ä½œç¬¦å°±æ˜¯ä¼ ç»Ÿçš„å‡½æ•°å¼è¿‡æ»¤, è¿”å›å›¾ç‰‡å®½åº¦å¤§äºé«˜åº¦çš„å›¾ç‰‡åŠé€šè¿‡å›¾ç‰‡å­—èŠ‚æ•°å’Œç¼“å­˜æ± ä¸­çš„å­—èŠ‚æ•°åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å¼ å›¾ç‰‡. è¿™é‡Œæˆ‘ä»¬æ–°åŠ äº†ä¸€ä¸ªè®¢é˜… <code class="highlighter-rouge">ignoreElements()</code> æ“ä½œç¬¦æ˜¯å¿½ç•¥æ‰€æœ‰çš„<code class="highlighter-rouge">onNext()</code>äº‹ä»¶, åªæ¥æ”¶<code class="highlighter-rouge">onCompleted ()</code>äº‹ä»¶. UIå±‚é¢æˆ‘ä»¬åœ¨å·¦ä¸Šè§’æ·»åŠ äº†ä¸€ä¸ªå¯¹åº”å›¾ç‰‡çš„ç¼©ç•¥å›¾.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    //update
    override func viewWillDisappear(_ animated: Bool) {
        super.viewWillDisappear(animated)
        selectedImagesSubject.onCompleted()
    }
</code></pre>
</div>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦å¯¹AlbumViewControllerç”Ÿå‘½å‘¨æœŸç»“æŸçš„æ—¶å€™å¯¹å¯è§‚å¯Ÿå¯¹è±¡è¿›è¡Œ<code class="highlighter-rouge">onCompleted()</code>è°ƒç”¨, æ‰§è¡Œä¹‹å‰çš„è®¢é˜…ä»£ç ä¿®æ”¹UI.
<img src="http://upload-images.jianshu.io/upload_images/1229762-718f23f9c824c8bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>è¿è¡ŒæˆåŠŸå, æˆ‘ä»¬é¡ºåˆ©çš„çœ‹åˆ°å·¦ä¸Šè§’çš„ç¼©ç•¥å›¾æ˜¾ç¤ºäº†, å¹¶ä¸”ä¸èƒ½é‡å¤æ·»åŠ å¤§äºå…­å¼ å›¾ç‰‡åŠåªå…è®¸å®½åº¦å¤§äºé•¿åº¦çš„å›¾ç‰‡. ä½†æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜, å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è®¿é—®ç›¸å†Œçš„æ—¶å€™, ä¼šå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†å¯¹ç”¨æˆ·è¡Œä¸ºè¿›è¡Œæˆæƒ, ä½†æˆæƒå®Œæˆå, å›¾ç‰‡å¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥, è¿™æ˜¯å› ä¸ºæ‡’åŠ è½½çš„æ—¶å€™åœ¨æˆæƒéªŒè¯å‰å¹¶æ²¡æœ‰æ‹¿åˆ°ä»»ä½•çš„æ•°æ®. æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è§£å†³. æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶, å¹¶å¯¹PHPhotoLibraryè¿›è¡Œç±»æ‰©å±•.</p>

<p>PHPhotoLibraryå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç”¨æˆ·å›¾åº“ï¼ŒåŒ…å«äº†ä¸€äº›çš„å›¾ç‰‡å’Œç›¸å†Œï¼ŒåŒæ—¶åŒ…å«æœ¬åœ°çš„å’ŒiCloudä¸­çš„èµ„æºã€‚å½“Photos appå‘ç”Ÿå›¾ç‰‡çš„ä¿®æ”¹ã€å¢åŠ ã€åˆ é™¤ç­‰æ”¹å˜æ—¶ï¼Œä½¿ç”¨PHPhotoLibraryæ¥åšä¸€äº›åˆ·æ–°UIï¼Œä¿å­˜æ•°æ®ç­‰å“åº”åŠ¨ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ³¨å†Œè§‚å¯Ÿè€…ï¼ˆä½¿ç”¨registerChangeObserveræ–¹æ³•ï¼‰ï¼Œå½“Photos appå†…å®¹å‘ç”Ÿæ”¹å˜çš„æ—¶ï¼Œä¼šè§¦å‘ä»£ç†æ–¹æ³•photoLibraryDidChangeã€‚</p>
<div class="highlighter-rouge"><pre class="highlight"><code>extension PHPhotoLibrary {

    static var authorized: Observable&lt;Bool&gt; {
        return Observable.create { observer in

            DispatchQueue.main.async {
                if authorizationStatus() == .authorized {
                    observer.onNext(true)
                    observer.onCompleted()
                } else {
                    observer.onNext(false)
                    requestAuthorization { newStatus in
                        observer.onNext(newStatus == .authorized)
                        observer.onCompleted()
                    }
                }
            }
            
            return Disposables.create()
        }
    }
}

</code></pre>
</div>
<p>è¿™é‡Œå¯¹äºåˆšå­¦ä¹ Swiftçš„åŒå­¦å¯èƒ½å¹¶ä¸æ˜¯å¾ˆå¥½ç†è§£, è¿™é‡Œæˆ‘ä»¬å¯¹<code class="highlighter-rouge">PHPhotoLibrary</code>æ‰©å±•äº†ä¸€ä¸ª<code class="highlighter-rouge">authorized</code>å±æ€§, å¹¶é€šè¿‡è®¡ç®—å±æ€§è¿”å›äº†ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡, å¯¹è§‚å¯Ÿå¯¹è±¡è¿›è¡Œæˆæƒæ ¡éªŒ, å¦‚æœæ ¡éªŒè¿‡å°±æ‰§è¡Œæ“ä½œ, æ²¡æœ‰æ ¡éªŒè¿‡å°±è¯·æ±‚æˆæƒæ ¡éªŒ, è¿™é‡Œå¼€äº†ä¸€ä¸ªGCDçš„ä¸»çº¿ç¨‹, ä½†ä¸€èˆ¬æ¥è¯´åœ¨è®¢é˜…ä¸­æ˜¯è§‚å¯Ÿå™¨ä¸åº”è¯¥é˜»æ­¢å½“å‰çº¿ç¨‹. æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨AlbumViewControllerä¸­è¿›è¡Œä½¿ç”¨.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    override func viewDidLoad() {
        super.viewDidLoad()
        self.collectionView!.register(UICollectionViewCell.self, forCellWithReuseIdentifier: reuseIdentifier)
        //update
        let authorized = PHPhotoLibrary.authorized.share()
        
        authorized.skipWhile { $0 == false }.take(1).subscribe(onNext: { [weak self] _ in
            self?.images = AlbumViewController.loadImages()
            DispatchQueue.main.async {
                self?.collectionView?.reloadData()
            }
        }).addDisposableTo(bag)
        
        authorized.skip(1).takeLast(1).filter { $0 == false }.subscribe(onNext: { [weak self] _ in
            guard let errorMessage = self?.errorMessage else { return }
                DispatchQueue.main.async(execute: errorMessage)
        }).addDisposableTo(bag)
    }
</code></pre>
</div>
<p>æˆ‘ä»¬é€šè¿‡è®¢é˜…å…±äº«çš„å½¢å¼è¿›è¡Œ, ç¬¬ä¸€ä¸ªè®¢é˜…æˆæƒéªŒè¯å½“éªŒè¯æˆåŠŸåè¿›è¡Œè·å–ç³»ç»Ÿç›¸å†Œå›¾ç‰‡, å¹¶åœ¨ä¸»çº¿ç¨‹åˆ·æ–°UI, ç¬¬äºŒä¸ªæ˜¯å‘èµ·è¯·æ±‚éªŒè¯åä»æ²¡æœ‰éªŒè¯å, ä¸»çº¿ç¨‹æ‰§è¡Œé”™è¯¯æç¤ºå¼¹çª—. ä»£ç ä¸­çš„<code class="highlighter-rouge">skipWhile()</code>, <code class="highlighter-rouge">take()</code>,<code class="highlighter-rouge">skip()</code>, <code class="highlighter-rouge">takeLast()</code>æ“ä½œç¬¦, ä¸ç†è§£çš„åŒå­¦å¯ä»¥åˆ°é¡¹ç›®ä¸­çš„playgroundä¸­å…ˆè¡Œäº†è§£.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>    fileprivate func errorMessage() {
        alert(title: "No access to Camera Roll",
              text: "You can grant access to Combinestagram from the Settings app")
            .take(5.0, scheduler: MainScheduler.instance)
            .subscribe(onDisposed: { [weak self] in
                self?.dismiss(animated: true, completion: nil)
                _ = self?.navigationController?.popViewController(animated: true)
        }).addDisposableTo(bag)
    }
</code></pre>
</div>
<p><code class="highlighter-rouge">errorMessage()</code> ä¸­éœ€è¦è®²ä¸€ä¸‹çš„æ˜¯<code class="highlighter-rouge">.take(5.0, scheduler: MainScheduler.instance)</code> ä»ç»™å®šæ—¶é—´æ®µçš„æºåºåˆ—ä¸­è·å–å…ƒç´ ã€‚ ä¸€æ—¦æ—¶é—´é—´éš”è¿‡å»ï¼Œå®Œæˆç»“æœåºåˆ—ã€‚æˆ‘ä»¬åœ¨ViewControllerä¸­ä¹Ÿæ›´æ”¹å¦‚ä¸‹:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    fileprivate func setupObservable() {
        //update
        images.asObservable().throttle(0.5, scheduler: MainScheduler.instance).subscribe(onNext: { [weak self] images in
            guard let preview = self?.imagePreview else { return }
            preview.image = UIImage.collage(images: images, size: preview.frame.size)
            }).addDisposableTo(bag)
        
        images.asObservable().subscribe(onNext: { [weak self] images in
            self?.updateUI(images: images)
        }).addDisposableTo(bag)
    }
</code></pre>
</div>
<p><code class="highlighter-rouge">.throttle(0.5, scheduler: MainScheduler.instance)</code>å’Œåˆšæ‰çš„<code class="highlighter-rouge">take(_:scheduler:)</code>éå¸¸ç›¸ä¼¼, æ˜¯åœ¨ä¸€å®šæ—¶é—´é—´éš”å†…è¿‡æ»¤æ‰ä¹‹å‰çš„å…ƒç´ åªç•™ä¸‹æœ€æ–°çš„å…ƒç´ ,</p>

<p>æ¼”ç¤ºæ•ˆæœ:
<img src="http://upload-images.jianshu.io/upload_images/1229762-c9e974553e6ba09b.gif?imageMogr2/auto-orient/strip" alt="" /></p>

<p>About:</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-3f8925783027b3fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è·³è½¬!!" /></p>

<p><a href="https://github.com/coderZsq/coderZsq.target.swift">ğŸŒŸ æºç  è¯·ç‚¹è¿™é‡ŒğŸŒŸÂ Â»&gt; å–œæ¬¢çš„æœ‹å‹è¯·ç‚¹å–œæ¬¢Â Â»&gt; ä¸‹è½½æºç çš„åŒå­¦è¯·é€ä¸‹å°æ˜Ÿæ˜ŸÂ Â»&gt; æœ‰é—²é’±çš„å£•ä»¬å¯ä»¥è¿›è¡Œæ‰“èµÂ Â»&gt; å°å¼Ÿä¼šå°½å¿«æ¨å‡ºæ›´å¥½çš„æ–‡ç« å’Œå¤§å®¶åˆ†äº«Â Â»&gt; ä½ çš„æ¿€åŠ±å°±æ˜¯æˆ‘çš„åŠ¨åŠ›!! </a></p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æœ€è¿‘çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%98%A0%E5%B0%84%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/" title="link to RxSwift å‡½æ•°å¼æ˜ å°„è¿ç®—ç¬¦å®æ“">RxSwift å‡½æ•°å¼æ˜ å°„è¿ç®—ç¬¦å®æ“</a></h2>
       <p class="excerpt">  ä¸€è·¯èµ°æ¥, æ„Ÿè§‰RxSwiftä¹Ÿä¸åƒä¹‹å‰ä¸€æ ·æ™¦æ¶©éš¾æ‡‚äº†, ç”šè‡³æ¸æ¸çš„å–œæ¬¢ä¸Šäº†è¿™ç§å“åº”å¼ç¼–ç¨‹çš„æ€æƒ³, å°†å¯¹è±¡ä½œä¸ºå¯è§‚å¯Ÿå¯¹è±¡å¹¶è¿›è¡Œè®¢é˜…, åŠ ä¸Šè¿‡æ»¤æ“ä½œç¬¦çš„åä½œ, ä¸€åˆ‡çš„é€»è¾‘è¿ç®—éƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œ, æœ¬èŠ‚æ‰€è¦è®²çš„æ˜¯Rxä¸­æœ€ä¸ºå¼ºå¤§çš„åŠŸèƒ½ â€” æ˜ å°„, ä»£ç è§:githubæœ¬èŠ‚æ‰€éœ€çš„ä¸€äº›å…³äºæ˜ å°„çš„åŸºæœ¬çŸ¥è¯†å·²ç»æ›´æ–°åˆ°githubä»£ç ä¸­çš„playgroundæ–‡ä»¶ä¸­, æ²¡æœ‰æ¥è§¦è¿‡å“åº”å¼ç¼–ç¨‹çš„åŒå­¦è¯·å’Œä¹‹å‰ä¸€æ ·å…ˆè¡Œåœ¨playgroundä¸­äº†è§£æ¦‚è¦ä»¥ä¾¿æ›´å¥½çš„ç†è§£æœ¬æ–‡. æœ¬èŠ‚æˆ‘ä»¬å°±é€šè¿‡æ¡ˆä¾‹é€æ­¥ç²¾è®²æ˜ å°„æ“ä½œç¬¦åœ¨ç½‘ç»œ...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-20 10:45:00 +0800" class="post-list__meta--date date">2017-04-20</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%98%A0%E5%B0%84%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æ›´æ—©çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/RxSwift-%E5%A4%A7%E7%A5%9E%E4%BB%AC%E9%83%BD%E5%9C%A8%E7%9C%8B%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F/" title="link to RxSwift å¤§ç¥ä»¬éƒ½åœ¨çœ‹çš„å“åº”å¼">RxSwift å¤§ç¥ä»¬éƒ½åœ¨çœ‹çš„å“åº”å¼</a></h2>
       <p class="excerpt">  ä¸Šä¸ªç³»åˆ—çš„æ¶æ„è®¾è®¡, ä»MVC -&gt; MVVM -&gt; MVP -&gt; Router -&gt; Downgradable, æˆ‘ä»¬å®ç°äº†é€šè¿‡åˆ†å±‚å°†å„ä¸ªç»„ä»¶è¿›è¡Œè§£è€¦å¹¶åŠ¨æ€çš„å‡é™çº§é¡µé¢, è¿™ä¸€ç³»åˆ—å‡†å¤‡è¯´è¯´å¦‚ä½•é€šè¿‡RxSwiftè¿›è¡Œå“åº”å¼ç¼–ç¨‹æ›´å¥½çš„å’Œæ¶æ„è®¾è®¡è¿›è¡ŒååŒ. ä»£ç è§:githubè¿™ç³»åˆ—æ‰€è¿°æ¡ˆä¾‹æ˜¯é€šè¿‡Rayå®¶çš„RxSwiftä¸€ä¹¦è¿›è¡Œç¬”è®°, åœ¨å­¦ä¹ æœ¬ç¯‡ä¹‹å‰, è¯·ç¡®ä¿ç†Ÿç»ƒæŒæ¡Swift3åŸºç¡€è¯­æ³•å¹¶å…·å¤‡ä¸­çº§iOSå¼€å‘èƒ½åŠ›. å¯¹äºRxSwiftçš„æ¦‚å¿µä¸æ˜¯å¾ˆæ¸…æ™°çš„åŒå­¦å¯ä»¥å‚ç…§æœ¬æ–‡...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-18 12:13:00 +0800" class="post-list__meta--date date">2017-04-18</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/04/RxSwift-%E5%A4%A7%E7%A5%9E%E4%BB%AC%E9%83%BD%E5%9C%A8%E7%9C%8B%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… è®¸å¯åè®®</a></span>
        <span class="footer__copyright">ç”± <a href="https://jekyllrb.com">Jekyll</a> äº 2018-07-11 ç”Ÿæˆï¼Œæ„Ÿè°¢ <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> ä¸ºæœ¬ç«™æä¾›ç¨³å®šçš„ VPS æœåŠ¡</span>
        <span class="footer__copyright">æœ¬ç«™ç”± <a href="https://github.com/coderZsq">@Castie!</a> åˆ›å»ºï¼Œé‡‡ç”¨ <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> ä½œä¸ºä¸»é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ GitHub æ‰¾åˆ°<a href="https://github.com/onevcat/OneV-s-Den">æœ¬ç«™æºç </a> - &copy; 2018</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
