<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Castie! Notes</title>
  <meta name="description" content="  ä¸Šå‘¨æˆ‘ä»¬å¼€å¯äº†RxSwiftçš„å­¦ä¹ ä¹‹æ—…, ä»å¯è§‚å¯Ÿåºåˆ—â€“&gt;è¿‡æ»¤è¿ç®—ç¬¦â€“&gt;æ˜ å°„è¿ç®—ç¬¦, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯´è¯´ç»„åˆè¿ç®—ç¬¦. è¯´å®è¯, å¯¹äºä¹‹å‰çš„å†…å®¹çš„å­¦ä¹ , æˆ‘è§‰å¾—è¿˜æ˜¯æ¯”è¾ƒé€šä¿—æ˜“æ‡‚çš„, ä½†æ˜¯è¿™æ¬¡çš„ç»„åˆè¿ç®—ç¬¦ç›¸æ¯”ä¹‹å‰åœ¨ç†è§£éš¾æ˜“ç¨‹åº¦ä¸Šåˆä¸Šäº†ä¸ªæ¡£æ¬¡, æœ¬èŠ‚æˆ‘ä»¬å°±æ¥æ”»å…‹è¿™ä¸€æŒ‘æˆ˜å§! ä»£ç è§:github">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="RxSwift å‡½æ•°å¼ç»„åˆè¿ç®—ç¬¦å®æ“">
  <meta name="twitter:description" content="  ä¸Šå‘¨æˆ‘ä»¬å¼€å¯äº†RxSwiftçš„å­¦ä¹ ä¹‹æ—…, ä»å¯è§‚å¯Ÿåºåˆ—â€“&gt;è¿‡æ»¤è¿ç®—ç¬¦â€“&gt;æ˜ å°„è¿ç®—ç¬¦, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯´è¯´ç»„åˆè¿ç®—ç¬¦. è¯´å®è¯, å¯¹äºä¹‹å‰çš„å†…å®¹çš„å­¦ä¹ , æˆ‘è§‰å¾—è¿˜æ˜¯æ¯”è¾ƒé€šä¿—æ˜“æ‡‚çš„, ä½†æ˜¯è¿™æ¬¡çš„ç»„åˆè¿ç®—ç¬¦ç›¸æ¯”ä¹‹å‰åœ¨ç†è§£éš¾æ˜“ç¨‹åº¦ä¸Šåˆä¸Šäº†ä¸ªæ¡£æ¬¡, æœ¬èŠ‚æˆ‘ä»¬å°±æ¥æ”»å…‹è¿™ä¸€æŒ‘æˆ˜å§! ä»£ç è§:github">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="RxSwift å‡½æ•°å¼ç»„åˆè¿ç®—ç¬¦å®æ“">
  <meta property="og:description" content="  ä¸Šå‘¨æˆ‘ä»¬å¼€å¯äº†RxSwiftçš„å­¦ä¹ ä¹‹æ—…, ä»å¯è§‚å¯Ÿåºåˆ—â€“&gt;è¿‡æ»¤è¿ç®—ç¬¦â€“&gt;æ˜ å°„è¿ç®—ç¬¦, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯´è¯´ç»„åˆè¿ç®—ç¬¦. è¯´å®è¯, å¯¹äºä¹‹å‰çš„å†…å®¹çš„å­¦ä¹ , æˆ‘è§‰å¾—è¿˜æ˜¯æ¯”è¾ƒé€šä¿—æ˜“æ‡‚çš„, ä½†æ˜¯è¿™æ¬¡çš„ç»„åˆè¿ç®—ç¬¦ç›¸æ¯”ä¹‹å‰åœ¨ç†è§£éš¾æ˜“ç¨‹åº¦ä¸Šåˆä¸Šäº†ä¸ªæ¡£æ¬¡, æœ¬èŠ‚æˆ‘ä»¬å°±æ¥æ”»å…‹è¿™ä¸€æŒ‘æˆ˜å§! ä»£ç è§:github">
  
  <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
  <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/ico">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E5%90%88%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/">
  <link rel="alternate" type="application/rss+xml" title="Castie!" href="http://localhost:4000/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="å‰å¾€ Castie! çš„ä¸»é¡µ" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Castie! logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Castie!" class="blog-button">Castie!</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">æ­£æ€åˆ†å¸ƒ, ä¼˜åŠ£ä¼´ç”Ÿ</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">åŒ—å†¥æœ‰é±¼ï¼Œå…¶åä¸ºé²²ï¼ˆkÅ«nï¼‰ã€‚é²²ä¹‹å¤§ï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›åŒ–è€Œä¸ºé¸Ÿï¼Œå…¶åä¸ºé¹ã€‚é¹ä¹‹èƒŒï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›æ€’è€Œé£ï¼Œå…¶ç¿¼è‹¥å‚å¤©ä¹‹äº‘ã€‚æ˜¯é¸Ÿä¹Ÿï¼Œæµ·è¿åˆ™å°†å¾™äºå—å†¥ã€‚å—å†¥è€…ï¼Œå¤©æ± ä¹Ÿã€‚</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description">åŒ—æµ·è‹¥æ›°ï¼šâ€œäº•é¼ƒä¸å¯ä»¥è¯­äºæµ·è€…ï¼Œæ‹˜äºè™šä¹Ÿï¼›å¤è™«ä¸å¯ä»¥è¯­äºå†°è€…ï¼Œç¬ƒäºæ—¶ä¹Ÿï¼›æ›²å£«ä¸å¯ä»¥è¯­äºé“è€…ï¼ŒæŸäºæ•™ä¹Ÿã€‚ä»Šå°”å‡ºäºå´–æ¶˜ï¼Œè§‚äºå¤§æµ·ï¼Œä¹ƒçŸ¥å°”ä¸‘ï¼Œå°”å°†å¯ä¸è¯­å¤§ç†çŸ£ã€‚</p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="è®¿é—®åšå®¢" class="blog-button">åšå®¢</a></li>
                
                  <li class="navigation__item"><a href="https://coderzsq.github.io/coderZsq.webpack.js/" target="_blank" title="æˆ‘çš„ç®€å†">ç®€å†</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
    <!-- jianshu-->
    <li class="navigation__item">
      <a href="http://www.jianshu.com/u/9d7fad1a4693" title="@coderZsq çš„ç®€ä¹¦" target="_blank">
        <i class='social fa fa-book'></i>
        <span class="label">jianshu</span>
      </a>
    </li>
    

    
    <!-- juejin-->
    <li class="navigation__item">
      <a href="https://juejin.im/user/57e735dfa22b9d00614eecb8" title="@coderZsq çš„ç¨€åœŸæ˜é‡‘" target="_blank">
        <i class='social fa fa-align-center'></i>
        <span class="label">juejin</span>
      </a>
    </li>
    

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/coderZsq" title="@coderZsq çš„ Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:a13701777868@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-slate"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-04-24 14:51:00 +0800" itemprop="datePublished" class="post-meta__date date">2017-04-24</time> &#8226; <span class="post-meta__tags tags">ç§»åŠ¨å¼€å‘</span>
    </div>
    <h1 class="post-title">RxSwift å‡½æ•°å¼ç»„åˆè¿ç®—ç¬¦å®æ“</h1>
  </header>

  <section class="post">
    <blockquote>
  <p>ä¸Šå‘¨æˆ‘ä»¬å¼€å¯äº†RxSwiftçš„å­¦ä¹ ä¹‹æ—…, ä»å¯è§‚å¯Ÿåºåˆ—â€“&gt;è¿‡æ»¤è¿ç®—ç¬¦â€“&gt;æ˜ å°„è¿ç®—ç¬¦, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯´è¯´ç»„åˆè¿ç®—ç¬¦. è¯´å®è¯, å¯¹äºä¹‹å‰çš„å†…å®¹çš„å­¦ä¹ , æˆ‘è§‰å¾—è¿˜æ˜¯æ¯”è¾ƒé€šä¿—æ˜“æ‡‚çš„, ä½†æ˜¯è¿™æ¬¡çš„ç»„åˆè¿ç®—ç¬¦ç›¸æ¯”ä¹‹å‰åœ¨ç†è§£éš¾æ˜“ç¨‹åº¦ä¸Šåˆä¸Šäº†ä¸ªæ¡£æ¬¡, æœ¬èŠ‚æˆ‘ä»¬å°±æ¥æ”»å…‹è¿™ä¸€æŒ‘æˆ˜å§! ä»£ç è§:<a href="https://github.com/coderZsq/coderZsq.target.swift">github</a></p>
</blockquote>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-a67b7f2ab21d4b23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>æœ¬èŠ‚æ‰€éœ€çš„ä¸€äº›å…³äºç»„åˆçš„åŸºæœ¬çŸ¥è¯†å·²ç»æ›´æ–°åˆ°<a href="https://github.com/coderZsq/coderZsq.target.swift">github</a>ä»£ç ä¸­çš„playgroundæ–‡ä»¶ä¸­, æ²¡æœ‰æ¥è§¦è¿‡å“åº”å¼ç¼–ç¨‹çš„åŒå­¦è¯·å’Œä¹‹å‰ä¸€æ ·å…ˆè¡Œåœ¨<a href="https://github.com/coderZsq/coderZsq.target.swift/blob/master/Our%20Planet/Our%20Planet.playground/Contents.swift">playground</a>ä¸­äº†è§£æ¦‚è¦ä»¥ä¾¿æ›´å¥½çš„ç†è§£æœ¬æ–‡. æœ¬èŠ‚æˆ‘ä»¬å°±é€šè¿‡æ¡ˆä¾‹é€æ­¥ç²¾è®²ç»„åˆæ“ä½œç¬¦åœ¨å®é™…å¼€å‘æ—¶çš„ä½œç”¨.</p>

<p>è¿™æ¬¡çš„UIå±‚é¢ä¹Ÿä¸æ˜¯ç‰¹åˆ«å¤æ‚, ä¸€ä¸ªTableViewçš„åˆ—è¡¨é¡µå’Œä¸€ä¸ªæœ‰Slideræ§åˆ¶çš„TableViewåˆ—è¡¨é¡µ: 
<img src="http://upload-images.jianshu.io/upload_images/1229762-821df01cb8ecc097.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>æœ¬ç« æ˜¯å¯¹äº<a href="http://www.jianshu.com/p/6b80a0db56bd">RxSwift å“åº”å¼ç¼–ç¨‹å®æˆ˜ æ˜ å°„è¿ç®—ç¬¦</a>è¿›è¡Œå‡çº§çš„ä¸€èŠ‚, æ‰€ä»¥æˆ‘ä»¬æ¥ç€ç½‘ç»œè¯·æ±‚è¿™å—è®²èµ·, æˆ‘ä»¬å…ˆå°†æ¨¡å‹ç±»(<code class="highlighter-rouge">EOCategory</code> ` EOError<code class="highlighter-rouge"> </code> EOLocation<code class="highlighter-rouge"> </code> EOEvent`)æ·»åŠ åˆ°å·¥ç¨‹ä¸­.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>    fileprivate static let API = "https://eonet.sci.gsfc.nasa.gov/api/v2.1"
    static let categoriesEndpoint = "/categories"
    fileprivate static let eventsEndpoint = "/events"
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>   fileprivate static func request(endpoint: String, query: [String : Any] = [:]) -&gt; Observable&lt;[String : Any]&gt; {
    
        do {
            guard let url = URL(string: API)?.appendingPathComponent(endpoint), var components = URLComponents(url: url, resolvingAgainstBaseURL: true) else {
                throw EOError.invalidURL(endpoint)
            }
            
            components.queryItems = try query.flatMap { (key, value) in
                guard let v = value as? CustomStringConvertible else {
                    throw EOError.invalidParameter(key, value)
                }
                return URLQueryItem(name: key , value: v.description)
            }
            
            guard let finalURL = components.url else {
                throw EOError.invalidURL(endpoint)
            }
            
            let request = URLRequest(url: finalURL)
            return URLSession.shared.rx.response(request: request).map { _, data -&gt; [String : Any] in
                guard let jsonObject = try? JSONSerialization.jsonObject(with: data, options: []), let result = jsonObject as? [String : Any] else {
                    throw EOError.invalidJSON(finalURL.absoluteString)
                }
                return result
            }
        } catch {
            return Observable.empty()
        }
    }
</code></pre>
</div>
<p>æˆ‘ä»¬ä»è¯·æ±‚çš„å‡½æ•°å¼€å§‹è®²èµ·, å’Œä¹‹å‰ä¸åŒçš„æ˜¯, è¿™æ¬¡æˆ‘ä»¬å°†è¯·æ±‚ç›´æ¥å°è£…åœ¨æ¨¡å‹é‡Œ, ä¼ ç»Ÿçš„MVCæ¨¡å¼.</p>
<ul>
  <li>é€šè¿‡å¯¹<code class="highlighter-rouge">API</code>æ¥å£è¿›è¡Œæ ¡éªŒå¾—åˆ°å¯ç”¨çš„<code class="highlighter-rouge">URLComponents</code>, å¦‚æœurlä¸å¯ç”¨æŠ›å‡ºå¼‚å¸¸.</li>
  <li>å°†å‚æ•°èµ‹å€¼ç»™<code class="highlighter-rouge">URLQueryItem</code>, å¦‚æœ<code class="highlighter-rouge">value</code>ä¸ç¬¦åˆè§„åˆ™æŠ›å‡ºå¼‚å¸¸.</li>
  <li>æ‹¿åˆ°æœ€ç»ˆçš„<code class="highlighter-rouge">URL</code>, å¦‚æœæ‹¿ä¸åˆ°æŠ›å‡ºå¼‚å¸¸.</li>
  <li>å°†<code class="highlighter-rouge">URL</code>è½¬æ¢æˆ<code class="highlighter-rouge">URLRequest</code>.</li>
  <li>è¿›è¡ŒJSONåºåˆ—åŒ–, è¿”å›<code class="highlighter-rouge">(HTTPURLResponse, Data)</code>ä¸­çš„<code class="highlighter-rouge">Data</code>.</li>
  <li>å¦‚æœæŠ›å‡ºå¼‚å¸¸åˆ™è¿”å›ç©ºçš„å¯è§‚å¯Ÿåºåˆ—.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>    static var categories: Observable&lt;[EOCategory]&gt; = {
        return EONET.request(endpoint: categoriesEndpoint)
            .map { data in
                let categories = data["categories"] as? [[String: Any]] ?? []
                return categories
                    .flatMap(EOCategory.init)
                    .sorted { $0.name &lt; $1.name }
            }
            .shareReplay(1)
    }()

    ...

    fileprivate static func events(forLast days: Int, closed: Bool, endpoint: String) -&gt; Observable&lt;[EOEvent]&gt; {
        
        return request(endpoint: eventsEndpoint, query: [
            "days": NSNumber(value: days),
            "status": (closed ? "closed" : "open")
        ]).map { json in
            guard let raw = json["events"] as? [[String : Any]] else {
                throw EOError.invalidJSON(endpoint)
            }
            return raw.flatMap(EOEvent.init)
        }
    }
</code></pre>
</div>
<p>æ¥ç€æˆ‘ä»¬å¯¹categoriesçš„å¤–éƒ¨å˜é‡è¿›è¡Œè®¡ç®—å±æ€§çš„getæ–¹æ³•.</p>
<ul>
  <li>è¿›è¡Œè¯·æ±‚è°ƒç”¨ä¸Šé¢çš„è¯·æ±‚å¹¶ä¼ å…¥å°¾éƒ¨èŠ‚ç‚¹.</li>
  <li>è¿›è¡Œæ’åºå¹¶<code class="highlighter-rouge">map</code>æ˜ å°„åˆ°<code class="highlighter-rouge">EOCategory </code>æ¨¡å‹ä¸Š.</li>
  <li><code class="highlighter-rouge">shareReplay(1)</code>å°†è¯·æ±‚è¿›è¡Œä¸€æ¬¡ç¼“å­˜, ä¸‹æ¬¡è°ƒç”¨è®¢é˜…ä¸å†è¿›è¡Œè¯·æ±‚.</li>
  <li><code class="highlighter-rouge">events</code>å’Œ<code class="highlighter-rouge">categories</code>ç›¸åŒ, è¿›è¡Œè¯·æ±‚æ˜ å°„.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>static func events(forLast days: Int = 360) -&gt; Observable&lt;[EOEvent]&gt; {
  let openEvents = events(forLast: days, closed: false)
  let closedEvents = events(forLast: days, closed: true)
  return openEvents.concat(closedEvents)
}
</code></pre>
</div>
<ul>
  <li>å°†<code class="highlighter-rouge">closedEvents </code>è¿›è¡Œè¯·æ±‚æ˜ å°„åçš„æ¨¡å‹æ•°ç»„æ·»åŠ åˆ°<code class="highlighter-rouge">openEvents</code>ä¹‹å.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>    static func events(forLast days: Int = 360, category: EOCategory) -&gt; Observable&lt;[EOEvent]&gt; {

        let openEvents = events(forLast: days, closed: false, endpoint: category.endpoint)
        let closedEvents = events(forLast: days, closed: true, endpoint: category.endpoint)
        
        return Observable.of(openEvents, closedEvents).merge().reduce([]) { running, new in
            running + new
        }
    }
</code></pre>
</div>
<ul>
  <li>è¿›è¡Œ<code class="highlighter-rouge">marge</code>, ç”¨å·¥<code class="highlighter-rouge">git</code>çš„åŒå­¦ä¸€å®šçŸ¥é“, å…¶æ•ˆæœå’Œ<code class="highlighter-rouge">concat</code>ç±»ä¼¼.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>func startDownload() {
        
        download.progress.progress = 0.0
        download.label.text = "Download: 0%"
        
        let eoCategories = EONET.categories
        let downloadedEvents = eoCategories.flatMap { categories in
            return Observable.from(categories.map { category in
                EONET.events(forLast: 360, category: category)
            })
            }.merge(maxConcurrent: 2)
        let updatedCategories = eoCategories.flatMap { categories in
            downloadedEvents.scan(categories) { updated, events in
                return updated.map { category in
                    let eventsForCategory = EONET.filteredEvents(events: events, forCategory: category)
                    if !eventsForCategory.isEmpty {
                        var cat = category
                        cat.events = cat.events + eventsForCategory
                        return cat
                    }
                    return category
                }
            }
        }
        eoCategories.concat(updatedCategories).bind(to: categories).addDisposableTo(disposeBag)
    }

</code></pre>
</div>
<p>è¿™æ®µæ˜¯æˆ‘ä»¬æœ¬èŠ‚çš„é‡å¤´æˆ, æˆ‘ä»¬é€ä¸€æ¥è®²è§£ä¸‹:</p>
<ul>
  <li><code class="highlighter-rouge">eoCategories </code>é¦–å…ˆæˆ‘ä»¬æ‹¿åˆ°è¯·æ±‚åˆ°çš„æ•°æ®<code class="highlighter-rouge">EONET.categories</code> å±æ€§è§‚å¯Ÿgetè¿›è¡Œè¯·æ±‚, è¿™ä¸ªä¹‹å‰è¯´è¿‡äº†.</li>
  <li><code class="highlighter-rouge">downloadedEvents </code>é€šè¿‡<code class="highlighter-rouge">flatMap </code>æ˜ å°„è½¬æ¢æˆ<code class="highlighter-rouge">merge</code>åˆå¹¶åçš„æ¯ä¸ªç›¸å¯¹åº”çš„<code class="highlighter-rouge">EOEvent</code>æ¨¡å‹æ•°ç»„, å¹¶å‘æ•°è®¾ä¸º2.</li>
  <li><code class="highlighter-rouge">updatedCategories</code>é€šè¿‡<code class="highlighter-rouge">flatMap</code>æ˜ å°„è¿›è¡Œå¯¹åˆå¹¶å®Œçš„<code class="highlighter-rouge">downloadedEvents</code>æ¨¡å‹æ•°ç»„è¿›è¡Œ<code class="highlighter-rouge">scan</code>æ‰«æ, å¹¶é‡æ–°ç»„åˆæ–°çš„<code class="highlighter-rouge">category</code>å†…çš„<code class="highlighter-rouge">events</code>æ¨¡å‹æ•°ç»„.</li>
  <li>æœ€åå°†æ›´æ–°åçš„æ•°æ®<code class="highlighter-rouge">concat</code>æ·»åŠ å¹¶<code class="highlighter-rouge">bind</code>ç»‘å®šåœ¨<code class="highlighter-rouge">categories</code>å˜é‡ä¸Šå°±å¤§åŠŸå‘Šæˆäº†.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>    override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {
        
        let cell = tableView.dequeueReusableCell(withIdentifier: "categoryCell")!

        let category = categories.value[indexPath.row]
        cell.textLabel?.text = "\(category.name) (\(category.events.count))"
        cell.accessoryType = (category.events.count &gt; 0) ? .disclosureIndicator : .none
        return cell
    }
</code></pre>
</div>
<ul>
  <li>categorieså³ä¸ºä¸Šé¢è¯·æ±‚æ˜ å°„è¿‡æ»¤ç»„åˆåç»‘å®šçš„å˜é‡, é€šè¿‡å¯¹Cellçš„è‡ªå®šä¹‰ å°±èƒ½å¤Ÿå¾—åˆ°ä¸‹é¢è¯·æ±‚çš„åˆ—è¡¨äº†.
<img src="http://upload-images.jianshu.io/upload_images/1229762-de67226ed07f5b2e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></li>
</ul>

<p>å®Œæˆäº†ç¬¬ä¸€ä¸ªé¡µé¢, æˆ‘ä»¬å¼€å§‹ç€ä¸‹ä¸€ä¸ªé¡µé¢: EventsViewController</p>
<div class="highlighter-rouge"><pre class="highlight"><code>        tableView.rowHeight = UITableViewAutomaticDimension
        tableView.estimatedRowHeight = 60
</code></pre>
</div>
<ul>
  <li>è¿›è¡ŒAutolayoutçº¦æŸå, æˆ‘ä»¬å¯ä»¥åœ¨æ·»åŠ ä»¥ä¸‹ä»£ç æ¥ä»£æ›¿ä¹‹å‰å¤æ‚çš„cellé«˜åº¦çš„è¿ç®—.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>        events.asObservable().subscribe(onNext: { [weak self] _ in
            self?.tableView.reloadData()
        }).addDisposableTo(disposeBag)
        
        Observable.combineLatest(days.asObservable(), events.asObservable()) { (days, events) -&gt; [EOEvent] in
            let maxInterval = TimeInterval(days * 24 * 3600)
            return events.filter { event in
                if let date = event.closeDate {
                    return abs(date.timeIntervalSinceNow) &lt; maxInterval
                }
                return true
            }
        }.bind(to: filteredEvent).addDisposableTo(disposeBag)
    
        filteredEvent.asObservable().subscribe(onNext: { [weak self] _ in
            self?.tableView.reloadData()
        }).addDisposableTo(disposeBag)

        days.asObservable().subscribe(onNext: { [weak self] days in
            self?.daysLabel.text = "Last \(days) days"
        }).addDisposableTo(disposeBag)
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">events</code>æ˜¯ä»ä¸Šä¸ªé¡µé¢ä¼ é€’è¿‡æ¥çš„å˜é‡, ç±»å‹ä¸º<code class="highlighter-rouge">let events = Variable&lt;[EOEvent]&gt;([])</code></li>
  <li>é€šè¿‡å¯¹<code class="highlighter-rouge">events</code>çš„ä½œä¸ºå¯è§‚å¯Ÿåºåˆ—å¹¶è¿›è¡Œè®¢é˜…, å½“å¯è§‚å¯Ÿè€…è¢«æ·»åŠ è¿›è®¢é˜…å°±è¿›è¡Œåˆ—è¡¨çš„åˆ·æ–°.</li>
  <li><code class="highlighter-rouge">Observable.combineLatest()</code>å¯¹æ—¥æœŸå’Œæ—¶é—´åšæœ€åçš„ç»‘å®š, åªä¿ç•™å¯è§‚å¯Ÿåºåˆ—çš„æœ€åçš„å€¼çš„ç»„åˆ,å¹¶è¿›è¡Œè¿‡æ»¤ç»‘å®šåœ¨<code class="highlighter-rouge">filteredEvent</code>å˜é‡ä¸Š, ç±»å‹æ˜¯<code class="highlighter-rouge">let filteredEvent = Variable&lt;[EOEvent]&gt;([])</code></li>
  <li>æ¥ä¸‹æ¥ä¸¤è¡Œå¯¹äºå…³æ³¨æœ¬ç³»åˆ—çš„åŒå­¦åº”è¯¥ä¸ç”¨è§£é‡Š, å°±æ˜¯è¿›è¡Œè®¢é˜…å¹¶åˆ·æ–°UI.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>    @IBAction func sliderAction(_ sender: AnyObject) {
        days.value = Int(slider.value)
    }
</code></pre>
</div>
<p>æœ€åå¯¹slideræ·»åŠ äº‹ä»¶, å¹¶æ”¹å˜daysçš„å€¼.æ¥ä¸‹æ¥ä¼šè§¦å‘ä¸€ç³»åˆ—çš„è®¢é˜….</p>
<div class="highlighter-rouge"><pre class="highlight"><code>        days.asObservable().subscribe(onNext: { [weak self] days in
            self?.daysLabel.text = "Last \(days) days"
        }).addDisposableTo(disposeBag)
</code></pre>
</div>
<ul>
  <li>è§¦å‘ä¸Šé¢çš„è®¢é˜…å¹¶è¿›è¡Œ<code class="highlighter-rouge">UILabel</code>çš„UIåˆ·æ–°</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>        Observable.combineLatest(days.asObservable(), events.asObservable()) { (days, events) -&gt; [EOEvent] in
            let maxInterval = TimeInterval(days * 24 * 3600)
            return events.filter { event in
                if let date = event.closeDate {
                    return abs(date.timeIntervalSinceNow) &lt; maxInterval
                }
                return true
            }
        }.bind(to: filteredEvent).addDisposableTo(disposeBag)
</code></pre>
</div>
<ul>
  <li>è§¦å‘<code class="highlighter-rouge">combineLatest</code>æœ€æ–°ç»„åˆè¿ç®—ç¬¦, å¹¶é‡æ–°è¿›è¡Œè¿‡æ»¤ç»‘å®š.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>        events.asObservable().subscribe(onNext: { [weak self] _ in
            self?.tableView.reloadData()
        }).addDisposableTo(disposeBag)

</code></pre>
</div>
<ul>
  <li>åœ¨å¯¹<code class="highlighter-rouge">event</code>è¿‡æ»¤çš„è¿‡ç¨‹ä¸­è§¦å‘è®¢é˜…è¿›è¡Œåˆ—è¡¨åˆ·æ–°.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>        filteredEvent.asObservable().subscribe(onNext: { [weak self] _ in
            self?.tableView.reloadData()
        }).addDisposableTo(disposeBag)
</code></pre>
</div>
<ul>
  <li>åœ¨è¿‡æ»¤å®Œæˆé‡æ–°ç»‘å®šå, è§¦å‘è®¢é˜…è¿›è¡Œæœ€åçš„åˆ·æ–°.</li>
</ul>

<p>æœ¬æ–‡å› ä¸ºç¯‡å¹…æ‰€é™, ä»…ä¿ç•™ä¸€äº›æ ¸å¿ƒçš„ä»£ç , å¹¶å¯¹æ ¸å¿ƒä»£ç è¿›è¡Œé€æ¡è®²è§£, éœ€è¦è¯¦ç»†äº†è§£, è¯·å»githubä¸‹è½½æºç åå¯¹ç…§é˜…è¯». é€šè¿‡å¯¹äºå¯è§‚å¯Ÿåºåˆ—, è¿‡æ»¤, æ˜ å°„, ç»„åˆçš„ç†è§£å’Œå®æˆ˜, é€šè¿‡ä¸€ä¸ªäº‹ä»¶çš„æ”¹å˜å¼‚æ­¥è§¦å‘è®¢é˜…çš„å“åº”å¼ç¼–ç¨‹çš„æ€æƒ³, æˆ‘ä»¬åº”è¯¥å·²ç»èƒ½ç®—å…¥é—¨äº†.</p>

<p>æ¼”ç¤ºæ•ˆæœ:</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-c95ba5ed107bd458.gif?imageMogr2/auto-orient/strip" alt="" /></p>

<p>About:</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-3f8925783027b3fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è·³è½¬!!" /></p>

<p><a href="https://github.com/coderZsq/coderZsq.target.swift">ğŸŒŸ æºç  è¯·ç‚¹è¿™é‡ŒğŸŒŸÂ Â»&gt; å–œæ¬¢çš„æœ‹å‹è¯·ç‚¹å–œæ¬¢Â Â»&gt; ä¸‹è½½æºç çš„åŒå­¦è¯·é€ä¸‹å°æ˜Ÿæ˜ŸÂ Â»&gt; æœ‰é—²é’±çš„å£•ä»¬å¯ä»¥è¿›è¡Œæ‰“èµÂ Â»&gt; å°å¼Ÿä¼šå°½å¿«æ¨å‡ºæ›´å¥½çš„æ–‡ç« å’Œå¤§å®¶åˆ†äº«Â Â»&gt; ä½ çš„æ¿€åŠ±å°±æ˜¯æˆ‘çš„åŠ¨åŠ›!! </a></p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æœ€è¿‘çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/Animations-%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BC%9A%E7%94%A8View%E7%9A%84%E5%8A%A8%E7%94%BB%E5%90%97/" title="link to Animations ä½ çœŸçš„ä¼šç”¨Viewçš„åŠ¨ç”»å—?">Animations ä½ çœŸçš„ä¼šç”¨Viewçš„åŠ¨ç”»å—?</a></h2>
       <p class="excerpt">  RxSwiftçš„å­¦ä¹ æˆ‘ä»¬å…ˆå‘Šä¸€æ®µè½, å®åœ¨æ˜¯å¤ªçƒ§è„‘äº†, ä»Šå¤©æˆ‘ä»¬æ¢æ¢è„‘å­, ç©ç‚¹è½»æ¾çš„åŠ¨ç”», å»å¹´æˆ‘è¿è½½äº†ä¸€ç³»åˆ—åŸºäºæœ¬äººå°è£…çš„Objective-Cæ¡†æ¶SQExtensionå±•å¼€çš„é¡¹ç›®å®æˆ˜, é‡Œé¢å…³äºåŠ¨ç”»æ–¹é¢çš„æ¶‰åŠè¿˜æ˜¯è›®å¤šçš„ä»¥è‡³äºå—åˆ°äº†è…¾è®¯çš„å…³æ³¨. è¿™ä¸ªç³»åˆ—æˆ‘ä»¬å°±æ¥ç»†è®²åŠ¨ç”», ä¸€èµ·èµ°ä¸Šè¿›é˜¶ä¹‹è·¯. ä»£ç è§:githubå¯¹äºåŠ¨ç”»æ–¹é¢é™¤äº†æœ€åŸºæœ¬çš„ViewåŠ¨ç”»ä¹‹å¤–, å…³äºLayerçš„æ ¸å¿ƒåŠ¨ç”»æˆ‘éƒ½æ˜¯çœ‹è¿™ç¯‡wikiå­¦çš„, åƒå»å¹´è¿è½½çš„ä¸€äº›è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»æ˜¯ä»Objcä¸­å­¦çš„. è¿™æ¬¡ä¹°äº†Rayå®¶çš„ä¸€ç³»åˆ—...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-26 11:58:00 +0800" class="post-list__meta--date date">2017-04-26</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/04/Animations-%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BC%9A%E7%94%A8View%E7%9A%84%E5%8A%A8%E7%94%BB%E5%90%97/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æ›´æ—©çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%98%A0%E5%B0%84%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/" title="link to RxSwift å‡½æ•°å¼æ˜ å°„è¿ç®—ç¬¦å®æ“">RxSwift å‡½æ•°å¼æ˜ å°„è¿ç®—ç¬¦å®æ“</a></h2>
       <p class="excerpt">  ä¸€è·¯èµ°æ¥, æ„Ÿè§‰RxSwiftä¹Ÿä¸åƒä¹‹å‰ä¸€æ ·æ™¦æ¶©éš¾æ‡‚äº†, ç”šè‡³æ¸æ¸çš„å–œæ¬¢ä¸Šäº†è¿™ç§å“åº”å¼ç¼–ç¨‹çš„æ€æƒ³, å°†å¯¹è±¡ä½œä¸ºå¯è§‚å¯Ÿå¯¹è±¡å¹¶è¿›è¡Œè®¢é˜…, åŠ ä¸Šè¿‡æ»¤æ“ä½œç¬¦çš„åä½œ, ä¸€åˆ‡çš„é€»è¾‘è¿ç®—éƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œ, æœ¬èŠ‚æ‰€è¦è®²çš„æ˜¯Rxä¸­æœ€ä¸ºå¼ºå¤§çš„åŠŸèƒ½ â€” æ˜ å°„, ä»£ç è§:githubæœ¬èŠ‚æ‰€éœ€çš„ä¸€äº›å…³äºæ˜ å°„çš„åŸºæœ¬çŸ¥è¯†å·²ç»æ›´æ–°åˆ°githubä»£ç ä¸­çš„playgroundæ–‡ä»¶ä¸­, æ²¡æœ‰æ¥è§¦è¿‡å“åº”å¼ç¼–ç¨‹çš„åŒå­¦è¯·å’Œä¹‹å‰ä¸€æ ·å…ˆè¡Œåœ¨playgroundä¸­äº†è§£æ¦‚è¦ä»¥ä¾¿æ›´å¥½çš„ç†è§£æœ¬æ–‡. æœ¬èŠ‚æˆ‘ä»¬å°±é€šè¿‡æ¡ˆä¾‹é€æ­¥ç²¾è®²æ˜ å°„æ“ä½œç¬¦åœ¨ç½‘ç»œ...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-20 10:45:00 +0800" class="post-list__meta--date date">2017-04-20</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%98%A0%E5%B0%84%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… è®¸å¯åè®®</a></span>
        <span class="footer__copyright">ç”± <a href="https://jekyllrb.com">Jekyll</a> äº 2018-04-03 ç”Ÿæˆï¼Œæ„Ÿè°¢ <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> ä¸ºæœ¬ç«™æä¾›ç¨³å®šçš„ VPS æœåŠ¡</span>
        <span class="footer__copyright">æœ¬ç«™ç”± <a href="https://github.com/coderZsq">@Castie!</a> åˆ›å»ºï¼Œé‡‡ç”¨ <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> ä½œä¸ºä¸»é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ GitHub æ‰¾åˆ°<a href="https://github.com/onevcat/OneV-s-Den">æœ¬ç«™æºç </a> - &copy; 2018</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
