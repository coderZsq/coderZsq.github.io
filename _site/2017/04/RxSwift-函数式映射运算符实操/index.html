<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Castie! Notes</title>
  <meta name="description"
    content="  ä¸€è·¯èµ°æ¥, æ„Ÿè§‰RxSwiftä¹Ÿä¸åƒä¹‹å‰ä¸€æ ·æ™¦æ¶©éš¾æ‡‚äº†, ç”šè‡³æ¸æ¸çš„å–œæ¬¢ä¸Šäº†è¿™ç§å“åº”å¼ç¼–ç¨‹çš„æ€æƒ³, å°†å¯¹è±¡ä½œä¸ºå¯è§‚å¯Ÿå¯¹è±¡å¹¶è¿›è¡Œè®¢é˜…, åŠ ä¸Šè¿‡æ»¤æ“ä½œç¬¦çš„åä½œ, ä¸€åˆ‡çš„é€»è¾‘è¿ç®—éƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œ, æœ¬èŠ‚æ‰€è¦è®²çš„æ˜¯Rxä¸­æœ€ä¸ºå¼ºå¤§çš„åŠŸèƒ½ â€” æ˜ å°„, ä»£ç è§:github">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title"
    content="RxSwift å‡½æ•°å¼æ˜ å°„è¿ç®—ç¬¦å®æ“">
  <meta name="twitter:description"
    content="  ä¸€è·¯èµ°æ¥, æ„Ÿè§‰RxSwiftä¹Ÿä¸åƒä¹‹å‰ä¸€æ ·æ™¦æ¶©éš¾æ‡‚äº†, ç”šè‡³æ¸æ¸çš„å–œæ¬¢ä¸Šäº†è¿™ç§å“åº”å¼ç¼–ç¨‹çš„æ€æƒ³, å°†å¯¹è±¡ä½œä¸ºå¯è§‚å¯Ÿå¯¹è±¡å¹¶è¿›è¡Œè®¢é˜…, åŠ ä¸Šè¿‡æ»¤æ“ä½œç¬¦çš„åä½œ, ä¸€åˆ‡çš„é€»è¾‘è¿ç®—éƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œ, æœ¬èŠ‚æ‰€è¦è®²çš„æ˜¯Rxä¸­æœ€ä¸ºå¼ºå¤§çš„åŠŸèƒ½ â€” æ˜ å°„, ä»£ç è§:github">

  <meta property="og:type" content="article">
  <meta property="og:title"
    content="RxSwift å‡½æ•°å¼æ˜ å°„è¿ç®—ç¬¦å®æ“">
  <meta property="og:description"
    content="  ä¸€è·¯èµ°æ¥, æ„Ÿè§‰RxSwiftä¹Ÿä¸åƒä¹‹å‰ä¸€æ ·æ™¦æ¶©éš¾æ‡‚äº†, ç”šè‡³æ¸æ¸çš„å–œæ¬¢ä¸Šäº†è¿™ç§å“åº”å¼ç¼–ç¨‹çš„æ€æƒ³, å°†å¯¹è±¡ä½œä¸ºå¯è§‚å¯Ÿå¯¹è±¡å¹¶è¿›è¡Œè®¢é˜…, åŠ ä¸Šè¿‡æ»¤æ“ä½œç¬¦çš„åä½œ, ä¸€åˆ‡çš„é€»è¾‘è¿ç®—éƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œ, æœ¬èŠ‚æ‰€è¦è®²çš„æ˜¯Rxä¸­æœ€ä¸ºå¼ºå¤§çš„åŠŸèƒ½ â€” æ˜ å°„, ä»£ç è§:github">

  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%98%A0%E5%B0%84%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/">
  <link rel="alternate" type="application/rss+xml" title="Castie!"
    href="http://localhost:4000/feed.xml">

  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
</head>

  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="å‰å¾€ Castie! çš„ä¸»é¡µ" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Castie! logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Castie!" class="blog-button">Castie!</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">æ­£æ€åˆ†å¸ƒ, ä¼˜åŠ£ä¼´ç”Ÿ</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">åŒ—å†¥æœ‰é±¼ï¼Œå…¶åä¸ºé²²ï¼ˆkÅ«nï¼‰ã€‚é²²ä¹‹å¤§ï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›åŒ–è€Œä¸ºé¸Ÿï¼Œå…¶åä¸ºé¹ã€‚é¹ä¹‹èƒŒï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›æ€’è€Œé£ï¼Œå…¶ç¿¼è‹¥å‚å¤©ä¹‹äº‘ã€‚æ˜¯é¸Ÿä¹Ÿï¼Œæµ·è¿åˆ™å°†å¾™äºå—å†¥ã€‚å—å†¥è€…ï¼Œå¤©æ± ä¹Ÿã€‚</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description">åŒ—æµ·è‹¥æ›°ï¼šâ€œäº•é¼ƒä¸å¯ä»¥è¯­äºæµ·è€…ï¼Œæ‹˜äºè™šä¹Ÿï¼›å¤è™«ä¸å¯ä»¥è¯­äºå†°è€…ï¼Œç¬ƒäºæ—¶ä¹Ÿï¼›æ›²å£«ä¸å¯ä»¥è¯­äºé“è€…ï¼ŒæŸäºæ•™ä¹Ÿã€‚ä»Šå°”å‡ºäºå´–æ¶˜ï¼Œè§‚äºå¤§æµ·ï¼Œä¹ƒçŸ¥å°”ä¸‘ï¼Œå°”å°†å¯ä¸è¯­å¤§ç†çŸ£ã€‚</p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="è®¿é—®åšå®¢" class="blog-button">åšå®¢</a></li>
                
                  <li class="navigation__item"><a href="https://coderzsq.github.io/coderZsq.practice.web/" target="_blank" title="æˆ‘çš„ç®€å†">ç®€å†</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
    <!-- juejin-->
    <li class="navigation__item">
      <a href="https://juejin.im/user/57e735dfa22b9d00614eecb8/posts" title="@coderZsq çš„ç¨€åœŸæ˜é‡‘" target="_blank">
        <i class='social fa fa-book'></i>
        <span class="label">juejin</span>
      </a>
    </li>
    

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/coderZsq" title="@coderZsq çš„ Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:a13701777868@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-04-20 10:45:00 +0800" itemprop="datePublished" class="post-meta__date date">2017-04-20</time> &#8226; <span class="post-meta__tags tags">ç§»åŠ¨å¼€å‘</span>
    </div>
    <h1 class="post-title">RxSwift å‡½æ•°å¼æ˜ å°„è¿ç®—ç¬¦å®æ“</h1>
  </header>

  <section class="post">
    <blockquote>
  <p>ä¸€è·¯èµ°æ¥, æ„Ÿè§‰RxSwiftä¹Ÿä¸åƒä¹‹å‰ä¸€æ ·æ™¦æ¶©éš¾æ‡‚äº†, ç”šè‡³æ¸æ¸çš„å–œæ¬¢ä¸Šäº†è¿™ç§å“åº”å¼ç¼–ç¨‹çš„æ€æƒ³, å°†å¯¹è±¡ä½œä¸ºå¯è§‚å¯Ÿå¯¹è±¡å¹¶è¿›è¡Œè®¢é˜…, åŠ ä¸Šè¿‡æ»¤æ“ä½œç¬¦çš„åä½œ, ä¸€åˆ‡çš„é€»è¾‘è¿ç®—éƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œ, æœ¬èŠ‚æ‰€è¦è®²çš„æ˜¯Rxä¸­æœ€ä¸ºå¼ºå¤§çš„åŠŸèƒ½ â€” æ˜ å°„, ä»£ç è§:<a href="https://github.com/coderZsq/coderZsq.target.swift">github</a></p>
</blockquote>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-a67b7f2ab21d4b23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>æœ¬èŠ‚æ‰€éœ€çš„ä¸€äº›å…³äºæ˜ å°„çš„åŸºæœ¬çŸ¥è¯†å·²ç»æ›´æ–°åˆ°<a href="https://github.com/coderZsq/coderZsq.target.swift">github</a>ä»£ç ä¸­çš„playgroundæ–‡ä»¶ä¸­, æ²¡æœ‰æ¥è§¦è¿‡å“åº”å¼ç¼–ç¨‹çš„åŒå­¦è¯·å’Œä¹‹å‰ä¸€æ ·å…ˆè¡Œåœ¨<a href="https://github.com/coderZsq/coderZsq.target.swift/blob/master/GitHubRepo/GitHubRepository/GitHubRepository.playground/Contents.swift">playground</a>ä¸­äº†è§£æ¦‚è¦ä»¥ä¾¿æ›´å¥½çš„ç†è§£æœ¬æ–‡. æœ¬èŠ‚æˆ‘ä»¬å°±é€šè¿‡æ¡ˆä¾‹é€æ­¥ç²¾è®²æ˜ å°„æ“ä½œç¬¦åœ¨ç½‘ç»œè¯·æ±‚æ—¶çš„å¦™ç”¨.</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-81e919722e1627dd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>è¿™æ¬¡çš„UIç•Œé¢éå¸¸çš„ç®€å•,  å°±æ˜¯ä¸€ä¸ªç®€å•çš„TableViewController, æˆ‘ä»¬é€šè¿‡ç½‘ç»œè¯·æ±‚å°†è·å–çš„JSONæ•°æ®æ˜ å°„åˆ°Modelä¸Šå¹¶å±•ç¤ºåœ¨Cellä¸Š, API: https://api.github.com/repos/coderZsq/coderZsq.target.swift/events</p>

<p>æƒ³äº†è§£å¦‚ä½•è¿›è¡Œåå°æ­å»ºå¹¶æ¨¡æ‹Ÿæ•°æ®è¿”å›çš„åŒå­¦ è¯·ç‚¹å‡» â€“&gt; <a href="http://www.jianshu.com/p/5a03995a6ce1">Hybird å®ç°çƒ­ä¿®å¤æ¶æ„ ä»MVCè¯´èµ·</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5715074941"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PushEvent"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"actor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">19483268</span><span class="p">,</span><span class="w">
      </span><span class="nt">"login"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coderZsq"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"display_login"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coderZsq"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"gravatar_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/coderZsq"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"avatar_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://avatars.githubusercontent.com/u/19483268?"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"repo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">87806175</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coderZsq/coderZsq.target.swift"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/repos/coderZsq/coderZsq.target.swift"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"push_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1688506435</span><span class="p">,</span><span class="w">
      </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nt">"distinct_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"refs/heads/master"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"head"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90306f546ee0e17d94891415a2f8938d28736dc7"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"before"</span><span class="p">:</span><span class="w"> </span><span class="s2">"778ac2b60b85a3e97e0a1e85e16cdb1061445181"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"commits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"sha"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90306f546ee0e17d94891415a2f8938d28736dc7"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"author"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a13701777868@yahoo.com"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Castie!"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update README.md"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"distinct"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/repos/coderZsq/coderZsq.target.swift/commits/90306f546ee0e17d94891415a2f8938d28736dc7"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"public"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-04-19T12:12:49Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>æˆ‘ä»¬å…ˆä»æµè§ˆå™¨çœ‹ä¸‹æ¥å£æ‰€è¿”å›çš„å­—æ®µ, å¹¶æå–æˆ‘ä»¬éœ€è¦çš„å­—æ®µç”Ÿæˆæ¨¡å‹Model, ä»¥å¤‡ä¹‹åçš„æ˜ å°„.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>typealias AnyDict = [String: Any]

class Event {

    let repo: String
    let name: String
    let imageUrl: URL
    let action: String
    
    init?(dictionary: AnyDict) {
        guard let repoDict = dictionary["repo"] as? AnyDict,
            let actor = dictionary["actor"] as? AnyDict,
            let repoName = repoDict["name"] as? String,
            let actorName = actor["display_login"] as? String,
            let actorUrlString = actor["avatar_url"] as? String,
            let actorUrl  = URL(string: actorUrlString),
            let actionType = dictionary["type"] as? String
            else {  return nil  }
        
        repo = repoName
        name = actorName
        imageUrl = actorUrl
        action = actionType
    }
    
    var dictionary: AnyDict {
        return [
            "repo" : ["name": repo],
            "actor": ["display_login": name, "avatar_url": imageUrl.absoluteString],
            "type" : action
        ]
    }
}

</code></pre>
</div>
<p>æˆ‘ä»¬å°†æ¨¡å‹å‘½åä¸ºEvent, æ·»åŠ äº†ä¸€ä¸ªdictionaryå˜é‡ä¾›è¿”å›åºåˆ—åŒ–å®Œæˆåçš„å­—å…¸.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    func fetchEvents(repo: String) {
        
        let response = Observable.from([repo]).map { urlString -&gt; URL in
                return URL(string: "https://api.github.com/repos/\(urlString)/events")!
            }.map { [weak self] url -&gt; URLRequest in
                var request = URLRequest(url: url)
                if let modifiedHeader = self?.lastModified.value {
                    request.addValue(modifiedHeader as String,forHTTPHeaderField: "Last-Modified")
                }
                return request
            }.flatMap { request -&gt; Observable&lt;(HTTPURLResponse, Data)&gt; in
                return URLSession.shared.rx.response(request: request)
            }.shareReplay(1)
        
        response.filter { response, _ in
                return 200..&lt;300 ~= response.statusCode
            }.map { _, data -&gt; [[String: Any]] in
                guard let jsonObject = try? JSONSerialization.jsonObject(with: data, options: []),
                    let result = jsonObject as? [[String: Any]] else { return [] }
                return result
            }.filter { objects in
                return objects.count &gt; 0
            }.map { objects in
                return objects.flatMap(Event.init)
            }.subscribe(onNext: { [weak self] newEvents in
                self?.processEvents(newEvents)
            }).addDisposableTo(bag)
    }
</code></pre>
</div>
<p>ä¸€åˆ‡å‡†å¤‡å°±ç»ª, æˆ‘ä»¬å°±æ¥è¯´è¯´æœ¬èŠ‚æœ€é‡è¦çš„éƒ¨åˆ†äº†, æˆ‘ä»¬é€è¡Œæ¥è¿›è¡Œè®²è§£.</p>
<ul>
  <li>é€šè¿‡<code class="highlighter-rouge">Observable.from()</code>çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡, ä¼ å…¥<code class="highlighter-rouge">repo</code>å­—æ®µ, é€šè¿‡<code class="highlighter-rouge">map</code>æ˜ å°„æˆ<code class="highlighter-rouge">URL</code>è¿”å›.</li>
  <li>é€šè¿‡<code class="highlighter-rouge">map</code>æ˜ å°„å°†<code class="highlighter-rouge">URL</code>æ˜ å°„æˆ<code class="highlighter-rouge">URLRequest</code>, å¦‚æœæœ‰è¿›è¡Œä¿®æ”¹åˆ™å†™å…¥è¯·æ±‚å¤´.</li>
  <li>é€šè¿‡â€™flatmapâ€™æ˜ å°„å°†å°†<code class="highlighter-rouge">URLRequest</code>æ˜ å°„æˆ<code class="highlighter-rouge">HTTPURLResponse </code>, ç½‘ç»œè¯·æ±‚å°è£…åœ¨<code class="highlighter-rouge">RxCocoa</code>çš„<code class="highlighter-rouge">URLSession.shared.rx.response(request:)</code>æ–¹æ³•ä¸­, æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸‹æºç , å½“ç„¶è¿™äº›éƒ½æ˜¯åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œçš„.</li>
  <li>æœ€åé€šè¿‡<code class="highlighter-rouge">shareReplay(1)</code>è¿›è¡Œè®¢é˜…å…±äº«. <code class="highlighter-rouge">shareReplay</code>å¯ä»¥å°†ä¹‹å‰å“åº”ç»“æœåŠ å…¥ç¼“å†²åŒº. è¿™ä¹Ÿæ˜¯ä¸ä½¿ç”¨<code class="highlighter-rouge">share()</code>çš„åŸå› , é¿å…å¤šæ¬¡è¯·æ±‚.</li>
</ul>

<p>å¯¹äºflatmap å’Œ map ä¹‹å‰çš„åŒºåˆ«ä¸äº†è§£çš„åŒå­¦å¯ä»¥çœ‹ä¸‹<a href="https://github.com/coderZsq/coderZsq.target.swift/blob/master/GitHubRepo/GitHubRepository/GitHubRepository.playground/Contents.swift">playground</a>ä¸­çš„ä¾‹å­, æˆ–è€…ç›´æ¥æŸ¥çœ‹Swiftä¸­çš„Arrayæ–‡æ¡£.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    /// Returns an array containing the non-`nil` results of calling the given
    /// transformation with each element of this sequence.
    ///
    /// Use this method to receive an array of nonoptional values when your
    /// transformation produces an optional value.
    ///
    /// In this example, note the difference in the result of using `map` and
    /// `flatMap` with a transformation that returns an optional `Int` value.
    ///
    ///     let possibleNumbers = ["1", "2", "three", "///4///", "5"]
    /// 
    ///     let mapped: [Int?] = numbers.map { str in Int(str) }
    ///     // [1, 2, nil, nil, 5]
    /// 
    ///     let flatMapped: [Int] = numbers.flatMap { str in Int(str) }
    ///     // [1, 2, 5]
    ///
    /// - Parameter transform: A closure that accepts an element of this
    ///   sequence as its argument and returns an optional value.
    /// - Returns: An array of the non-`nil` results of calling `transform`
    ///   with each element of the sequence.
    ///
    /// - Complexity: O(*m* + *n*), where *m* is the length of this sequence
    ///   and *n* is the length of the result.
    public func flatMap&lt;ElementOfResult&gt;(_ transform: (Element) throws -&gt; ElementOfResult?) rethrows -&gt; [ElementOfResult]
</code></pre>
</div>

<p>æ‹¿åˆ°äº†å“åº”ç»“æœ, æˆ‘ä»¬å¯¹ç›¸åº”ç»“æœè¿›è¡Œè¿‡æ»¤, å¦‚æœå¯¹è¿‡æ»¤ä¸äº†è§£çš„åŒå­¦, è¯·ç¿»çœ‹ä¹‹å‰çš„æ–‡ç«  â€“&gt; <a href="http://www.jianshu.com/p/04349d324a6f">RxSwift å“åº”å¼ç¼–ç¨‹å®æˆ˜ è¿‡æ»¤è¿ç®—ç¬¦</a></p>

<ul>
  <li>é€šè¿‡<code class="highlighter-rouge">filter </code>è¿‡æ»¤æ‰é”™è¯¯çš„statusCode, å¯¹äºstatusCodeä¸äº†è§£çš„åŒå­¦å¯ä»¥æŸ¥é˜…HTTPçŠ¶æ€ç çš„èµ„æ–™, <code class="highlighter-rouge">~=</code>æ“ä½œç¬¦æ˜¯æŒ‡æ“ä½œç¬¦å³è¾¹çš„å€¼æ˜¯å¦åœ¨æ“ä½œç¬¦å·¦è¾¹çš„èŒƒå›´ä¹‹å†…, è¿”å›Boolç±»å‹,</li>
  <li>å¾—åˆ°æ­£ç¡®çš„æ•°æ®å, é€šè¿‡<code class="highlighter-rouge">map</code>è¿›è¡Œæ˜ å°„å°†æ•°æ®æ˜ å°„æˆå­—å…¸æ•°ç»„ç±»å‹, ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿçš„JSONåºåˆ—åŒ–.</li>
  <li>å†æ¬¡è¿›è¡Œ<code class="highlighter-rouge">filter</code>è¿‡æ»¤, è¿‡æ»¤æ‰æ²¡æœ‰è¿”å›çš„æ•°æ®.</li>
  <li>å†æ¬¡è¿›è¡Œ<code class="highlighter-rouge">map</code>æ˜ å°„, å°†æ•°æ®ç»“æ„æ˜ å°„åˆ°Eventæ¨¡å‹ä¸­.</li>
  <li>æœ€åè¿›è¡Œè®¢é˜…æ‰§è¡Œæ“ä½œå¹¶æ·»åŠ åˆ°<code class="highlighter-rouge">DisposeBag</code>ä¸­.</li>
</ul>

<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸‹æ‹¿åˆ°äº†æ˜ å°„å®Œæˆåçš„[Event]æ¨¡å‹æ•°ç»„åçš„æ‰§è¡Œæ“ä½œ.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>    func processEvents(_ newEvents: [Event]) {
        
        var updatedEvents = newEvents + events.value
        if updatedEvents.count &gt; 50 {
            updatedEvents = Array&lt;Event&gt;(updatedEvents.prefix(upTo: 50))
        }
        
        events.value = updatedEvents
        tableView.reloadData()
        refreshControl?.endRefreshing()
        
        let eventsArray = updatedEvents.map{ $0.dictionary } as NSArray
        eventsArray.write(to: eventsFileURL, atomically: true)
        
    }
</code></pre>
</div>
<ul>
  <li>æ‹¿åˆ°æ¨¡å‹æ•°ç»„çš„ä¸ªæ•°åå–å¦‚æœè¶…è¿‡50ä¸ª, å–å‰é¢50ä¸ªæ•°æ®.</li>
  <li>åˆ·æ–°tableView, refreshControlç»“æŸåˆ·æ–°, å¹¶å°†æ˜ å°„æ¨¡å‹ç¼“å­˜åˆ°æ²™ç›’.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>func cachedFileURL(_ fileName: String) -&gt; URL {
    return FileManager.default.urls(for: .cachesDirectory, in: .allDomainsMask).first!.appendingPathComponent(fileName)
}

class ViewController: UITableViewController {

    fileprivate let repo = "coderZsq/coderZsq.target.swift"
    fileprivate let events = Variable&lt;[Event]&gt;([])
    fileprivate let bag = DisposeBag()
    
    fileprivate let eventsFileURL = cachedFileURL("events.plist")
    fileprivate let modifiedFileURL = cachedFileURL("modified.txt")
    fileprivate let lastModified = Variable&lt;NSString?&gt;(nil)
    
    override func viewDidLoad() {
        super.viewDidLoad()
        title = repo
        
        let eventsArray = (NSArray(contentsOf: eventsFileURL)
            as? [[String: Any]]) ?? []
        events.value = eventsArray.flatMap(Event.init)
        lastModified.value = try? NSString(contentsOf: modifiedFileURL, usedEncoding: nil)
        
        setupRefreshControl()
    }
}
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">cachedFileURL</code>ç¼“å­˜è·¯å¾„åœ°å€</li>
  <li>æ¯æ¬¡å…ˆæ‰§è¡Œç¼“å­˜æœ¬åœ°çš„æ˜ å°„æ•°æ®å†è¿›è¡Œç½‘ç»œè¯·æ±‚.</li>
</ul>

<p>æ˜ å°„å’Œè¿‡æ»¤çš„å¥½å¤„åœ¨äºä¸€åˆ‡éƒ½åœ¨åå°çº¿ç¨‹è¿›è¡Œ, å¹¶åœ¨æ˜ å°„å’Œè¿‡æ»¤çš„è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿä¸åŒ¹é…çš„æƒ…å†µ, ä¹‹åçš„æ“ä½œå°±ä¼šè¢«æ‰“æ–­, ä¸å†æ‰§è¡Œ.</p>

<p>æ¼”ç¤ºæ•ˆæœ:
<img src="http://upload-images.jianshu.io/upload_images/1229762-86d2e2011251ccd6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>About:</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-3f8925783027b3fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è·³è½¬!!" /></p>

<p><a href="https://github.com/coderZsq/coderZsq.target.swift">ğŸŒŸ æºç  è¯·ç‚¹è¿™é‡ŒğŸŒŸÂ Â»&gt; å–œæ¬¢çš„æœ‹å‹è¯·ç‚¹å–œæ¬¢Â Â»&gt; ä¸‹è½½æºç çš„åŒå­¦è¯·é€ä¸‹å°æ˜Ÿæ˜ŸÂ Â»&gt; æœ‰é—²é’±çš„å£•ä»¬å¯ä»¥è¿›è¡Œæ‰“èµÂ Â»&gt; å°å¼Ÿä¼šå°½å¿«æ¨å‡ºæ›´å¥½çš„æ–‡ç« å’Œå¤§å®¶åˆ†äº«Â Â»&gt; ä½ çš„æ¿€åŠ±å°±æ˜¯æˆ‘çš„åŠ¨åŠ›!! </a></p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æœ€è¿‘çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E5%90%88%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/" title="link to RxSwift å‡½æ•°å¼ç»„åˆè¿ç®—ç¬¦å®æ“">RxSwift å‡½æ•°å¼ç»„åˆè¿ç®—ç¬¦å®æ“</a></h2>
       <p class="excerpt">  ä¸Šå‘¨æˆ‘ä»¬å¼€å¯äº†RxSwiftçš„å­¦ä¹ ä¹‹æ—…, ä»å¯è§‚å¯Ÿåºåˆ—â€“&gt;è¿‡æ»¤è¿ç®—ç¬¦â€“&gt;æ˜ å°„è¿ç®—ç¬¦, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯´è¯´ç»„åˆè¿ç®—ç¬¦. è¯´å®è¯, å¯¹äºä¹‹å‰çš„å†…å®¹çš„å­¦ä¹ , æˆ‘è§‰å¾—è¿˜æ˜¯æ¯”è¾ƒé€šä¿—æ˜“æ‡‚çš„, ä½†æ˜¯è¿™æ¬¡çš„ç»„åˆè¿ç®—ç¬¦ç›¸æ¯”ä¹‹å‰åœ¨ç†è§£éš¾æ˜“ç¨‹åº¦ä¸Šåˆä¸Šäº†ä¸ªæ¡£æ¬¡, æœ¬èŠ‚æˆ‘ä»¬å°±æ¥æ”»å…‹è¿™ä¸€æŒ‘æˆ˜å§! ä»£ç è§:githubæœ¬èŠ‚æ‰€éœ€çš„ä¸€äº›å…³äºç»„åˆçš„åŸºæœ¬çŸ¥è¯†å·²ç»æ›´æ–°åˆ°githubä»£ç ä¸­çš„playgroundæ–‡ä»¶ä¸­, æ²¡æœ‰æ¥è§¦è¿‡å“åº”å¼ç¼–ç¨‹çš„åŒå­¦è¯·å’Œä¹‹å‰ä¸€æ ·å…ˆè¡Œåœ¨playgroundä¸­äº†è§£æ¦‚è¦ä»¥ä¾¿æ›´å¥½çš„ç†è§£æœ¬æ–‡. æœ¬...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-24 14:51:00 +0800" class="post-list__meta--date date">2017-04-24</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E5%90%88%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æ›´æ—©çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E8%BF%87%E6%BB%A4%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/" title="link to RxSwift å‡½æ•°å¼è¿‡æ»¤è¿ç®—ç¬¦å®æ“">RxSwift å‡½æ•°å¼è¿‡æ»¤è¿ç®—ç¬¦å®æ“</a></h2>
       <p class="excerpt">  æ¥ç€ä¸Šä¸€éƒ¨åˆ†, æˆ‘ä»¬å·²ç»å®Œæˆäº†å‡½æ•°å¼ç¼–ç¨‹çš„ç®€å•å®è·µ, ä¹ŸåŒæ—¶æ¥è§¦äº†Photosæ¡†æ¶å¸¦æ¥çš„è‡ªå®šä¹‰çš„ä¾¿åˆ©, ä¸»è¦ç†Ÿæ‚‰äº†Variable, Subject ä½œä¸º Observable è¿›è¡Œè®¢é˜… subscribe å¹¶é€šè¿‡å¤„ç½®åŒ…DisposeBag å¤„ç†çš„å…·ä½“æ¡ˆä¾‹, è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è¿›ä¸€æ­¥å®Œå–„ç›¸ç‰‡æ‹¼å›¾. ä»£ç è§:githubæœ¬èŠ‚æ‰€éœ€çš„ä¸€äº›å…³äºè®¢é˜…ä¿¡æ¯è¿‡æ»¤çš„åŸºæœ¬çŸ¥è¯†å·²ç»æ›´æ–°åˆ°githubä»£ç ä¸­çš„playgroundæ–‡ä»¶ä¸­, æ²¡æœ‰æ¥è§¦è¿‡å“åº”å¼ç¼–ç¨‹çš„åŒå­¦è¯·å’Œä¹‹å‰ä¸€æ ·å…ˆè¡Œåœ¨playgroundä¸­äº†è§£æ¦‚è¦ä»¥...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-19 11:50:00 +0800" class="post-list__meta--date date">2017-04-19</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E8%BF%87%E6%BB%A4%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… è®¸å¯åè®®</a></span>
        <span class="footer__copyright">ç”± <a href="https://jekyllrb.com">Jekyll</a> äº 2020-09-16 ç”Ÿæˆï¼Œæ„Ÿè°¢ <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> ä¸ºæœ¬ç«™æä¾›ç¨³å®šçš„ VPS æœåŠ¡</span>
        <span class="footer__copyright">æœ¬ç«™ç”± <a href="https://github.com/coderZsq">@Castie!</a> åˆ›å»ºï¼Œé‡‡ç”¨ <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> ä½œä¸ºä¸»é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ GitHub æ‰¾åˆ°<a href="https://github.com/onevcat/OneV-s-Den">æœ¬ç«™æºç </a> - &copy; 2020</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
