<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Castie! Notes</title>
  <meta name="description" content="  ä¸Šä¸ªç³»åˆ—çš„æ¶æ„è®¾è®¡, ä»MVC -&gt; MVVM -&gt; MVP -&gt; Router -&gt; Downgradable, æˆ‘ä»¬å®ç°äº†é€šè¿‡åˆ†å±‚å°†å„ä¸ªç»„ä»¶è¿›è¡Œè§£è€¦å¹¶åŠ¨æ€çš„å‡é™çº§é¡µé¢, è¿™ä¸€ç³»åˆ—å‡†å¤‡è¯´è¯´å¦‚ä½•é€šè¿‡RxSwiftè¿›è¡Œå“åº”å¼ç¼–ç¨‹æ›´å¥½çš„å’Œæ¶æ„è®¾è®¡è¿›è¡ŒååŒ. ä»£ç è§:github">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="RxSwift å¤§ç¥ä»¬éƒ½åœ¨çœ‹çš„å“åº”å¼">
  <meta name="twitter:description" content="  ä¸Šä¸ªç³»åˆ—çš„æ¶æ„è®¾è®¡, ä»MVC -&gt; MVVM -&gt; MVP -&gt; Router -&gt; Downgradable, æˆ‘ä»¬å®ç°äº†é€šè¿‡åˆ†å±‚å°†å„ä¸ªç»„ä»¶è¿›è¡Œè§£è€¦å¹¶åŠ¨æ€çš„å‡é™çº§é¡µé¢, è¿™ä¸€ç³»åˆ—å‡†å¤‡è¯´è¯´å¦‚ä½•é€šè¿‡RxSwiftè¿›è¡Œå“åº”å¼ç¼–ç¨‹æ›´å¥½çš„å’Œæ¶æ„è®¾è®¡è¿›è¡ŒååŒ. ä»£ç è§:github">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="RxSwift å¤§ç¥ä»¬éƒ½åœ¨çœ‹çš„å“åº”å¼">
  <meta property="og:description" content="  ä¸Šä¸ªç³»åˆ—çš„æ¶æ„è®¾è®¡, ä»MVC -&gt; MVVM -&gt; MVP -&gt; Router -&gt; Downgradable, æˆ‘ä»¬å®ç°äº†é€šè¿‡åˆ†å±‚å°†å„ä¸ªç»„ä»¶è¿›è¡Œè§£è€¦å¹¶åŠ¨æ€çš„å‡é™çº§é¡µé¢, è¿™ä¸€ç³»åˆ—å‡†å¤‡è¯´è¯´å¦‚ä½•é€šè¿‡RxSwiftè¿›è¡Œå“åº”å¼ç¼–ç¨‹æ›´å¥½çš„å’Œæ¶æ„è®¾è®¡è¿›è¡ŒååŒ. ä»£ç è§:github">
  
  <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
  <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/ico">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2017/04/RxSwift-%E5%A4%A7%E7%A5%9E%E4%BB%AC%E9%83%BD%E5%9C%A8%E7%9C%8B%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F/">
  <link rel="alternate" type="application/rss+xml" title="Castie!" href="http://localhost:4000/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="å‰å¾€ Castie! çš„ä¸»é¡µ" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Castie! logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Castie!" class="blog-button">Castie!</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">æ­£æ€åˆ†å¸ƒ, ä¼˜åŠ£ä¼´ç”Ÿ</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">åŒ—å†¥æœ‰é±¼ï¼Œå…¶åä¸ºé²²ï¼ˆkÅ«nï¼‰ã€‚é²²ä¹‹å¤§ï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›åŒ–è€Œä¸ºé¸Ÿï¼Œå…¶åä¸ºé¹ã€‚é¹ä¹‹èƒŒï¼Œä¸çŸ¥å…¶å‡ åƒé‡Œä¹Ÿï¼›æ€’è€Œé£ï¼Œå…¶ç¿¼è‹¥å‚å¤©ä¹‹äº‘ã€‚æ˜¯é¸Ÿä¹Ÿï¼Œæµ·è¿åˆ™å°†å¾™äºå—å†¥ã€‚å—å†¥è€…ï¼Œå¤©æ± ä¹Ÿã€‚</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description">åŒ—æµ·è‹¥æ›°ï¼šâ€œäº•é¼ƒä¸å¯ä»¥è¯­äºæµ·è€…ï¼Œæ‹˜äºè™šä¹Ÿï¼›å¤è™«ä¸å¯ä»¥è¯­äºå†°è€…ï¼Œç¬ƒäºæ—¶ä¹Ÿï¼›æ›²å£«ä¸å¯ä»¥è¯­äºé“è€…ï¼ŒæŸäºæ•™ä¹Ÿã€‚ä»Šå°”å‡ºäºå´–æ¶˜ï¼Œè§‚äºå¤§æµ·ï¼Œä¹ƒçŸ¥å°”ä¸‘ï¼Œå°”å°†å¯ä¸è¯­å¤§ç†çŸ£ã€‚</p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="è®¿é—®åšå®¢" class="blog-button">åšå®¢</a></li>
                
                  <li class="navigation__item"><a href="https://coderzsq.github.io/coderZsq.practice.web/" target="_blank" title="æˆ‘çš„ç®€å†">ç®€å†</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
    <!-- juejin-->
    <li class="navigation__item">
      <a href="https://juejin.im/user/57e735dfa22b9d00614eecb8/posts" title="@coderZsq çš„ç¨€åœŸæ˜é‡‘" target="_blank">
        <i class='social fa fa-book'></i>
        <span class="label">juejin</span>
      </a>
    </li>
    

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/coderZsq" title="@coderZsq çš„ Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:a13701777868@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-04-18 12:13:00 +0800" itemprop="datePublished" class="post-meta__date date">2017-04-18</time> &#8226; <span class="post-meta__tags tags">ç§»åŠ¨å¼€å‘</span>
    </div>
    <h1 class="post-title">RxSwift å¤§ç¥ä»¬éƒ½åœ¨çœ‹çš„å“åº”å¼</h1>
  </header>

  <section class="post">
    <blockquote>
  <p>ä¸Šä¸ªç³»åˆ—çš„æ¶æ„è®¾è®¡, ä»MVC -&gt; MVVM -&gt; MVP -&gt; Router -&gt; Downgradable, æˆ‘ä»¬å®ç°äº†é€šè¿‡åˆ†å±‚å°†å„ä¸ªç»„ä»¶è¿›è¡Œè§£è€¦å¹¶åŠ¨æ€çš„å‡é™çº§é¡µé¢, è¿™ä¸€ç³»åˆ—å‡†å¤‡è¯´è¯´å¦‚ä½•é€šè¿‡RxSwiftè¿›è¡Œå“åº”å¼ç¼–ç¨‹æ›´å¥½çš„å’Œæ¶æ„è®¾è®¡è¿›è¡ŒååŒ. ä»£ç è§:<a href="https://github.com/coderZsq/coderZsq.target.swift">github</a></p>
</blockquote>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-a67b7f2ab21d4b23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>è¿™ç³»åˆ—æ‰€è¿°æ¡ˆä¾‹æ˜¯é€šè¿‡Rayå®¶çš„RxSwiftä¸€ä¹¦è¿›è¡Œç¬”è®°, åœ¨å­¦ä¹ æœ¬ç¯‡ä¹‹å‰, è¯·ç¡®ä¿ç†Ÿç»ƒæŒæ¡Swift3åŸºç¡€è¯­æ³•å¹¶å…·å¤‡ä¸­çº§iOSå¼€å‘èƒ½åŠ›. å¯¹äºRxSwiftçš„æ¦‚å¿µä¸æ˜¯å¾ˆæ¸…æ™°çš„åŒå­¦å¯ä»¥å‚ç…§æœ¬æ–‡ä»£ç ä¸­çš„<a href="https://github.com/coderZsq/coderZsq.target.swift/blob/master/AlbumPuzzle/AlbumPuzzle.playground/Contents.swift">playground</a>äº‹å…ˆç†Ÿæ‚‰, ä¸ç†è§£çš„è¯·å…ˆæŸ¥é˜…æ¦‚è¦, ä»¥ä¾¿æ›´å¥½çš„äº†è§£æœ¬æ–‡.</p>

<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦é€šè¿‡cocapodsè¿›è¡Œå¼•å…¥RxSwift:</p>
<div class="highlighter-rouge"><pre class="highlight"><code># Uncomment the next line to define a global platform for your project
platform :ios, '10.0'

target 'AlbumPuzzle' do
    # Comment the next line if you're not using Swift and don't want to use dynamic frameworks
    use_frameworks!
    
    # Pods for AlbumPuzzle
    pod 'RxSwift',    '~&gt; 3.2'
    pod 'RxCocoa',    '~&gt; 3.2'
    
end
</code></pre>
</div>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-46cac43c61b71c6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›å¿…è¦çš„æ§ä»¶, é¿å…ä»£ç è¿‡å¤š, æˆ‘ä»¬å°±é€šè¿‡StoryBoardæ¥è¿›è¡ŒViewå±‚çš„å¸ƒå±€, ç¬¬ä¸€ä¸ªé¡µé¢ä¸­æˆ‘ä»¬éœ€è¦å››ä¸ªæ§ä»¶: å±•ç¤ºå›¾ç‰‡, æ·»åŠ æŒ‰é’®, æ¸…é™¤æŒ‰é’®, ä¿å­˜æŒ‰é’®. ç¬¬äºŒä¸ªé¡µé¢å°±æ˜¯ä¸ªç®€å•çš„CollectoinViewController.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class ViewController: UIViewController {
    
    @IBOutlet weak var imagePreview: UIImageView!
    @IBOutlet weak var buttonClear: UIButton!
    @IBOutlet weak var buttonSave: UIButton!
    @IBOutlet weak var itemAdd: UIBarButtonItem!
    
    fileprivate let bag = DisposeBag()
    fileprivate let images = Variable&lt;[UIImage]&gt;([])
    
    override func viewDidLoad() {
        super.viewDidLoad()
        setupObservable()
    }
}

extension ViewController {
    
    fileprivate func setupObservable() {
        
        images.asObservable().subscribe(onNext: { [weak self] images in
            guard let preview = self?.imagePreview else { return }
            preview.image = UIImage.collage(images: images, size: preview.frame.size)
        }).addDisposableTo(bag)
        
        images.asObservable().subscribe(onNext: { [weak self] images in
            self?.updateUI(images: images)
        }).addDisposableTo(bag)
    }
    
    fileprivate func updateUI(images: [UIImage]) {
        buttonSave.isEnabled = images.count &gt; 0 &amp;&amp; images.count % 2 == 0
        buttonClear.isEnabled = images.count &gt; 0
        itemAdd.isEnabled = images.count &lt; 6
        title = images.count &gt; 0 ? "\(images.count) photos" : "Collage"
    }
}


extension ViewController {
    
    @IBAction func actionAdd() {
        images.value.append(UIImage(named: "Castie!")!)
    }
    
    @IBAction func actionClear() {
        images.value = []
    }
    
    @IBAction func actionSave() {
        
    }
}
</code></pre>
</div>
<p>æˆ‘ä»¬è¿›å…¥ViewController, åˆ›å»ºä¸¤ä¸ªç§æœ‰å˜é‡, bag, æ˜¯ä¸€ä¸ªDisposeBagå®ä¾‹, imagesæ˜¯ä¸€ä¸ªVariableçš„æ³›å‹ <code class="highlighter-rouge">å¯¹äºDisposeBagå’ŒVariableä¸äº†è§£çš„åŒå­¦è¯·äº‹å…ˆæŸ¥é˜…playgroundä¸­çš„å†…å®¹</code> , é€šè¿‡extensionçš„è¯­æ³•<code class="highlighter-rouge"> Swiftçš„è£…é¥°æ¨¡å¼ </code>è¿›è¡Œä»£ç åˆ†åŒº,  é€šè¿‡å¯¹imagesæ·»åŠ è®¢é˜…ç›‘å¬imagesæ•°ç»„å‘ç”Ÿçš„å˜åŒ–, å¹¶å¯¹æŒ‰é’®ç‚¹å‡»è¿›è¡Œæ“ä½œ. ä¸ºäº†å®ç°æ›´å¥½çš„æ•ˆæœ, éœ€è¦å¼•å…¥UIImage+Collageåˆ†ç±».</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-6a3d4c76e8003a66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>è¿™æ ·æˆ‘ä»¬å°±ç®€å•çš„å®ç°äº†å“åº”å¼ç¼–ç¨‹, å½“è®¢é˜…è€…çš„å€¼è¢«æ”¹å˜çš„æ—¶å€™, å°±ä¼šæ›´æ–°æ“ä½œ. å°±å’ŒKVOçš„ç›‘å¬æ•ˆæœç›¸ä¼¼. ç”±äºiOS10å¼€å§‹å¯¹äºè®¿é—®ç”¨æˆ·ä¿¡æ¯çš„æœºåˆ¶æœ‰æ‰€æ›´æ–°, æœ¬ä¾‹ä¸­éœ€è¦è®¿é—®ç”¨æˆ·ç›¸å†Œ, æ‰€ä»¥åœ¨info.plistè¿›è¡Œå¦‚ä¸‹é…ç½®:
Privacy - Photo Library Usage Description, We need access to your deviceâ€™s photo library to allow you to select photos for your collage.</p>

<p>è¿›è¡Œé…ç½®å®Œæˆ, æˆ‘ä»¬å°±é€šè¿‡Photosç³»ç»Ÿæ¡†æ¶æ¥è¿›è¡Œå¯¹ç³»ç»Ÿç›¸å†Œä¸­çš„å›¾ç‰‡è¿›è¡Œè·å–, å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨UIImagePickerController, é¢„çŸ¥å¦‚ä½•ä½¿ç”¨è¯·<a href="http://www.jianshu.com/p/555786f35357">ç‚¹å‡»</a>!</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import UIKit
import Photos
import RxSwift

private let reuseIdentifier = "Cell"

class AlbumViewController: UICollectionViewController {
    
    let bag = DisposeBag()
    var selectedImages: Observable&lt;UIImage&gt; {
        return selectedImagesSubject.asObservable()
    }
    
    fileprivate let selectedImagesSubject = PublishSubject&lt;UIImage&gt;()
    fileprivate lazy var images = AlbumViewController.loadImages()
    fileprivate lazy var imageManager = PHCachingImageManager()
    fileprivate lazy var thumbnailSize: CGSize = {
        let cellSize = (self.collectionViewLayout as! UICollectionViewFlowLayout).itemSize
        return CGSize(width: cellSize.width * UIScreen.main.scale,
                      height: cellSize.height * UIScreen.main.scale)
    }()
    
    override func viewDidLoad() {
        super.viewDidLoad()
        self.collectionView!.register(UICollectionViewCell.self, forCellWithReuseIdentifier: reuseIdentifier)
    }
}

extension AlbumViewController {
    
    static func loadImages() -&gt; PHFetchResult&lt;PHAsset&gt; {
        let allImagesOptions = PHFetchOptions()
        allImagesOptions.sortDescriptors = [NSSortDescriptor(key: "creationDate", ascending: true)]
        return PHAsset.fetchAssets(with: allImagesOptions)
    }
}

extension AlbumViewController {
    
    override func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int {
        return images.count
    }
    
    override func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {
        
        let asset = images.object(at: indexPath.item)
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: reuseIdentifier, for: indexPath)
        imageManager.requestImage(for: asset, targetSize: thumbnailSize, contentMode: .aspectFill, options: nil, resultHandler: { image, _ in
            cell.layer.contents = image?.cgImage
        })
        return cell
    }
    
    override func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) {
        
        let asset = images.object(at: indexPath.item)

        if let cell = collectionView.cellForItem(at: indexPath) {
            cell.alpha = 0
            UIView.animate(withDuration: 0.5, animations: {
                cell.alpha = 1
            })
        }

        imageManager.requestImage(for: asset, targetSize: view.frame.size, contentMode: .aspectFill, options: nil, resultHandler: { [weak self] image, info in
            guard let image = image, let info = info else { return }
            
            if let isThumbnail = info[PHImageResultIsDegradedKey as NSString] as? Bool, !isThumbnail {
                self?.selectedImagesSubject.onNext(image)
            }
        })
    }
}

</code></pre>
</div>
<p>è¿™é‡Œç®€è¦çš„è¯´ä¸‹Photosè¿™ä¸ªç³»ç»Ÿæ¡†æ¶, Photos frameworkæ˜¯iOS8è‹¹æœæä¾›çš„æ–°çš„å›¾ç‰‡æ¡†æ¶ï¼Œèƒ½ç›´æ¥è·å–å›¾ç‰‡å’Œè§†é¢‘ï¼ŒåŒ…æ‹¬iCloudä¸Šé¢çš„å›¾åº“ã€‚ä½¿ç”¨è¿™ä¸ªæ¡†æ¶å¯ä»¥è·å–assetsæ¥å±•ç¤ºå’Œå›æ”¾ï¼Œç¼–è¾‘å›¾ç‰‡æˆ–è€…è§†é¢‘å†…å®¹ï¼Œæˆ–è€…ä½¿ç”¨ç³»ç»Ÿç›¸å†Œã€æ—¶åˆ»ã€å’Œåˆ†äº«åˆ°iCloudçš„ç›¸å†Œæ¥è¿›è¡Œç›¸å…³æ“ä½œ.</p>

<p>æˆ‘ä»¬è¿™é‡Œç”¨åˆ°çš„æœ‰<code class="highlighter-rouge">PHCachingImageManager</code>, <code class="highlighter-rouge">PHFetchResult</code>, <code class="highlighter-rouge">PHFetchOptions</code>, <code class="highlighter-rouge">PHAsset</code></p>

<p>PHCachingImageManageræ˜¯PHImageManagerçš„å­ç±»ï¼Œå¦‚æœç›¸å†Œä¸­æœ‰å¤§é‡çš„å›¾ç‰‡ï¼Œè€Œä½ çš„éœ€æ±‚æ˜¯è¦å¿«é€Ÿçš„è·å–è¿™äº›å›¾ç‰‡çš„ç¼©ç•¥å›¾å’Œå¤§å›¾æ•°æ®ç”¨äºå±•ç¤ºï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç”¨PHCachingImageManageræ¥å®ç°ï¼Œå®ƒå…·æœ‰ç¼“å­˜æœºåˆ¶å¯ä»¥å¿«é€Ÿè·å–ä¸€ä¸ªå›¾å†Œçš„ç¼©ç•¥å›¾ï¼Œæˆ–è€…åœ¨åå°è¯·æ±‚å…¨å°ºå¯¸å›¾ç‰‡ä»¥ä¾¿äºå¿«é€Ÿå±•ç¤ºã€‚</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/**
 *  ä¼šå¤šæ¬¡è°ƒç”¨'resultHandler'ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œè¿”å›çš„å›¾ç‰‡æ¸…æ™°åº¦è¾ƒä½ï¼Œ
 *  å½“é«˜æ¸…æ™°åº¦å›¾ç‰‡å¯ä»¥è·å–æ—¶,ä¼šå†æ¬¡è°ƒç”¨ï¼Œå¦‚æœé«˜è´¨é‡çš„å›¾ç‰‡åœ¨ç¼“å­˜æ±‡ä¸­ï¼Œåªè°ƒç”¨ä¸€æ¬¡'resultHandler'ã€‚
 *  è¿™ä¸ªæ–¹æ³•é»˜è®¤æ˜¯å¼‚æ­¥çš„ï¼Œå½“ä»åå°çº¿ç¨‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œéœ€è¦å°†optionsçš„'synchronous'è®¾ä¸ºYES.
 *
 *  @param asset         ä¿å­˜å›¾ç‰‡ä¿¡æ¯çš„asset
 *  @param targetSize    è¿”å›çš„å›¾ç‰‡å°ºå¯¸
 *  @param contentMode   è¿”å›çš„å›¾ç‰‡æ˜¾ç¤ºæ¨¡å¼
 *  @param options       image request option
 *  @param resultHandler è¿”å›çš„å†…å®¹
 *
 *  @return è¯·æ±‚æ ‡ç¤ºï¼Œç”¨äºå–æ¶ˆè¯·æ±‚*/
    open func requestImage(for asset: PHAsset, targetSize: CGSize, contentMode: PHImageContentMode, options: PHImageRequestOptions?, resultHandler: @escaping (UIImage?, [AnyHashable : Any]?) -&gt; Swift.Void) -&gt; PHImageRequestID
</code></pre>
</div>

<p>PHFetchResultæ˜¯æœ‰åºçš„photoå®ä½“å¯¹è±¡çš„å®¹å™¨ï¼ŒåŒ…å«é€šè¿‡ç»™å®šçš„æ£€ç´¢æ¡ä»¶è¿”å›çš„assetï¼Œç›¸å†Œï¼Œä¸€ä¸ªç›¸å†Œç±»å‹ä¸­çš„æ‰€æœ‰ç›¸å†Œåˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼Œsmart albumç±»å‹ä¸‹çš„æ‰€æœ‰ç›¸å†Œï¼Œå®ƒæ˜¯æœ‰åºçš„ï¼‰ï¼Œåœ¨PHAsset,PHCollection,PHAssetcollection,PHCollectionListè¿™å‡ ä¸ªç±»ä¸­éƒ½åŒ…å«æœ‰ç›¸åº”çš„ç±»æ–¹æ³•åŒ…å«å¯¹åº”ä¿¡æ¯çš„PHFetchRequestå¯¹è±¡,ä¾‹å¦‚ï¼š</p>
<div class="highlighter-rouge"><pre class="highlight"><code>    open class func fetchAssets(with options: PHFetchOptions?) -&gt; PHFetchResult&lt;PHAsset&gt;
</code></pre>
</div>

<p>PHFetchOptions: å½“ä½ ä½¿ç”¨æ²¡æ–¹æ³•è·å–PHAssetï¼ˆå›¾ç‰‡å’Œè§†é¢‘ï¼‰,PHCollectionï¼ˆç›¸å†Œç±»å‹ï¼‰,PHAssetCollectionï¼ˆç›¸å†Œï¼‰çš„å®ä½“ï¼ˆç›¸å½“äºåŒ…å«å¤šä¸ªæ•°æ®çš„æ¨¡å‹ï¼‰ä½¿ç”¨PHFetchOptionså¯¹è±¡æŒ‡å®šæ“ä½œï¼Œä¾‹å¦‚è·å–çš„å®ä½“çš„æ’åˆ—å±æ€§ç­‰ã€‚</p>

<p>è¿™é‡Œçš„æ“ä½œå¾ˆç®€å•, å°±æ˜¯é€šè¿‡è®¿é—®ç‰¹å®šé€‰é¡¹çš„PHFetchOptionså¾—åˆ°PHFetchResultä¸­çš„PHAssetå¹¶ä½¿ç”¨PHCachingImageManagerè¯·æ±‚ç³»ç»Ÿç›¸å†Œå¾—åˆ°ç›¸åº”çš„å›¾ç‰‡å¹¶é€šè¿‡å¯„å®¿å›¾çš„æ–¹å¼å±•ç¤ºåˆ°Cellä¸Š.</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-425a3b6c535f638d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>å“åº”å¼ç¼–ç¨‹çš„å…³é”®æˆ‘ä»¬åœ¨Cellç‚¹å‡»çš„å‡½æ•°ä¸­çš„ä»¥ä¸‹ä»£ç :</p>
<div class="highlighter-rouge"><pre class="highlight"><code> if let isThumbnail = info[PHImageResultIsDegradedKey as NSString] as? Bool, !isThumbnail {
       self?.selectedImagesSubject.onNext(image)
}
</code></pre>
</div>
<p>é€šè¿‡å‘å¸ƒå¯¹è±¡PublishSubjectçš„onNextæ–¹æ³•å°†æ•°æ®å‘é€ç»™è®¢é˜…è€…, å›åˆ°ViewController, æˆ‘ä»¬å¯¹éƒ¨åˆ†ä»£ç è¿›è¡Œæ›´æ–°:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    @IBAction func actionAdd() {
//        images.value.append(UIImage(named: "Castie!")!)
        
        let albumViewController = storyboard?.instantiateViewController(withIdentifier: "AlbumViewController") as! AlbumViewController
        
        albumViewController.selectedImages.subscribe(
            onNext: { [weak self] newImage in
                guard let images = self?.images else { return }
                images.value.append(newImage)
            },
            onDisposed: {
                print("completed photo selection")
            }
        ).addDisposableTo(albumViewController.bag)
        
        navigationController?.pushViewController(albumViewController, animated: true)
    }
</code></pre>
</div>

<p>è¿™æ ·æˆ‘ä»¬å°±é€šè¿‡RxSwiftå®ç°äº†é¡µé¢ä¹‹é—´çš„å“åº”å¼äº¤äº’, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°å›¾ç‰‡çš„ä¿å­˜æ“ä½œ:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>class AlbumWriter: NSObject {
    
    typealias Callback = (NSError?)-&gt;Void
    
    private var callback: Callback
    private init(callback: @escaping Callback) {
        self.callback = callback
    }
    
    func image(_ image: UIImage, didFinishSavingWithError error: NSError?, contextInfo: UnsafeRawPointer) {
        callback(error)
    }
    
    static func save(_ image: UIImage) -&gt; Observable&lt;Void&gt; {
        return Observable.create({ observer in
            let writer = AlbumWriter(callback: { error in
                if let error = error {
                    observer.onError(error)
                } else {
                    observer.onCompleted()
                }
            })
            UIImageWriteToSavedPhotosAlbum(image, writer, #selector(AlbumWriter.image(_:didFinishSavingWithError:contextInfo:)), nil)
            return Disposables.create()
        })
    }
}
</code></pre>
</div>
<p>å°è£…ä¸€ä¸ªå›¾ç‰‡å‚¨å­˜çš„AlbumWriterç±», é€šè¿‡Createæ–¹æ³•æ¥åˆ›å»ºè§‚å¯Ÿè€….</p>

<div class="highlighter-rouge"><pre class="highlight"><code>@IBAction func actionSave() {
        
        guard let image = imagePreview.image else { return }
        
        AlbumWriter.save(image).subscribe(
            
            onError: { [weak self] error in
            self?.showMessage("Error", description: error.localizedDescription)
            
            }, onCompleted: { [weak self] in
                self?.showMessage("Saved")
                self?.actionClear()
            }
            
        ).addDisposableTo(bag)
    }

</code></pre>
</div>
<p>æœ€ååœ¨Saveæ“ä½œçš„æ—¶å€™è¿›è¡Œè®¢é˜…å°±å¤§åŠŸå‘Šæˆäº†!!</p>

<p>æ¼”ç¤ºæ•ˆæœ:</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-9b240f1eb5dac87a.gif?imageMogr2/auto-orient/strip" alt="" /></p>

<p>About:</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-3f8925783027b3fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è·³è½¬!!" /></p>

<p><a href="https://github.com/coderZsq/coderZsq.target.swift">ğŸŒŸ æºç  è¯·ç‚¹è¿™é‡ŒğŸŒŸÂ Â»&gt; å–œæ¬¢çš„æœ‹å‹è¯·ç‚¹å–œæ¬¢Â Â»&gt; ä¸‹è½½æºç çš„åŒå­¦è¯·é€ä¸‹å°æ˜Ÿæ˜ŸÂ Â»&gt; æœ‰é—²é’±çš„å£•ä»¬å¯ä»¥è¿›è¡Œæ‰“èµÂ Â»&gt; å°å¼Ÿä¼šå°½å¿«æ¨å‡ºæ›´å¥½çš„æ–‡ç« å’Œå¤§å®¶åˆ†äº«Â Â»&gt; ä½ çš„æ¿€åŠ±å°±æ˜¯æˆ‘çš„åŠ¨åŠ›!! </a></p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æœ€è¿‘çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E8%BF%87%E6%BB%A4%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/" title="link to RxSwift å‡½æ•°å¼è¿‡æ»¤è¿ç®—ç¬¦å®æ“">RxSwift å‡½æ•°å¼è¿‡æ»¤è¿ç®—ç¬¦å®æ“</a></h2>
       <p class="excerpt">  æ¥ç€ä¸Šä¸€éƒ¨åˆ†, æˆ‘ä»¬å·²ç»å®Œæˆäº†å‡½æ•°å¼ç¼–ç¨‹çš„ç®€å•å®è·µ, ä¹ŸåŒæ—¶æ¥è§¦äº†Photosæ¡†æ¶å¸¦æ¥çš„è‡ªå®šä¹‰çš„ä¾¿åˆ©, ä¸»è¦ç†Ÿæ‚‰äº†Variable, Subject ä½œä¸º Observable è¿›è¡Œè®¢é˜… subscribe å¹¶é€šè¿‡å¤„ç½®åŒ…DisposeBag å¤„ç†çš„å…·ä½“æ¡ˆä¾‹, è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è¿›ä¸€æ­¥å®Œå–„ç›¸ç‰‡æ‹¼å›¾. ä»£ç è§:githubæœ¬èŠ‚æ‰€éœ€çš„ä¸€äº›å…³äºè®¢é˜…ä¿¡æ¯è¿‡æ»¤çš„åŸºæœ¬çŸ¥è¯†å·²ç»æ›´æ–°åˆ°githubä»£ç ä¸­çš„playgroundæ–‡ä»¶ä¸­, æ²¡æœ‰æ¥è§¦è¿‡å“åº”å¼ç¼–ç¨‹çš„åŒå­¦è¯·å’Œä¹‹å‰ä¸€æ ·å…ˆè¡Œåœ¨playgroundä¸­äº†è§£æ¦‚è¦ä»¥...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-19 11:50:00 +0800" class="post-list__meta--date date">2017-04-19</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/04/RxSwift-%E5%87%BD%E6%95%B0%E5%BC%8F%E8%BF%87%E6%BB%A4%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E6%93%8D/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æ›´æ—©çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/Hybird-%E6%90%AD%E5%BB%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E6%97%B6%E9%99%8D%E7%BA%A7%E6%9E%B6%E6%9E%84/" title="link to Hybird æ­å»ºå®¢æˆ·ç«¯å®æ—¶é™çº§æ¶æ„">Hybird æ­å»ºå®¢æˆ·ç«¯å®æ—¶é™çº§æ¶æ„</a></h2>
       <p class="excerpt">  RouterçœŸæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¸€ç§è®¾è®¡æ¨¡å¼, èƒ½å¤Ÿåšåˆ°è¶…ä½çš„è€¦åˆ, ä½œä¸ºç³»åˆ—çš„æœ€åä¸€èŠ‚, æˆ‘ä»¬æ¥ç»Ÿç­¹ä¸‰ç«¯, å®ç°çƒ­ä¿®å¤æ¶æ„, å†æ¥è¯´ä¸‹è¿™ä¸ªæ¶æ„çš„å®šä¹‰, å°±æ˜¯å½“Nativeé¡µé¢ä¸šåŠ¡é€»è¾‘å‡ºç°Bugæ—¶, åˆä¸èƒ½é©¬ä¸Šæ‰“åŒ…ä¸Šçº¿é€šè¿‡å®¡æ ¸çš„æƒ…å†µä¸‹, é€šè¿‡åå°é…ç½®å°†é¡µé¢é™çº§ä¸ºH5çš„é¡µé¢, ç­‰å¾…ä¿®å¤å®Œæˆä¸Šçº¿åå†å›åˆ°Nativeçš„è®¾è®¡æ€æƒ³.å‚è€ƒé“¾æ¥:  Hybird æ­å»ºé›¶è€¦åˆæ¶æ„ä»MVCå¼€å§‹  Hybird æ­å»ºåç«¯Koa.jså¹¶è¿‡åº¦åˆ°MVVM  Hybird æ­å»ºå‰ç«¯Vue.jså¹¶å‡çº§è‡³MVP  Hyb...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-12 16:37:00 +0800" class="post-list__meta--date date">2017-04-12</time> &#8226; <span class="post-list__meta--tags tags">ç§»åŠ¨å¼€å‘</span><a class="btn-border-small" href=/2017/04/Hybird-%E6%90%AD%E5%BB%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E6%97%B6%E9%99%8D%E7%BA%A7%E6%9E%B6%E6%9E%84/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… è®¸å¯åè®®</a></span>
        <span class="footer__copyright">ç”± <a href="https://jekyllrb.com">Jekyll</a> äº 2018-07-19 ç”Ÿæˆï¼Œæ„Ÿè°¢ <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> ä¸ºæœ¬ç«™æä¾›ç¨³å®šçš„ VPS æœåŠ¡</span>
        <span class="footer__copyright">æœ¬ç«™ç”± <a href="https://github.com/coderZsq">@Castie!</a> åˆ›å»ºï¼Œé‡‡ç”¨ <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> ä½œä¸ºä¸»é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ GitHub æ‰¾åˆ°<a href="https://github.com/onevcat/OneV-s-Den">æœ¬ç«™æºç </a> - &copy; 2018</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
