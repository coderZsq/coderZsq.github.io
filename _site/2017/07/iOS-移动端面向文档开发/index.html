<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Castie! Notes</title>
  <meta name="description"
    content="  之前的解耦架构生成器在实际项目中已经顺利测试通过了, 现在要做的是将文档规范出来, 并扩展到Android, HTML5端的共用, 实现面向文档开发.">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title"
    content="iOS 移动端面向文档开发">
  <meta name="twitter:description"
    content="  之前的解耦架构生成器在实际项目中已经顺利测试通过了, 现在要做的是将文档规范出来, 并扩展到Android, HTML5端的共用, 实现面向文档开发.">

  <meta property="og:type" content="article">
  <meta property="og:title"
    content="iOS 移动端面向文档开发">
  <meta property="og:description"
    content="  之前的解耦架构生成器在实际项目中已经顺利测试通过了, 现在要做的是将文档规范出来, 并扩展到Android, HTML5端的共用, 实现面向文档开发.">

  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2017/07/iOS-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%9D%A2%E5%90%91%E6%96%87%E6%A1%A3%E5%BC%80%E5%8F%91/">
  <link rel="alternate" type="application/rss+xml" title="Castie!"
    href="http://localhost:4000/feed.xml">

  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
</head>

  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="前往 Castie! 的主页" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Castie! logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Castie!" class="blog-button">Castie!</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">正态分布, 优劣伴生</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">北冥有鱼，其名为鲲（kūn）。鲲之大，不知其几千里也；化而为鸟，其名为鹏。鹏之背，不知其几千里也；怒而飞，其翼若垂天之云。是鸟也，海运则将徙于南冥。南冥者，天池也。</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description">北海若曰：“井鼃不可以语于海者，拘于虚也；夏虫不可以语于冰者，笃于时也；曲士不可以语于道者，束于教也。今尔出于崖涘，观于大海，乃知尔丑，尔将可与语大理矣。</p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
                
                  <li class="navigation__item"><a href="https://coderzsq.github.io/coderZsq.practice.web/" target="_blank" title="我的简历">简历</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
    <!-- juejin-->
    <li class="navigation__item">
      <a href="https://juejin.im/user/57e735dfa22b9d00614eecb8/posts" title="@coderZsq 的稀土掘金" target="_blank">
        <i class='social fa fa-book'></i>
        <span class="label">juejin</span>
      </a>
    </li>
    

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/coderZsq" title="@coderZsq 的 Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:a13701777868@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-07-21 14:21:00 +0800" itemprop="datePublished" class="post-meta__date date">2017-07-21</time> &#8226; <span class="post-meta__tags tags">移动开发</span>
    </div>
    <h1 class="post-title">iOS 移动端面向文档开发</h1>
  </header>

  <section class="post">
    <blockquote>
  <p>之前的解耦架构生成器在实际项目中已经顺利测试通过了, 现在要做的是将文档规范出来, 并扩展到Android, HTML5端的共用, 实现面向文档开发.</p>
</blockquote>

<p><img src="http://upload-images.jianshu.io/upload_images/1229762-6b2c8bed102c297f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<h6 id="参考链接">参考链接:</h6>

<ul>
  <li><a href="http://www.jianshu.com/p/47d565bf200e">iOS 执行.py脚本生成解耦架构</a></li>
  <li><a href="http://www.jianshu.com/p/d15379908582">iOS 执行.py脚本生成UI层结构</a></li>
</ul>

<h3 id="1-面向文档架构设计">1. 面向文档架构设计</h3>

<h4 id="文档要求">文档要求:</h4>
<ol>
  <li>视图操作需求, 包括页面中所有需要调用网络接口的逻辑, 比如跳转, 刷新等请求.</li>
  <li>网络通信接口, 对于目前sender层的一次解耦封装, 目的是不过于依赖sender层, 避免一套请求逻辑写很多遍.</li>
  <li>传输数据类型, 类似项目中的cachebean, 但不依赖cachebean. 针对不同需求可选添加状态机制, 页面遵循状态渲染.</li>
</ol>

<h4 id="文档协议样张">文档协议样张:</h4>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">#import &lt;UIKit/UIKit.h&gt;
#import &lt;WonderfulMallHome.pb.h&gt; 
</span>
<span class="k">@protocol</span> <span class="nc">HYSpecialSaleViewOperation</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span> <span class="c1">//定义视图操作需求
</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">pushToNextViewController</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">targetUrl</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">pullDownRefresh</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@protocol</span> <span class="nc">HYSpecialSaleModelInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span> <span class="c1">//定义传输数据类型
</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSInteger</span> <span class="n">tabId</span> <span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">NSMutableArray</span> <span class="o">*</span> <span class="n">activityTemplates</span> <span class="p">;</span>

<span class="k">@end</span>

<span class="k">@protocol</span> <span class="nc">HYSpecialSaleViewModelInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span> <span class="c1">//定义网络通信接口
</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleModelInterface</span><span class="o">&gt;</span> <span class="n">model</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initializeWithParameter</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">parameter</span> <span class="nf">finishedCallBack</span><span class="p">:(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">finishCallBack</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">pullDownRefreshWithFinishedCallBack</span><span class="p">:(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">finishCallBack</span><span class="p">;</span>

<span class="k">@end</span>


<span class="k">@protocol</span> <span class="nc">HYSpecialSaleViewInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewModelInterface</span><span class="o">&gt;</span> <span class="n">hyspecialsaleViewModel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewOperation</span><span class="o">&gt;</span> <span class="n">hyspecialsaleOperation</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>
</div>

<p>期望实现非开发人员通过阅读文档协议能够基础的了解该页面的大致逻辑功能, 并能够清晰的定位具体功能函数.</p>

<h3 id="2-架构设计模式浅析">2. 架构设计模式浅析</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>├── Template //模板文件
│   ├── ControllerTemplate.h //控制器
│   ├── ControllerTemplate.m
│   ├── InterfaceTemplate.h //文档协议
│   ├── ModelTemplate.h //传输数据类型
│   ├── ModelTemplate.m
│   ├── PresenterTemplate.h //视图操作需求
│   ├── PresenterTemplate.m
│   ├── ViewModelTemplate.h //网络通信接口
│   ├── ViewModelTemplate.m
│   ├── ViewTemplate.h //UI层
│   └── ViewTemplate.m
</code></pre>
</div>

<p>根据文档协议, 生成各自的<code class="highlighter-rouge">ModelTemplate</code>, <code class="highlighter-rouge">PresenterTemplate</code>, <code class="highlighter-rouge">ViewModelTemplate</code>, <code class="highlighter-rouge">ViewTemplate</code>, 生成的对象必须遵循文档协议的定义, 控制器用来协调 <code class="highlighter-rouge">PresenterTemplate</code>, <code class="highlighter-rouge">ViewModelTemplate</code>, <code class="highlighter-rouge">ViewTemplate</code> 三者的通信</p>

<h4 id="model层">Model层</h4>
<p>用来统筹页面使用的数据, 类似于项目中的cachebean, 但和cachebean不同的是, 可以在model中加入状态机制, UI逻辑可以根据网络请求后的状态机制来判断显示UI, 状态的制定根据具体产品文档的定义. 代码中可以使用枚举来区分状态.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import "HYSpecialSaleInterface.h"
</span>
<span class="k">@interface</span> <span class="nc">HYSpecialSaleModel</span> <span class="p">:</span> <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">HYSpecialSaleModelInterface</span><span class="o">&gt;</span>

<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSInteger</span> <span class="n">tabId</span> <span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">NSMutableArray</span> <span class="o">*</span> <span class="n">activityTemplates</span> <span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithDictionary</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">dictionary</span><span class="p">;</span>
<span class="k">+</span> <span class="p">(</span><span class="n">HYSpecialSaleModel</span> <span class="o">*</span><span class="p">)</span><span class="nf">modelWithDictionary</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">dictionary</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>
</div>

<h4 id="presenter层">Presenter层</h4>
<p>用于统筹页面的交互逻辑, 这里的交互逻辑是需要调用接口的交互逻辑, 本职工作是用于将ViewModel的数据正确传输到View的过程, 并在此更改状态机, 用来实现UI层逻辑在View层内实现. 上一页面传输来的参数通过控制器传输至Presenter层进行保存. 每次用户交互后重置ViewModel的数据, 实现单向的动态绑定.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">#import &lt;UIKit/UIKit.h&gt;
#import "HYSpecialSaleInterface.h"
</span>
<span class="k">@interface</span> <span class="nc">HYSpecialSalePresenter</span> <span class="p">:</span> <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewOperation</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="n">NSInteger</span> <span class="n">tabId</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">weak</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewInterface</span><span class="o">&gt;</span> <span class="n">hyspecialsaleView</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">weak</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewModelInterface</span><span class="o">&gt;</span> <span class="n">hyspecialsaleViewModel</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">adapterWithHYSpecialSaleView</span><span class="p">:(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewInterface</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">hyspecialsaleView</span> <span class="nf">hyspecialsaleViewModel</span><span class="p">:(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewModelInterface</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">hyspecialsaleViewModel</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>
</div>

<h4 id="viewmodel层">ViewModel层</h4>
<p>用于统筹页面的接口调用, 对Model进行持有, 使得Model不直接与任意对象进行交互,确保数据的安全性, 可将所有的数据获取及修改数据结构的逻辑封装在该层, 可以实现接口的互相调用.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import "HYSpecialSaleInterface.h"
</span>
<span class="k">@interface</span> <span class="nc">HYSpecialSaleViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">HYSpecialSaleViewModelInterface</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleModelInterface</span><span class="o">&gt;</span> <span class="n">model</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initializeWithParameter</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">parameter</span> <span class="nf">finishedCallBack</span><span class="p">:(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">finishCallBack</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">pullDownRefreshWithFinishedCallBack</span><span class="p">:(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">finishCallBack</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>
</div>

<h4 id="view层">View层</h4>
<p>用于UI层的展示, 所有的UI层都基于可复用的TableView, 持有用户交互操作及ViewModel数据的绑定. 在View层所有的用户交互实现直接调用文档协议中的视图操作函数即可, 不必关系具体的实现流程, 当请求完成后会更新ViewModel数据, 进行页面的刷新, 特殊的UI逻辑根据状态机进行判断即可.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">#import &lt;UIKit/UIKit.h&gt;
#import "HYSpecialSaleInterface.h"
</span>
<span class="k">@interface</span> <span class="nc">HYSpecialSaleView</span> <span class="p">:</span> <span class="nc">UIView</span> <span class="o">&lt;</span><span class="n">HYSpecialSaleViewInterface</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewOperation</span><span class="o">&gt;</span> <span class="n">hyspecialsaleOperation</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">HYSpecialSaleViewModelInterface</span><span class="o">&gt;</span> <span class="n">hyspecialsaleViewModel</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>
</div>

<h3 id="3-文档设计代码规范">3. 文档设计代码规范</h3>

<p>所有的函数方法的命名使用驼峰式的命名方法, 避免使用缩写, 如之前的cachebean缩写成cb这种是绝对要避免的, 对于BOOL值得命名需要在参数名前加上<code class="highlighter-rouge">is</code>来进行区分, 期望做到代码即为注释, 让非开发人员通过仅仅看代码就能够知道业务逻辑.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">#import &lt;UIKit/UIKit.h&gt;
</span>
<span class="k">@protocol</span> <span class="err">&lt;#</span><span class="nc">Unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">ViewOperation</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">#</span><span class="n">ViewOperation</span><span class="err">#</span><span class="o">&gt;</span>

<span class="k">@end</span>

<span class="k">@protocol</span> <span class="err">&lt;#</span><span class="nc">Unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">ModelInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">#</span><span class="n">ModelInterface</span><span class="err">#</span><span class="o">&gt;</span>

<span class="k">@end</span>

<span class="k">@protocol</span> <span class="err">&lt;#</span><span class="nc">Unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">ViewModelInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;&lt;</span><span class="err">#</span><span class="n">Unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">ModelInterface</span><span class="o">&gt;</span> <span class="n">model</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initializeWithParameter</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">parameter</span> <span class="nf">finishedCallBack</span><span class="p">:(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">finishCallBack</span><span class="p">;</span>
<span class="o">&lt;</span><span class="err">#</span><span class="n">ViewModelInterface</span><span class="err">#</span><span class="o">&gt;</span>
<span class="k">@end</span>

<span class="k">@protocol</span> <span class="err">&lt;#</span><span class="nc">Unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">ViewInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;&lt;</span><span class="err">#</span><span class="n">Unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">ViewModelInterface</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="err">#</span><span class="n">unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">ViewModel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;&lt;</span><span class="err">#</span><span class="n">Unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">ViewOperation</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="err">#</span><span class="n">unit</span><span class="err">#</span><span class="o">&gt;</span><span class="n">Operation</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"super"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="err">//父类的前缀</span><span class="w">
    </span><span class="nt">"controller"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Home"</span><span class="p">,</span><span class="w"> </span><span class="err">//控制器的前缀名</span><span class="w">
    </span><span class="nt">"model"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">//模型的属性定义</span><span class="w">
        </span><span class="nt">"models"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Array"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"viewModel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">//获取数据的方法定义</span><span class="w">
        </span><span class="s2">"register"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"login"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"exit"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"refresh"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"presenter"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">//用户交互的方法定义</span><span class="w">
        </span><span class="s2">"pushToNextViewController"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"popToRootViewController"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"showAlert"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"closeButtonClick"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>文档模板可以通过任意数据结构进行生成, 文档模板中的<code class="highlighter-rouge">&lt;#Unit#&gt;</code>为该页面的前缀名, 如”HYHome”, “HYSpecialSale”等.</p>

<h4 id="model的代码规范">Model的代码规范</h4>
<p>根据cacheBean相同字段, 或使用cachebean的子类, 但由于代码逻辑清晰的缘故推荐使用生成的model层.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">isPreLoad</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewWillAppear</span><span class="p">:(</span><span class="n">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewWillAppear</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_isPreLoad</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">adapterView</span><span class="p">];</span>
        <span class="n">_isPreLoad</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>
</div>
<p>Bool类型的参数名推荐添加<code class="highlighter-rouge">is</code>前缀, 能够让非开发人员了解是Bool值.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>typedef NS_OPTIONS(NSUInteger, UIControlState) {
    UIControlStateNormal       = 0,
    UIControlStateHighlighted  = 1 &lt;&lt; 0,                  // used when UIControl isHighlighted is set
    UIControlStateDisabled     = 1 &lt;&lt; 1,
    UIControlStateSelected     = 1 &lt;&lt; 2,                  // flag usable by app (see below)
    UIControlStateFocused NS_ENUM_AVAILABLE_IOS(9_0) = 1 &lt;&lt; 3, // Applicable only when the screen supports focus
    UIControlStateApplication  = 0x00FF0000,              // additional flags available for application use
    UIControlStateReserved     = 0xFF000000               // flags reserved for internal framework use
};
</code></pre>
</div>
<p>状态机的定义可以参考系统的<code class="highlighter-rouge">UIControl</code>的形式创建, 可实现位移叠加状态.</p>

<h4 id="presenter的代码规范">Presenter的代码规范</h4>
<p>根据具体需求制定方法名, 方法如果需要调用接口建议与接口名相同或类似, 尽可能的简化参数, 达到代码及注释的原则. 方法名使用驼峰形式, 不建议用缩写, 能够准确的描述方法用处为佳.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- (void)pushToNextViewController:(NSString *)targetUrl {
    [[HYCurrentVCmanager shareInstance].getCurrentVC hyPushDetail:targetUrl];
}

- (void)pullDownRefresh {
    
    __weak typeof(self) _self = self;
    __weak id&lt;HYSpecialSaleViewModelInterface&gt; __hyspecialsaleViewModel = _hyspecialsaleViewModel;
    [_hyspecialsaleViewModel pullDownRefreshWithFinishedCallBack:^{
        _self.hyspecialsaleView.hyspecialsaleViewModel = __hyspecialsaleViewModel;
    }];
}
</code></pre>
</div>
<p>UI相关逻辑操作使用状态机在View层进行操作, 不建议在Presenter书写, 会造成逻辑紊乱, 接口调用的时候仅需重新赋值ViewModel, 数据及状态机会动态进行更新.</p>

<h4 id="viewmodel的代码规范">ViewModel的代码规范</h4>

<p>根据函数命名规范和之前类似, 请保证有传入参数及回调即可 – <code class="highlighter-rouge">Parameter:(NSDictionary *)parameter finishedCallBack:(void (^)())finishCallBack</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- (void)dynamicBindingWithWithParameter:(NSDictionary *)parameter finishedCallBack:(void (^)())finishCallBack {

    [DataBase requestDataWithClass:[NSObject class] finishedCallBack:^(NSDictionary *response) {

        NSDictionary * data = response;
        NSArray * models = data[@"models"];

        [self.models removeAllObjects];
        for (NSDictionary * dict in models) {
            [self.models addObject:[ModelTemplate modelWithDictionary:dict]];
        }

        finishCallBack();
    }];

    [NetWork requestDataWithType:MethodGetType URLString:@"http://localhost:3001/api/J1/getJ1List" parameter:nil finishedCallBack:^(NSDictionary * response){

        NSDictionary * data = response[@"data"];
        NSArray * models = data[@"models"];

        [self.models removeAllObjects];
        for (NSDictionary * dict in models) {
            [self.models addObject:[ModelTemplate modelWithDictionary:dict]];
        }

        [DataBase cache:[NSObject class] data:data[@"models"]];
        finishCallBack();
    }];
}
</code></pre>
</div>
<p>可以在ViewModel层处理数据相逻辑的操作, 比如数据缓存, 和网络请求, 以及一些数据封装, 状态机建议写在Presenter层的回调中.</p>

<h4 id="view的代码规范">View的代码规范</h4>
<p>View没有什么特别的代码规范, 根据不同需求灵活使用设计模式即可, 在ViewModel赋值<code class="highlighter-rouge">set</code>方法调用的函数中可以进行状态机的判断及刷新的操作.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- (void)setHyspecialsaleViewModel:(id&lt;HYSpecialSaleViewModelInterface&gt;)hyspecialsaleViewModel {
    _hyspecialsaleViewModel = hyspecialsaleViewModel;
    
    if (!_preLoaded) { //这种判断可以使用状态机来代替.
        [self sortSubViews:@[@{@"blockType" : @(SpecialBlockTypeBlockBanner), @"showTitle" : @(NO)},
                             @{@"blockType" : @(SpecialBlockTypeBlockOne),    @"showTitle" : @(NO)},
                             @{@"blockType" : @(SpecialBlockTypeBlockTwo),    @"showTitle" : @(NO)},
                             @{@"blockType" : @(SpecialBlockTypeBlockThree),  @"showTitle" : @(NO)},
                             @{@"blockType" : @(SpecialBlockTypeBlockFour),   @"showTitle" : @(NO)},
                             @{@"blockType" : @(SpecialBlockTypeBlockFive),   @"showTitle" : @(NO), @"showMain" : @(YES)}]];
        _tableView.userInteractionEnabled = NO;
        _preLoaded = YES;
    } else {
        NSMutableArray * arr = [NSMutableArray array];
        for (ActivityBlock * activityBlock in hyspecialsaleViewModel.model.activityTemplates) {
            BOOL showTitle = activityBlock.blockTitle.length ? YES : NO;
            BOOL showMain = activityBlock.banners.hyArray.count == 3 ? YES : NO;
            SpecialBlockType blockType = activityBlock.blockType;
            if (blockType == SpecialBlockTypeBlockFive) {
                [arr addObject:@{@"blockType" : @(blockType), @"showTitle" : @(showTitle), @"showMain" : @(showMain)}];
            } else {
                [arr addObject:@{@"blockType" : @(blockType), @"showTitle" : @(showTitle)}];
            }
        }
        _tableView.userInteractionEnabled = YES;
        [self sortSubViews:arr];
    }
        [_tableView reloadData]; //刷新列表
}
</code></pre>
</div>
<p>在View中可以直接使用之前的<code class="highlighter-rouge">operation</code>的所有用户交互的函数.</p>

<h3 id="小建议">小建议</h3>

<p>文档协议的建议:</p>

<ol>
  <li>第一次生成后如需添加新的方法, 接口或数据结构等, 都首先修改文档协议, 并遵守文档协议的规范</li>
  <li>文档协议尽量保持清晰和完整, 有必要的情况可以添加注释让文档更加清晰</li>
  <li>不要随意修改之前的文档协议, 如需修改请事先进行沟通</li>
</ol>

<p>命名规范的建议:</p>

<ol>
  <li>不要使用缩写, 尽量使用自然语言让非开发人员能够了解功能, 所谓代码即注释</li>
  <li>建议使用 <code class="highlighter-rouge">is</code>, <code class="highlighter-rouge">set</code>, <code class="highlighter-rouge">get</code>, <code class="highlighter-rouge">did</code>, <code class="highlighter-rouge">will</code>, <code class="highlighter-rouge">ed</code>之类表示逻辑状态的关键字, 能够清晰的读懂方法名</li>
  <li>如果英语语法不清楚的同学可以使用<a href="https://translate.google.cn/">Google翻译</a>.</li>
</ol>

<p>UI层的建议:</p>

<ol>
  <li>cell使用Adapter适配器模式用以适配不同的数据结构</li>
  <li>cell的高度和内容封装在一个文件中, 进行解耦.</li>
  <li>operation可以贯穿子控件, 不建议使用delegate和block.</li>
</ol>

<p>具体说明可以<a href="https://github.com/coderZsq/coderZsq.project.oc">下载Demo</a>来进行共同探讨.</p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">最近的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2017/08/iOS-%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84HTTP%E7%BD%91%E7%BB%9C/" title="link to iOS 通俗易懂的HTTP网络">iOS 通俗易懂的HTTP网络</a></h2>
       <p class="excerpt">  去了饿厂面试后了解到了自己计算机基础的薄弱, 非科班出身薄弱也是自然的, 说实话, 我也并不是特别想要往底层深究, 因为越底层的东西越会抽象成服务输送给大众, 就好比自来水, 一般人都不会想要去了解自来水的底层逻辑吧, 但作为开发者, 我们还是得了解下基础的网络概念.序关于HTTP与HTML的发明有个很有趣的插曲, 那就是首个万维网服务器与浏览器是在一台NeXTStep计算机上编写的, 在1997年, Apple收购了NeXTStep Computer并将NeXTStep作为mac O...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-08-09 17:01:00 +0800" class="post-list__meta--date date">2017-08-09</time> &#8226; <span class="post-list__meta--tags tags">移动开发</span><a class="btn-border-small" href=/2017/08/iOS-%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84HTTP%E7%BD%91%E7%BB%9C/>继续阅读</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">更早的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2017/07/Web-Vue%E9%A1%B9%E7%9B%AE%E9%80%9F%E8%BD%AC.htm%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5/" title="link to Web Vue项目速转.htm静态网页">Web Vue项目速转.htm静态网页</a></h2>
       <p class="excerpt">  拖了2个星期, 终于可以结束简历制作的项目了, 说实话这个项目其实挺没有技术含量的, 话说我也没什么技术, 对于前端方面的技术也仅仅是浅显的认知, 要更加深入的进行学习的话算法也就是数学知识真的是一个很大的瓶颈, 所以这一话后准备潜心修炼自己薄弱的数学知识.参考链接:  Web 是时候用前端写个简历了!  Web 前端项目要从基本布局开始  Web 简历一定要设计的美美的  Web 使用Vue代替陈旧的jQuery以下内容在上述文章基础上进行, 请事先查阅.设计模式是小白晋升码农的利器...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-07-19 14:13:00 +0800" class="post-list__meta--date date">2017-07-19</time> &#8226; <span class="post-list__meta--tags tags">前端开发</span><a class="btn-border-small" href=/2017/07/Web-Vue%E9%A1%B9%E7%9B%AE%E9%80%9F%E8%BD%AC.htm%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5/>继续阅读</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">本站点采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a></span>
        <span class="footer__copyright">由 <a href="https://jekyllrb.com">Jekyll</a> 于 2021-11-30 生成，感谢 <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> 为本站提供稳定的 VPS 服务</span>
        <span class="footer__copyright">本站由 <a href="https://github.com/coderZsq">@Castie!</a> 创建，采用 <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> 作为主题，您可以在 GitHub 找到<a href="https://github.com/onevcat/OneV-s-Den">本站源码</a> - &copy; 2021</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>


    
  </body>

</html>
