---
layout: post
title: Web ä½¿ç”¨fetchè¯·æ±‚åŽç«¯æœåŠ¡
date: 2017.11.15 11:33
tag: å‰ç«¯å¼€å‘
---

> ä¸Šç¯‡æˆ‘ä»¬ä½¿ç”¨äº†ssmæž„å»ºäº†æˆ‘ä»¬ç®€åŽ†çš„æœåŠ¡, è¿™ç¯‡æˆ‘ä»¬ä»Žå‰ç«¯çš„è§†è§’è¿›è¡Œç½‘ç»œè¯·æ±‚, å¯¹äºŽreactå°±è¦è®²è®²fetchè¿™ä¸ªåº“çš„ä½¿ç”¨, å¯¹äºŽvueå°±è¦è®²è®²axiosè¿™ä¸ªåº“, å¯¹äºŽaxiosä¹‹å‰å·²ç»è®²è¿‡, è¿™ç¯‡å°±æ¥è®²è®²fetchçš„ä½¿ç”¨.

![](http://upload-images.jianshu.io/upload_images/1229762-6afd704390c3aedc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

###### å‚è€ƒé“¾æŽ¥:

- [Web æ˜¯æ—¶å€™ç”¨å‰ç«¯å†™ä¸ªç®€åŽ†äº†!](http://www.jianshu.com/p/d1497da0f9ab)
- [Web å‰ç«¯é¡¹ç›®è¦ä»ŽåŸºæœ¬å¸ƒå±€å¼€å§‹](http://www.jianshu.com/p/5c4788c0389d)
- [Web ç®€åŽ†ä¸€å®šè¦è®¾è®¡çš„ç¾Žç¾Žçš„](http://www.jianshu.com/p/b3389f66f539)
- [Web ä½¿ç”¨Vueä»£æ›¿é™ˆæ—§çš„jQuery](http://www.jianshu.com/p/85d95723edfb)
- [Web Vueé¡¹ç›®é€Ÿè½¬.htmé™æ€ç½‘é¡µ](http://www.jianshu.com/p/f1fd09628b43)
- [Web å°†é¡¹ç›®å¿«é€Ÿè¿ç§»è‡³React](http://www.jianshu.com/p/1803bfac1527)
- [Web PCé¡¹ç›®å¿«é€Ÿé€‚é…ç§»åŠ¨ç«¯](http://www.jianshu.com/p/404ddf018a84)
- [Server å…¥é—¨åŽç«¯ä½ è¦å­¦ä»€ä¹ˆ](http://www.jianshu.com/p/ec78451ed312)
- [Server ä½¿ç”¨Springæ¥æž„å»ºæœåŠ¡](http://www.jianshu.com/p/ffc5fa6a376a)

ä»¥ä¸‹å†…å®¹åœ¨ä¸Šè¿°æ–‡ç« åŸºç¡€ä¸Šè¿›è¡Œ, è¯·äº‹å…ˆæŸ¥é˜….

#### å®‰è£…fetch

å½“ç„¶è¯´åˆ°fetch, å…¶å®žå°±æ˜¯å¯¹äºŽajaxçš„ä¸€ä¸ªå°è£…, ç±»ä¼¼äºŽiOSçš„AFNetworking, é¦–å…ˆæˆ‘ä»¬å…ˆä»Žnpm åŠ è½½è¿™ä¸ªåº“.

```
$ npm instaill fetch --save
```

åœ¨å¼€å§‹è¿›è¡Œç½‘ç»œè¯·æ±‚ä¹‹å‰, æˆ‘ä»¬éœ€è¦å’ŒåŽç«¯å®šä¹‰å¥½æŽ¥å£ä»¥åŠè¿”å›žçš„æ•°æ®, å½“ç„¶å¦‚æžœæ˜¯å‰åŽç«¯ä¸€èµ·å¼€å‘çš„è¯, å°±æ²¡æœ‰è¿™ä¸ªå›°æ‰°äº†.

#### æŸ¥é˜…fetchæ–‡æ¡£

[æ–‡æ¡£é“¾æŽ¥](https://github.github.io/fetch/)

```
Usage synopsis (use the argument links to find out more):

fetch(url, options).then(function(response) {
  // handle HTTP response
}, function(error) {
  // handle network error
})
More comprehensive usage example:

fetch(url, {
  method: "POST",
  body: JSON.stringify(data),
  headers: {
    "Content-Type": "application/json"
  },
  credentials: "same-origin"
}).then(function(response) {
  response.status     //=> number 100â€“599
  response.statusText //=> String
  response.headers    //=> Headers
  response.url        //=> String

  return response.text()
}, function(error) {
  error.message //=> String
})
```

#### è‡ªè¡Œå°è£…fetch

åƒæˆ‘ä»¬åœ¨iOSä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™å›žåœ¨å…¶åŸºç¡€ä¸Šå°è£…ä¸€å±‚, ä»¥ä¾¿æ—¥åŽç»´æŠ¤æ–¹ä¾¿, å¯¹äºŽå‰ç«¯, è®¾è®¡æ€æƒ³ä¹Ÿæ˜¯ä¸€æ ·çš„, æˆ‘ä»¬å°±æ¥æ–°å»ºä¸€ä¸ªhttp.jsæ¥å°è£…ç½‘ç»œè¯·æ±‚å’ŒæŽ¥å£.


```
const host = 'http://localhost:8080';

export function GET(url) {
    var fetchOptions = {
        method: 'GET'
    };
    return new Promise((resolve, reject) => {
        fetch(url, fetchOptions).then(response => response.json()).then(response => resolve(response.data)).catch((error) => {
            reject(error);
        })
    });
}

export const URL = {
    fetchProfile: `${host}/portal/fetch_profile.do`,
    fetchProjects: `${host}/portal/fetch_projects.do`,
    fetchGitHub: `${host}/portal/fetch_github.do`,
    fetchArticles: `${host}/portal/fetch_articles.do`,
    fetchExperience: `${host}/portal/fetch_experience.do`,
    fetchContact: `${host}/portal/fetch_contact.do`
}

```

éžå¸¸ç®€å•çš„åœ¨fetchçš„åŸºç¡€ä¸Šä½¿ç”¨Promiseè¿›è¡Œå°è£…, å¹¶å°†æ‰€éœ€è¦çš„æŽ¥å£æ•´åˆåˆ°ä¸€èµ·ä»¥ä¾¿æ—¥åŽçš„ç»´æŠ¤.

#### æŸ¥çœ‹æŽ¥å£

ä¸ºä¾‹å®Œæˆä¸‹å›¾çš„å±•ç¤º, æˆ‘ä»¬å·²ç»é€šè¿‡ssmå†™å¥½äº†è¿™ä¸ªæŽ¥å£.

![](http://upload-images.jianshu.io/upload_images/1229762-a3d8a0c34c76e69e.png?imageMogr2/auto-orient/strip)

æˆ‘ä»¬å°±ä»¥ç¬¬ä¸€ä¸ªæŽ¥å£ä¸¾ä¾‹`fetchProfile: `${host}/portal/fetch_profile.do`,å¦‚æžœä½ å¯¹es6æ¨¡æ¿å­—ç¬¦ä¸²çš„è¯­æ³•ä¸ç†Ÿæ‚‰çš„è¯, å¯ä»¥è‡ªè¡Œæœç´¢ä¸‹, æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªæŽ¥å£çš„è¿”å›ž.

```
/* http://localhost:8080/portal/fetch_profile.do */
{
    "status": 0,
    "data": {
        "profileImage": "http://upload-images.jianshu.io/upload_images/1229762-23e162b9bd6b9c39.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
        "profileName": "Shuangquan Zhu",
        "profileCareer": "Designer / Developer",
        "profileLocation": "Shanghai",
        "profileSocialList": [
            {
                "src": "http://upload-images.jianshu.io/upload_images/1229762-877e3e5c2260bcf1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                "href": "https://github.com/coderzsq"
            },
            {
                "src": "http://upload-images.jianshu.io/upload_images/1229762-f6525252f3e8387b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                "href": "http://www.jianshu.com/u/9d7fad1a4693"
            },
            {
                "src": "http://upload-images.jianshu.io/upload_images/1229762-a69614a97de93f36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                "href": "http://upload-images.jianshu.io/upload_images/1229762-453920a3f4eedcd8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
            },
            {
                "src": "http://upload-images.jianshu.io/upload_images/1229762-91b0949aec719aab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                "href": "http://coderzsq.github.io/"
            }
        ],
        "profileSummaryTitle": "Summary",
        "profileSummaryDescription": "Shuangquan Zhu is a professional developer who focuses on iOS now. He has strong knowledge of Objective-C, Swift and Javascript. With these skills, he created quite a few quickly developer tools. He also leads the J1 iOS team to promote the project process.\\nHe crazy loves playing basketball with friends in spare time, He also loves traveling, writing and listening music. He is always willing to try new things, and keeping to learn from them.",
        "profileInterestTitle": "Interest",
        "profileInterestList": [
            {
                "interest": "Learn about high tech"
            },
            {
                "interest": "Play basketball"
            },
            {
                "interest": "Listen to music"
            },
            {
                "interest": "Apple products"
            }
        ],
        "profileEducationTitle": "Education",
        "profileEducationList": [
            {
                "major": "Business Management",
                "school": "East China University of Science and Technology",
                "year": "2016"
            },
            {
                "major": "Customs and International Freight",
                "school": "Shanghai Maritime Academy",
                "year": "2013"
            }
        ]
    }
}
```

è¿™ä¸ªè¿”å›žçš„æ•°æ®ç»“æž„å·²ç»å¯ä»¥å®Œç¾ŽåŒ¹é…ä¸Šå›¾çš„æ•°æ®å±•ç¤ºéœ€æ±‚äº†.

#### å¦‚ä½•è¯·æ±‚

å°±ä»¥ç¬¬ä¸€ä¸ªæ¨¡å—ä¸¾ä¾‹, æˆ‘ä»¬æ‰“å¼€`pc_home.js`ä¸ºä¾‹:

###### æž„é€ å‡½æ•°

```
    constructor() {
        super();
        this.state = {
            data: {
                profileImage: '',
                profileName: '',
                profileCareer: '',
                profileLocation: '',
                profileSocialList: [],
                profileSummaryTitle: '',
                profileSummaryDescription: '',
                profileInterestTitle: '',
                profileInterestList: [],
                profileEducationTitle: '',
                profileEducationList: []
            }
        }
    }
```
é¦–å…ˆæˆ‘ä»¬éœ€è¦æ·»åŠ æž„é€ å‡½æ•°, å­—æ®µå¯¹åº”è¿”å›žçš„æ•°æ®ç»“æž„.

###### ç”Ÿå‘½å‘¨æœŸå‡½æ•°

```
    componentWillMount() {
        GET(URL.fetchProfile).then((data) => {
            this.setState({data: data})
        })
    }
```
ç”Ÿå‘½å‘¨æœŸå‡½æ•°, ç”¨äºŽé¡µé¢çš„è¯·æ±‚, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹åˆšæ‰fetchå°è£…ç±»çš„è°ƒç”¨.

###### æ¸²æŸ“å‡½æ•°

```
render() {
        const {data} = this.state;
        let profileLocation = data.profileLocation.length ? `Location: ${data.profileLocation}` : ''
        let profileSummaryDescription = data.profileSummaryDescription.split('\\n').map((description, index) => (
            <p key={index}>{description}</p>
        ))
        let profileSocialList = data.profileSocialList.map((socialVo, index) => (
            <div key={index}>
                <a href={socialVo.href}><img src={socialVo.src} alt=""/></a>
            </div>
        ))
        let profileInterestList = data.profileInterestList.map((interestVo, index) => (
            <li key={index}># {interestVo.interest}</li>
        ))
        let profileEducationList = data.profileEducationList.map((educationVo, index) => (
            <dl key={index}>
                <dd>{educationVo.major} - {educationVo.year}</dd>
                <dt>{educationVo.school}</dt>
            </dl>
        ))
        return (
            <div>
                <div styleName="user">
                    <div styleName="user-block">
                        <div styleName="icon">
                            <img src={data.profileImage} alt=""/>
                        </div>
                        <div styleName="row name">
                            {data.profileName}
                        </div>
                        <div styleName="row career">
                            {data.profileCareer}
                        </div>
                        <div styleName="row location">
                            {profileLocation}
                        </div>
                        <div styleName="row social">
                            <div styleName="indent"></div>
                            {profileSocialList}
                        </div>
                    </div>
                </div>
                <div styleName="introduction">
                    <div styleName="main">
                        <div styleName="main-block">
                            <h1>{data.profileSummaryTitle}</h1>
                            {profileSummaryDescription}
                        </div>
                    </div>
                    <div styleName="left">
                        <div styleName="left-block">
                            <h2>{data.profileInterestTitle}</h2>
                            <ul>{profileInterestList}</ul>
                        </div>
                    </div>
                    <div styleName="right">
                        <div styleName="right-block">
                            <h2>{data.profileEducationTitle}</h2>
                            {profileEducationList}
                        </div>
                    </div>
                </div>
            </div>
        )
  }
```
è¿›è¡Œæ¸²æŸ“, æˆ‘ä»¬å¯ä»¥å°†ä¸€äº›é€»è¾‘å†™åœ¨renderå‡½æ•°ä¸­, å°±å†™æ³•è€Œè¨€reactè¿™ç§ç”¨èµ·æ¥æ˜¯æ¯”vueçš„æ¨¡æ¿v-forè¿™ç§æ›´é€‚åˆæœ‰ç»éªŒçš„å¼€å‘è€….

è¿™é‡Œæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹éœ€è¦æŽŒæ¡å°±æ˜¯å½“reactçš„jsxéœ€è¦å¾ªçŽ¯æ¸²æŸ“çš„æ—¶å€™éœ€è¦åœ¨æœ€å¤–é¢çš„èŠ‚ç‚¹æ·»åŠ key={index}å±žæ€§.

#### å®Œæ•´ä»£ç 

```
import React, {Component} from 'react';
import CSSModules from 'react-css-modules';
import styles from './pc_home.css';
import {GET, URL} from '../javascripts/http';

@CSSModules(styles, {allowMultiple: true})
export default class PCHome extends Component {

    constructor() {
        super();
        this.state = {
            data: {
                profileImage: '',
                profileName: '',
                profileCareer: '',
                profileLocation: '',
                profileSocialList: [],
                profileSummaryTitle: '',
                profileSummaryDescription: '',
                profileInterestTitle: '',
                profileInterestList: [],
                profileEducationTitle: '',
                profileEducationList: []
            }
        }
    }

    componentWillMount() {
        GET(URL.fetchProfile).then((data) => {
            this.setState({data: data})
        })
    }

    render() {
        const {data} = this.state;
        let profileLocation = data.profileLocation.length ? `Location: ${data.profileLocation}` : ''
        let profileSummaryDescription = data.profileSummaryDescription.split('\\n').map((description, index) => (
            <p key={index}>{description}</p>
        ))
        let profileSocialList = data.profileSocialList.map((socialVo, index) => (
            <div key={index}>
                <a href={socialVo.href}><img src={socialVo.src} alt=""/></a>
            </div>
        ))
        let profileInterestList = data.profileInterestList.map((interestVo, index) => (
            <li key={index}># {interestVo.interest}</li>
        ))
        let profileEducationList = data.profileEducationList.map((educationVo, index) => (
            <dl key={index}>
                <dd>{educationVo.major} - {educationVo.year}</dd>
                <dt>{educationVo.school}</dt>
            </dl>
        ))
        return (
            <div>
                <div styleName="user">
                    <div styleName="user-block">
                        <div styleName="icon">
                            <img src={data.profileImage} alt=""/>
                        </div>
                        <div styleName="row name">
                            {data.profileName}
                        </div>
                        <div styleName="row career">
                            {data.profileCareer}
                        </div>
                        <div styleName="row location">
                            {profileLocation}
                        </div>
                        <div styleName="row social">
                            <div styleName="indent"></div>
                            {profileSocialList}
                        </div>
                    </div>
                </div>
                <div styleName="introduction">
                    <div styleName="main">
                        <div styleName="main-block">
                            <h1>{data.profileSummaryTitle}</h1>
                            {profileSummaryDescription}
                        </div>
                    </div>
                    <div styleName="left">
                        <div styleName="left-block">
                            <h2>{data.profileInterestTitle}</h2>
                            <ul>{profileInterestList}</ul>
                        </div>
                    </div>
                    <div styleName="right">
                        <div styleName="right-block">
                            <h2>{data.profileEducationTitle}</h2>
                            {profileEducationList}
                        </div>
                    </div>
                </div>
            </div>
        )
    }
}

```

å­¦ä¼šä¸€ä¸ªæŽ¥å£è¯·æ±‚, å¯¹äºŽå…¶ä»–çš„å°±æ˜¯å¤åˆ¶é»è´´çš„é‡å¤åŠ³åŠ¨äº†, è¿™æ ·è¿™ä¸ªç®€åŽ†é¡¹ç›®çš„å®Œæ•´æ€§åˆæœ‰äº†è¿›ä¸€æ­¥çš„æå‡, æŽ¥ä¸‹æ¥çš„å‘å±•æ–¹å‘æ˜¯åˆ¶ä½œä¸€ä¸ªåŽå°æœåŠ¡, æ•¬è¯·æœŸå¾….

##### About: 

![ç‚¹å‡»ä¸‹æ–¹é“¾æŽ¥è·³è½¬!!](http://upload-images.jianshu.io/upload_images/1229762-3f8925783027b3fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

 [ðŸŒŸ é¡¹ç›®æºç  è¯·ç‚¹è¿™é‡ŒðŸŒŸ >>> å–œæ¬¢çš„æœ‹å‹è¯·ç‚¹å–œæ¬¢ >>> ä¸‹è½½æºç çš„åŒå­¦è¯·é€ä¸‹å°æ˜Ÿæ˜Ÿ >>> æœ‰é—²é’±çš„å£•ä»¬å¯ä»¥è¿›è¡Œæ‰“èµ >>> å°å¼Ÿä¼šå°½å¿«æŽ¨å‡ºæ›´å¥½çš„æ–‡ç« å’Œå¤§å®¶åˆ†äº« >>> ä½ çš„æ¿€åŠ±å°±æ˜¯æˆ‘çš„åŠ¨åŠ›!! ](https://github.com/coderZsq/coderZsq.webpack.js)

